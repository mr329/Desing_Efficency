<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practical Design Efficiency Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Cool and Collected palette
                        primary: '#1e40af', // Deep blue
                        secondary: '#0f766e', // Teal
                        accent: '#0891b2', // Sky blue
                        cool: '#475569', // Cool gray
                        slate: '#64748b', // Slate gray
                        warning: '#f59e0b', // Amber
                        danger: '#dc2626', // Red
                        // Efficiency indicators
                        efficient: '#059669', // Emerald
                        moderate: '#d97706', // Orange
                        inefficient: '#dc2626' // Red
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', system-ui, sans-serif;
        }

        /* Minimalist design principles */
        .minimal-card {
            background: white;
            border: 1px solid #f3f4f6;
            transition: all 0.2s ease;
        }
        
        .minimal-card:hover {
            border-color: #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .btn-minimal {
            background-color: #1a1a1a;
            color: white;
            border: none;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn-minimal:hover {
            background-color: #374151;
        }

        .btn-minimal-outline {
            background-color: transparent;
            color: #1a1a1a;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn-minimal-outline:hover {
            border-color: #1a1a1a;
            background-color: #f9fafb;
        }

        .btn-accent {
            background-color: #4f46e5;
            color: white;
            border: none;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn-accent:hover {
            background-color: #4338ca;
        }
        
        /* Clean status indicators */
        .status-optimal {
            background-color: #f0fdf4;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status-warning {
            background-color: #fffbeb;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .status-danger {
            background-color: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .status-not-set {
            background-color: #f9fafb;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }
        
        /* Minimalist inputs */
        .input-minimal {
            border: 1px solid #e5e7eb;
            background: white;
            transition: border-color 0.2s ease;
        }
        
        .input-minimal:focus {
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.05);
        }
        
        /* Clean navigation */
        .step-nav {
            background: white;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .step-active {
            background: #1a1a1a !important;
            color: white !important;
        }
        
        .step-completed {
            background: #10b981 !important;
            color: white !important;
        }
        
        /* Minimal page structure */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Clean hero section */
        .hero-section {
            background: linear-gradient(180deg, #ffffff 0%, #f9fafb 100%);
        }

        /* Geometric shapes */
        .shape-circle {
            width: 8px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 50%;
            position: absolute;
        }

        .shape-square {
            width: 12px;
            height: 12px;
            background: #f3f4f6;
            position: absolute;
            transform: rotate(45deg);
        }

        /* Clean flowchart */
        .process-card {
            background: white;
            border: 1px solid #f3f4f6;
            transition: all 0.2s ease;
        }

        .process-card:hover {
            border-color: #e5e7eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Minimalist animations */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Clean file upload */
        .upload-area {
            border: 2px dashed #e5e7eb;
            background: #fafafa;
            transition: all 0.3s ease;
        }

        .upload-area.dragover {
            border-color: #4f46e5;
            background: #f8faff;
        }

        /* Clean impact indicators */
        .impact-minimal {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            color: #374151;
            font-weight: 500;
        }

        .impact-high { 
            background: #fef2f2; 
            border-color: #fecaca; 
            color: #991b1b; 
        }
        
        .impact-medium { 
            background: #fffbeb; 
            border-color: #fde68a; 
            color: #92400e; 
        }
        
        .impact-low { 
            background: #f0fdf4; 
            border-color: #bbf7d0; 
            color: #166534; 
        }

        /* Typography hierarchy */
        .text-display {
            font-size: 3.75rem;
            font-weight: 300;
            line-height: 1.1;
            letter-spacing: -0.025em;
        }

        .text-large {
            font-size: 1.5rem;
            font-weight: 400;
            line-height: 1.4;
        }

        /* Clean dark mode support */
        .dark .minimal-card {
            background: #111827;
            border-color: #374151;
        }

        .dark .btn-minimal {
            background-color: #f9fafb;
            color: #111827;
        }

        .dark .btn-minimal:hover {
            background-color: #e5e7eb;
        }

        .dark .input-minimal {
            background: #111827;
            border-color: #374151;
            color: #f9fafb;
        }

        .dark .hero-section {
            background: linear-gradient(180deg, #111827 0%, #1f2937 100%);
        }

        .dark .process-card {
            background: #111827;
            border-color: #374151;
        }

        .dark .upload-area {
            background: #1f2937;
            border-color: #374151;
        }

        .dark .upload-area.dragover {
            border-color: #4f46e5;
            background: #1e1b4b;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white dark:bg-gray-800 min-h-screen shadow-lg transition-colors duration-300">
            <!-- Header -->
            <div class="bg-primary text-white shadow-sm">
                <div class="max-w-6xl mx-auto px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 rounded-lg flex items-center justify-center overflow-hidden">
                                <img src="https://pfst.cf2.poecdn.net/base/image/cc880aabb5d7d2305b7aa6b910e47992b6e8a43bda688a85f93e31c5c74943f2?w=135&h=135" 
                                     alt="Practical Design Efficiency Tool" 
                                     class="w-full h-full object-contain">
                            </div>
                            <div>
                                <h1 class="text-xl font-bold text-white">Practical Design Efficiency Tool</h1>
                                <p class="text-blue-100 text-sm mt-1">Smart analysis for cost-effective, sustainable building design</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-6">
                            <!-- Status Indicators -->
                            <div class="hidden sm:flex items-center space-x-4 text-sm text-white">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-success rounded-full"></div>
                                    <span>Good</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-warning rounded-full"></div>
                                    <span>Review</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-danger rounded-full"></div>
                                    <span>Risk</span>
                                </div>
                            </div>
                            
                            <!-- Action Icons -->
                            <div class="flex items-center space-x-3">
                                <button 
                                    onclick="showBIMIntegration()"
                                    class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors duration-300"
                                    title="BIM Integration & IFC Checks"
                                >
                                    <i data-lucide="box" class="h-5 w-5 text-white"></i>
                                </button>
                                <button 
                                    onclick="showPage('resources')"
                                    class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors duration-300"
                                    title="Help & Resources"
                                >
                                    <i data-lucide="help-circle" class="h-5 w-5 text-white"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step Navigation -->
            <div class="step-nav" id="stepNavigation" style="display: none;">
                <div class="max-w-6xl mx-auto px-4 py-3">
                    <div class="flex space-x-1">
                        <button class="step-nav-btn step-active px-4 sm:px-6 py-2 rounded-lg font-medium text-sm" onclick="showPage('landing')" data-step="landing">
                            Overview
                        </button>
                        <button class="step-nav-btn px-4 sm:px-6 py-2 rounded-lg font-medium text-gray-600 text-sm" onclick="showPage('input')" data-step="input">
                            1. Setup
                        </button>
                        <button class="step-nav-btn px-4 sm:px-6 py-2 rounded-lg font-medium text-gray-600 text-sm" onclick="showPage('analysis')" data-step="analysis">
                            2. Analysis
                        </button>
                        <button class="step-nav-btn px-4 sm:px-6 py-2 rounded-lg font-medium text-gray-600 text-sm" onclick="showPage('summary')" data-step="summary">
                            3. Summary
                        </button>
                        <button class="step-nav-btn px-4 sm:px-6 py-2 rounded-lg font-medium text-gray-600 text-sm" onclick="showPage('resources')" data-step="resources">
                            4. Resources
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page 0: Landing Page -->
            <div id="landingPage" class="page active">
                <!-- Simple Google-style Landing -->
                <div class="min-h-screen bg-white dark:bg-gray-900 flex flex-col">
                    <!-- Simple Header -->
                    <header class="px-6 py-4 flex justify-end">
                        <div class="flex items-center space-x-4 text-sm">
                            <button onclick="showBIMIntegration()" class="text-gray-600 hover:text-primary transition-colors">
                                BIM Integration
                            </button>
                            <button onclick="showPage('resources')" class="text-gray-600 hover:text-primary transition-colors">
                                Help
                            </button>
                        </div>
                    </header>

                    <!-- Main Content -->
                    <div class="flex-1 flex items-center justify-center px-6">
                        <div class="w-full max-w-2xl text-center">
                            <!-- Logo/Title -->
                            <div class="mb-8">
                                <h1 class="text-5xl sm:text-6xl font-light text-gray-800 dark:text-gray-100 mb-4">
                                    Design
                                    <span class="text-primary font-normal">Efficiency</span>
                                </h1>
                                <p class="text-lg text-gray-600 dark:text-gray-400 max-w-lg mx-auto">
                                    Optimise your building design for cost, sustainability, and construction efficiency
                                </p>
                            </div>

                            <!-- Search/Action Box -->
                            <div class="bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-600 p-2 mb-8 hover:shadow-xl transition-shadow duration-300">
                                <div class="flex items-center">
                                    <div class="flex-1 px-4 py-3">
                                        <input 
                                            type="text" 
                                            placeholder="Enter your project name to get started..."
                                            class="w-full text-base text-gray-700 dark:text-gray-200 bg-transparent border-none outline-none placeholder-gray-500"
                                            id="quickProjectName"
                                            onkeypress="handleQuickStart(event)"
                                        >
                                    </div>
                                    <div class="flex items-center space-x-2 pr-2">
                                        <button 
                                            onclick="startFileUpload()"
                                            class="p-3 text-gray-400 hover:text-primary transition-colors rounded-full hover:bg-gray-100 dark:hover:bg-gray-700"
                                            title="Upload BIM file"
                                        >
                                            <i data-lucide="upload" class="h-5 w-5"></i>
                                        </button>
                                        <button 
                                            onclick="quickStart()"
                                            class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-full font-medium transition-colors duration-200"
                                        >
                                            Start Analysis
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats -->
                            <div class="flex justify-center items-center space-x-8 text-sm text-gray-600 dark:text-gray-400 mb-8">
                                <div class="text-center">
                                    <div class="font-semibold text-gray-800 dark:text-gray-200">30%</div>
                                    <div>Cost Reduction</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-semibold text-gray-800 dark:text-gray-200">40%</div>
                                    <div>Carbon Savings</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-semibold text-gray-800 dark:text-gray-200">6mo</div>
                                    <div>Faster Delivery</div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                                <button 
                                    onclick="startManualInput()"
                                    class="text-primary hover:text-primary/80 text-sm font-medium transition-colors"
                                >
                                    Manual Parameter Input
                                </button>
                                <span class="hidden sm:block text-gray-300">|</span>
                                <button 
                                    onclick="scrollToFeatures()"
                                    class="text-primary hover:text-primary/80 text-sm font-medium transition-colors"
                                >
                                    Learn How It Works
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Simple Footer -->
                    <footer class="px-6 py-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex flex-col sm:flex-row justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                            <div class="mb-2 sm:mb-0">
                                <span>Practical Design Efficiency Tool</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span>Developed by <a href="https://www.linkedin.com/in/mehdirobati" target="_blank" class="text-primary hover:text-primary/80 transition-colors">Dr Mehdi Robati</a></span>
                            </div>
                        </div>
                    </footer>
                </div>

                <!-- Features Section (Hidden initially) -->
                <div id="featuresSection" class="bg-gray-50 dark:bg-gray-800 py-16 px-6 hidden">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center mb-12">
                            <h2 class="text-3xl font-light text-gray-800 dark:text-gray-100 mb-4">
                                How It Works
                            </h2>
                            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                                Three simple steps to optimize your building design for better efficiency and sustainability
                            </p>
                        </div>

                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Step 1 -->
                            <div class="text-center">
                                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="upload" class="h-8 w-8 text-primary"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-2">1. Input</h3>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">
                                    Upload your BIM model or manually enter design parameters
                                </p>
                            </div>

                            <!-- Step 2 -->
                            <div class="text-center">
                                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="cpu" class="h-8 w-8 text-primary"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-2">2. Analyze</h3>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">
                                    AI algorithms evaluate 10 key efficiency parameters instantly
                                </p>
                            </div>

                            <!-- Step 3 -->
                            <div class="text-center">
                                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="download" class="h-8 w-8 text-primary"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-2">3. Optimize</h3>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">
                                    Get actionable recommendations and export detailed reports
                                </p>
                            </div>
                        </div>

                        <div class="text-center mt-12">
                            <button 
                                onclick="startAnalysis()"
                                class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg font-medium transition-colors duration-200"
                            >
                                Get Started Now
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Why Design Efficiency Matters Section - Compact -->
                <div id="learnMoreSection" class="py-6 px-4">
                    <div class="max-w-6xl mx-auto">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 mb-3">
                                Why Design Efficiency Matters
                            </h2>
                            <p class="text-base text-gray-600 dark:text-gray-400 max-w-4xl mx-auto">
                                Poor design decisions in early stages can increase project costs by 30-50% and significantly impact carbon emissions. 
                                Our tool helps you identify optimisation opportunities before it's too late.
                            </p>
                        </div>

                        <!-- What, Why, How Cards - Single Row -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                            <!-- What -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center">
                                <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="target" class="h-5 w-5 text-white"></i>
                                </div>
                                <h3 class="text-base font-bold text-gray-800 dark:text-gray-100 mb-2">What We Do</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-3 text-xs">
                                    Analyse 10 critical design parameters that impact cost, carbon emissions, and construction complexity.
                                </p>
                                <div class="text-xs text-gray-600 dark:text-gray-400">
                                    ✓ Form efficiency analysis<br>
                                    ✓ Structural optimisation<br>
                                    ✓ MEP system efficiency<br>
                                    ✓ Planning optimisation
                                </div>
                            </div>

                            <!-- Why -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center">
                                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="trending-up" class="h-5 w-5 text-white"></i>
                                </div>
                                <h3 class="text-base font-bold text-gray-800 dark:text-gray-100 mb-2">Why It Matters</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-3 text-xs">
                                    Early-stage optimisation can reduce costs by 15-30% and carbon emissions by 20-40%.
                                </p>
                                <div class="grid grid-cols-3 gap-2 text-center">
                                    <div>
                                        <div class="text-sm font-bold text-green-600">15-30%</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">Cost Savings</div>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-blue-600">20-40%</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">Carbon Reduction</div>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-purple-600">2-6mo</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">Schedule Savings</div>
                                    </div>
                                </div>
                            </div>

                            <!-- How -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-4 text-center">
                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="settings" class="h-5 w-5 text-white"></i>
                                </div>
                                <h3 class="text-base font-bold text-gray-800 dark:text-gray-100 mb-2">How We Help</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-3 text-xs">
                                    Upload BIM models or input parameters manually for instant analysis with clear recommendations.
                                </p>
                                <div class="text-xs text-gray-600 dark:text-gray-400">
                                    1. Input design parameters<br>
                                    2. Get instant analysis<br>
                                    3. Review optimisation tips<br>
                                    4. Export detailed report
                                </div>
                            </div>
                        </div>

                        <!-- How the Analysis Works - Process Flowchart -->
                        <div class="mb-6">
                            <h3 class="text-lg sm:text-xl font-bold text-center text-gray-800 dark:text-gray-100 mb-4">
                                How the Analysis Works
                            </h3>
                            
                            <!-- Mobile Flowchart (Vertical) -->
                            <div class="sm:hidden space-y-6">
                                <div class="flowchart-node bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl p-6 text-center">
                                    <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="upload" class="h-6 w-6 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">1. Input Data</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Upload BIM models or enter parameters manually</p>
                                </div>
                                
                                <div class="flex justify-center">
                                    <i data-lucide="arrow-down" class="h-6 w-6 text-gray-400"></i>
                                </div>
                                
                                <div class="flowchart-node bg-purple-50 dark:bg-purple-900/30 border-2 border-purple-200 dark:border-purple-700 rounded-xl p-6 text-center">
                                    <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="cpu" class="h-6 w-6 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">2. AI Analysis</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Smart algorithms evaluate 10 key efficiency parameters</p>
                                </div>
                                
                                <div class="flex justify-center">
                                    <i data-lucide="arrow-down" class="h-6 w-6 text-gray-400"></i>
                                </div>
                                
                                <div class="flowchart-node bg-green-50 dark:bg-green-900/30 border-2 border-green-200 dark:border-green-700 rounded-xl p-6 text-center">
                                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="bar-chart" class="h-6 w-6 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">3. Get Results</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Receive detailed analysis and optimization recommendations</p>
                                </div>
                                
                                <div class="flex justify-center">
                                    <i data-lucide="arrow-down" class="h-6 w-6 text-gray-400"></i>
                                </div>
                                
                                <div class="flowchart-node bg-orange-50 dark:bg-orange-900/30 border-2 border-orange-200 dark:border-orange-700 rounded-xl p-6 text-center">
                                    <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="download" class="h-6 w-6 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">4. Export Report</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Download comprehensive reports and presentations</p>
                                </div>
                            </div>

                            <!-- Desktop Flowchart (Horizontal) -->
                            <div class="hidden sm:flex items-center justify-between">
                                <div class="flowchart-node bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl p-6 text-center flex-1 process-step">
                                    <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="upload" class="h-8 w-8 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">1. Input Data</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Upload BIM models (IFC/Revit) or enter design parameters manually</p>
                                </div>
                                
                                <div class="mx-4">
                                    <i data-lucide="arrow-right" class="h-8 w-8 text-primary"></i>
                                </div>
                                
                                <div class="flowchart-node bg-purple-50 dark:bg-purple-900/30 border-2 border-purple-200 dark:border-purple-700 rounded-xl p-6 text-center flex-1 process-step">
                                    <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="cpu" class="h-8 w-8 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">2. AI Analysis</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Smart algorithms evaluate form, structure, MEP, and planning efficiency</p>
                                </div>
                                
                                <div class="mx-4">
                                    <i data-lucide="arrow-right" class="h-8 w-8 text-primary"></i>
                                </div>
                                
                                <div class="flowchart-node bg-green-50 dark:bg-green-900/30 border-2 border-green-200 dark:border-green-700 rounded-xl p-6 text-center flex-1 process-step">
                                    <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="bar-chart" class="h-8 w-8 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">3. Get Results</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Detailed analysis with risk assessment and optimization recommendations</p>
                                </div>
                                
                                <div class="mx-4">
                                    <i data-lucide="arrow-right" class="h-8 w-8 text-primary"></i>
                                </div>
                                
                                <div class="flowchart-node bg-orange-50 dark:bg-orange-900/30 border-2 border-orange-200 dark:border-orange-700 rounded-xl p-6 text-center flex-1">
                                    <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="download" class="h-8 w-8 text-white"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">4. Export Report</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Professional reports in PDF, CSV, and presentation formats</p>
                                </div>
                            </div>
                        </div>

                        <!-- Input Method Selection -->
                        <div class="mb-16">
                            <h3 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 dark:text-gray-100 mb-12">
                                Choose Your Input Method
                            </h3>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- File Upload Option -->
                                <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-8 text-center hover:border-primary transition-colors">
                                    <div class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i data-lucide="upload-cloud" class="h-10 w-10 text-white"></i>
                                    </div>
                                    <h4 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4">Upload BIM Model</h4>
                                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                                        Automatically extract design parameters from your IFC or Revit files for instant analysis.
                                    </p>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Supported Formats:</h5>
                                        <div class="flex flex-wrap gap-2 justify-center">
                                            <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm">.ifc</span>
                                            <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm">.rvt</span>
                                            <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm">.rfa</span>
                                            <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm">.dwg</span>
                                        </div>
                                    </div>
                                    <button onclick="startFileUpload()" class="btn-primary px-6 py-3 rounded-lg font-semibold w-full">
                                        <i data-lucide="upload" class="h-5 w-5 mr-2 inline"></i>
                                        Upload Model Files
                                    </button>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                                        Parameters extracted automatically • Faster analysis • Higher accuracy
                                    </p>
                                </div>

                                <!-- Manual Input Option -->
                                <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-8 text-center hover:border-primary transition-colors">
                                    <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i data-lucide="edit" class="h-10 w-10 text-white"></i>
                                    </div>
                                    <h4 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4">Manual Input</h4>
                                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                                        Enter design parameters manually for custom analysis and early-stage concept evaluation.
                                    </p>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Key Parameters:</h5>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <div>• Building form & proportions</div>
                                            <div>• Structural grid & heights</div>
                                            <div>• MEP systems & efficiency</div>
                                            <div>• Planning & space allocation</div>
                                        </div>
                                    </div>
                                    <button onclick="startManualInput()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold w-full transition-colors">
                                        <i data-lucide="edit-3" class="h-5 w-5 mr-2 inline"></i>
                                        Manual Input
                                    </button>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                                        Perfect for early design stages • Full control • Custom parameters
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Key Benefits Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="dollar-sign" class="h-8 w-8 text-red-600 dark:text-red-400"></i>
                                </div>
                                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2">Cost Optimization</h4>
                                <p class="text-gray-600 dark:text-gray-400">Identify design changes that can reduce construction costs by 15-30% through smart parameter optimization.</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="leaf" class="h-8 w-8 text-green-600 dark:text-green-400"></i>
                                </div>
                                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2">Carbon Reduction</h4>
                                <p class="text-gray-600 dark:text-gray-400">Minimize embodied carbon through efficient structural and material choices, reducing emissions by 20-40%.</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="clock" class="h-8 w-8 text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2">Faster Construction</h4>
                                <p class="text-gray-600 dark:text-gray-400">Streamline construction processes and reduce schedule by 2-6 months through design optimization.</p>
                            </div>
                        </div>

                        <!-- Call to Action -->
                        <div class="text-center bg-gradient-to-r from-primary to-purple-600 rounded-xl p-12 text-white">
                            <h3 class="text-3xl font-bold mb-4">Ready to Optimize Your Design?</h3>
                            <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
                                Join hundreds of architects and engineers using our tool to create more efficient, sustainable, and cost-effective buildings.
                            </p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <button onclick="startAnalysis()" class="bg-white text-primary px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition-colors">
                                    <i data-lucide="rocket" class="h-6 w-6 mr-2 inline"></i>
                                    Start Free Analysis
                                </button>
                                <button onclick="showBIMIntegration()" class="bg-white/20 backdrop-blur-sm border border-white/30 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-white/30 transition-colors">
                                    <i data-lucide="box" class="h-6 w-6 mr-2 inline"></i>
                                    BIM Integration
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Upload Modal -->
            <div id="fileUploadModal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4 hidden">
                <div class="bg-white dark:bg-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-600 flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">Upload BIM Model</h2>
                        <button id="closeFileUploadModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                            <i data-lucide="x-circle" class="h-6 w-6"></i>
                        </button>
                    </div>

                    <div class="p-6 space-y-6">
                        <!-- Drag and Drop Area -->
                        <div id="dropZone" class="file-upload-area border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-12 text-center transition-all duration-300">
                            <div id="dropZoneContent">
                                <i data-lucide="upload-cloud" class="h-16 w-16 text-gray-400 mx-auto mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-2">Drag & drop your files here</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">or click to browse</p>
                                <input type="file" id="fileInput" multiple accept=".ifc,.rvt,.rfa,.dwg" class="hidden">
                                <button onclick="document.getElementById('fileInput').click()" class="btn-primary px-6 py-2 rounded-lg font-semibold">
                                    Browse Files
                                </button>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                                    Supported: IFC, Revit (.rvt, .rfa), AutoCAD (.dwg) • Max 50MB per file
                                </p>
                            </div>
                        </div>

                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden">
                            <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Uploading...</span>
                                    <span id="progressPercent" class="text-sm text-gray-500 dark:text-gray-400">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                    <div id="progressBar" class="bg-primary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- File List -->
                        <div id="fileList" class="space-y-3"></div>

                        <!-- Upload Button -->
                        <div class="flex justify-end space-x-3">
                            <button onclick="closeFileUploadModal()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button id="processFilesBtn" onclick="processUploadedFiles()" class="px-6 py-2 btn-primary rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i data-lucide="play" class="h-4 w-4 mr-2 inline"></i>
                                Process Files
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rest of the existing pages with minimal modifications -->
            <!-- Page 1: Project Input (existing content with slight modifications) -->
            <div id="inputPage" class="page">
                <div class="p-4 sm:p-6">
                    <div class="max-w-4xl mx-auto">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 sm:mb-0">Project Parameters Input</h2>
                            
                            <!-- Input Mode Toggle -->
                            <div class="flex items-center space-x-3 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                                <button 
                                    id="detailedInputBtn"
                                    class="input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"
                                    onclick="switchInputMode('detailed')"
                                >
                                    <i data-lucide="settings" class="h-4 w-4 mr-2 inline"></i>
                                    Detailed Input
                                </button>
                                <button 
                                    id="simpleInputBtn"
                                    class="input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors bg-primary text-white"
                                    onclick="switchInputMode('simple')"
                                >
                                    <i data-lucide="layout-template" class="h-4 w-4 mr-2 inline"></i>
                                    Simple Input
                                </button>
                            </div>
                        </div>
                        
                        <!-- Project Info -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Project Information</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Project Name</label>
                                    <input type="text" id="projectName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter project name">
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mb-2">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Building Type</label>
                                        <div class="relative">
                                            <button 
                                                class="info-button w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 hover:bg-primary hover:text-white flex items-center justify-center text-xs transition-colors"
                                                onclick="toggleBuildingTypeInfo()"
                                                onmouseover="showBuildingTypeInfo()"
                                                onmouseleave="hideBuildingTypeInfo()"
                                            >
                                                <i data-lucide="info" class="h-3 w-3"></i>
                                            </button>
                                            <div id="buildingTypeInfo" class="info-popup hidden absolute z-20 left-0 top-6 w-96 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4">
                                                <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3">How Building Types Are Differentiated:</h4>
                                                <div class="space-y-3 text-xs text-gray-700 dark:text-gray-300">
                                                    <div>
                                                        <span class="font-medium text-blue-600 dark:text-blue-400">Office Buildings:</span>
                                                        <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                                            <li>Higher floor-to-floor heights (3.9m optimal) for complex MEP systems</li>
                                                            <li>Require suspended ceilings and extensive service distribution</li>
                                                            <li>Need larger cores for vertical transportation and services</li>
                                                            <li>Higher net-to-gross ratio expectations (80-85%)</li>
                                                        </ul>
                                                    </div>
                                                    <div>
                                                        <span class="font-medium text-green-600 dark:text-green-400">Residential Buildings:</span>
                                                        <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                                            <li>Lower floor-to-floor heights (3.1m optimal) with simpler MEP requirements</li>
                                                            <li>Direct service connections without extensive distribution</li>
                                                            <li>Smaller cores relative to floor area</li>
                                                            <li>Different planning efficiency considerations</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-3 italic border-t border-gray-200 dark:border-gray-600 pt-2">
                                                    💡 The tool automatically adjusts parameter guidance based on your building type selection.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <select id="buildingType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="">Select building type</option>
                                        <option value="office">Office Building</option>
                                        <option value="residential">Residential</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Parameter Inputs -->
                        <div id="parameterInputs" class="space-y-4">
                            <!-- Parameter cards will be populated by JavaScript -->
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between mt-8">
                            <button onclick="showPage('landing')" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-300">
                                <i data-lucide="arrow-left" class="h-5 w-5 mr-2 inline"></i>
                                Back to Overview
                            </button>
                            <button onclick="proceedToAnalysis()" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-300">
                                Proceed to Analysis
                                <i data-lucide="arrow-right" class="h-5 w-5 ml-2 inline"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rest of existing pages remain the same... -->
            <!-- Page 2: Analysis -->
            <div id="analysisPage" class="page">
                <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600 transition-colors duration-300">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <div class="flex space-x-2 sm:space-x-3">
                            <button
                                id="technicalViewBtn"
                                class="view-toggle px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-sm sm:text-base bg-primary text-white"
                            >
                                Technical View
                            </button>
                            <button
                                id="quickRulesBtn"
                                class="view-toggle px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-sm sm:text-base bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300"
                            >
                                Quick Rules
                            </button>
                        </div>
                        <div class="flex-1 relative">
                            <div class="absolute left-3 top-3 h-5 w-5 text-gray-400">
                                <i data-lucide="search"></i>
                            </div>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Search by rule, parameter, or category..."
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent transition-colors duration-300"
                            />
                        </div>
                        <select
                            id="categoryFilter"
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent transition-colors duration-300"
                        >
                            <option value="all">All Categories</option>
                        </select>
                    </div>
                </div>

                <!-- Quick Rules View -->
                <div id="quickRulesView" class="p-4 sm:p-6 grid gap-4">
                    <!-- Content will be populated by JavaScript -->
                </div>

                <!-- Technical View -->
                <div id="technicalView" class="p-4 sm:p-6 hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-[700px]">
                            <thead>
                                <tr class="border-b-2 border-gray-200 dark:border-gray-600">
                                    <th class="text-left p-3 text-gray-900 dark:text-gray-100">Parameter</th>
                                    <th class="text-left p-3 text-gray-900 dark:text-gray-100">Your Value</th>
                                    <th class="text-left p-3 text-gray-900 dark:text-gray-100">Status</th>
                                    <th class="text-left p-3 text-gray-900 dark:text-gray-100">Optimal</th>
                                    <th class="text-left p-3 text-gray-900 dark:text-gray-100">Action</th>
                                    <th class="text-center p-3 text-gray-900 dark:text-gray-100">Impact Scores</th>
                                </tr>
                            </thead>
                            <tbody id="technicalTableBody">
                                <!-- Content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between p-4 sm:p-6 bg-gray-50 dark:bg-gray-700">
                    <button onclick="showPage('input')" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-300">
                        <i data-lucide="arrow-left" class="h-5 w-5 mr-2 inline"></i>
                        Back to Input
                    </button>
                    <button onclick="proceedToSummary()" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-300">
                        View Summary
                        <i data-lucide="arrow-right" class="h-5 w-5 ml-2 inline"></i>
                    </button>
                </div>
            </div>

            <!-- Page 3: Summary -->
            <div id="summaryPage" class="page">
                <div class="p-4 sm:p-6">
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6">Project Summary & Checklist</h2>
                        
                        <!-- Project Overview -->
                        <div id="projectOverview" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
                            <!-- Content will be populated by JavaScript -->
                        </div>

                        <!-- Parameter Status Grid -->
                        <div id="parameterStatusGrid" class="grid gap-4 mb-6">
                            <!-- Content will be populated by JavaScript -->
                        </div>

                        <!-- Overall Assessment -->
                        <div id="overallAssessment" class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-6 mb-6">
                            <!-- Content will be populated by JavaScript -->
                        </div>

                        <!-- Export Options -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Export Report</h3>
                            <div class="flex flex-wrap gap-4">
                                <button onclick="exportToPDF()" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-300">
                                    <i data-lucide="file-text" class="h-5 w-5 mr-2 inline"></i>
                                    Export to PDF
                                </button>
                                <button onclick="exportToCSV()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-300">
                                    <i data-lucide="download" class="h-5 w-5 mr-2 inline"></i>
                                    Export to CSV
                                </button>
                                <button onclick="generatePresentation()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-300">
                                    <i data-lucide="presentation" class="h-5 w-5 mr-2 inline"></i>
                                    Generate Presentation
                                </button>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between mt-8">
                            <button onclick="showPage('analysis')" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-300">
                                <i data-lucide="arrow-left" class="h-5 w-5 mr-2 inline"></i>
                                Back to Analysis
                            </button>
                            <button onclick="showPage('resources')" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-300">
                                Next Steps & Resources
                                <i data-lucide="arrow-right" class="h-5 w-5 ml-2 inline"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 4: Next Steps & Resources -->
            <div id="resourcesPage" class="page">
                <div class="p-4 sm:p-6">
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6">Next Steps & Resources</h2>
                        
                        <!-- Resources Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                            
                            <!-- Comprehensive Design Efficiency Guide -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="book" class="h-6 w-6 text-indigo-600 dark:text-indigo-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Comprehensive Design Guide</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Complete Parameter Reference & Analysis Guide</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Visual guides, statistical analysis methodology, impact estimation techniques, and compliance checking procedures for all 10 efficiency parameters.</p>
                                        <button onclick="showComprehensiveGuide()" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            View Complete Guide
                                            <i data-lucide="book-open" class="h-4 w-4 ml-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- LECA Tool -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="calculator" class="h-6 w-6 text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">LECA Tool</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Lendlease Embodied Carbon Advisory tool</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Enables projects to set carbon targets at the project level during early-stage decision making.</p>
                                        <a href="https://leca.lendlease.com/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            Access LECA Tool
                                            <i data-lucide="external-link" class="h-4 w-4 ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Design Guide -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="book-open" class="h-6 w-6 text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Embodied Carbon Guide</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Lendlease Embodied Carbon Design Guide</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Comprehensive guidelines and best practices for reducing embodied carbon in building design.</p>
                                        <a href="https://lendlease.sharepoint.com/:b:/r/sites/KnowledgeGateway/KnowledgeLibrary/LowEmbodiedCarbonGuide_Internal_V1_Spreads_09102023094804.pdf?csf=1&web=1&e=gVUP8q" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            View Design Guide
                                            <i data-lucide="external-link" class="h-4 w-4 ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- BIM Integration -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-cyan-100 dark:bg-cyan-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="box" class="h-6 w-6 text-cyan-600 dark:text-cyan-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">BIM Integration</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Automated Parameter Extraction & Analysis</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Connect design efficiency analysis with your BIM workflow using IFC and Revit API integration.</p>
                                        <button onclick="showBIMIntegration()" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            View BIM Integration
                                            <i data-lucide="external-link" class="h-4 w-4 ml-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Statistical Analysis -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-orange-100 dark:bg-orange-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="bar-chart-3" class="h-6 w-6 text-orange-600 dark:text-orange-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Statistical Methodology</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Impact Analysis & Compliance Framework</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Learn how impacts are estimated, statistical significance is determined, and compliance with design limits is verified.</p>
                                        <button onclick="showStatisticalMethodology()" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            View Methodology
                                            <i data-lucide="trending-up" class="h-4 w-4 ml-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Integrated Solutions -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-300">
                                <div class="flex items-start gap-4">
                                    <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3 flex-shrink-0">
                                        <i data-lucide="building" class="h-6 w-6 text-purple-600 dark:text-purple-400"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Integrated Solutions</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">Lendlease Integrated Solutions</p>
                                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">Complete project delivery services from design to construction and beyond.</p>
                                        <a href="https://lendlease.sharepoint.com/sites/Microsite-Integrated-Solutions" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-primary hover:text-primary/80 text-sm font-medium transition-colors duration-300">
                                            Learn More
                                            <i data-lucide="external-link" class="h-4 w-4 ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Section -->
                        <div class="bg-gradient-to-r from-primary to-blue-600 text-white rounded-lg p-6 mb-6">
                            <div class="flex items-start gap-4">
                                <div class="bg-white/20 rounded-lg p-3 flex-shrink-0">
                                    <i data-lucide="users" class="h-8 w-8"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-2">Need Expert Support?</h3>
                                    <p class="text-blue-100 mb-4">Contact Lendlease Integrated Solutions for detailed analysis and project-specific questions.</p>
                                    <div class="bg-white/10 rounded-lg p-4">
                                        <p class="text-sm text-blue-100 mb-2">Our team of experts can help you:</p>
                                        <ul class="text-sm text-blue-100 space-y-1">
                                            <li>• Conduct detailed structural and MEP analysis</li>
                                            <li>• Optimise design parameters for your specific project</li>
                                            <li>• Implement advanced efficiency strategies</li>
                                            <li>• Address complex design challenges</li>
                                        </ul>
                                    </div>
                                    <a href="https://lendlease.sharepoint.com/sites/Microsite-Integrated-Solutions" target="_blank" rel="noopener noreferrer">
                                        <button class="mt-4 bg-white text-primary px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors duration-300 mb-8">
                                            <i data-lucide="mail" class="h-5 w-5 mr-2 inline"></i>
                                            Contact Our Experts
                                        </button>
                                    </a>
                                </div>
                            </div>                        
                        </div>
                        
                        <!-- Next Steps -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Recommended Next Steps</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-3">For Your Current Project:</h4>
                                    <ul class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="check-circle" class="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Review and address any risk parameters identified</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="check-circle" class="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Consider detailed structural and MEP analysis</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="check-circle" class="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Use LECA tool for embodied carbon targets</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="check-circle" class="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Engage with specialists for complex parameters</span>
                                        </li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-3">For Future Projects:</h4>
                                    <ul class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="lightbulb" class="h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Apply efficiency principles from the start</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="lightbulb" class="h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Study the Embodied Carbon Design Guide</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="lightbulb" class="h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Build efficiency into your design process</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i data-lucide="lightbulb" class="h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"></i>
                                            <span>Consider Lendlease Integrated Solutions</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Tool Information -->
                        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">About This Tool</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-2">Purpose</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">This Practical Design Efficiency Tool provides early-stage guidance to help identify opportunities for cost reduction, construction optimization, and waste minimization.</p>
                                    
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-2">Limitations</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">This tool provides indicative guidance only. Detailed analysis by qualified professionals is recommended for all projects.</p>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-2">Best Results</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">Use this tool early in the design process when parameters can still be easily adjusted. The tool is most effective when combined with professional expertise.</p>
                                    
                                    <h4 class="font-medium text-gray-800 dark:text-gray-100 mb-2">Support</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">For questions about this tool or your analysis results, contact our team through the link above.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between mt-8">
                            <button onclick="showPage('summary')" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-300">
                                <i data-lucide="arrow-left" class="h-5 w-5 mr-2 inline"></i>
                                Back to Summary
                            </button>
                            <button onclick="resetTool()" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors duration-300">
                                <i data-lucide="refresh-cw" class="h-5 w-5 mr-2 inline"></i>
                                Start New Analysis
                            </button>
                        </div>
                        
                        <!-- Tool Development Footnote -->
                        <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-600">
                            <p class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                Practical Design Efficiency Tool Developed by <a href="https://www.linkedin.com/in/mehdirobati" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-primary/80 transition-colours">Dr Mehdi Robati</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300">
            <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-600 flex justify-between items-start">
                <div class="flex-1 pr-4">
                    <h2 id="modalTitle" class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100"></h2>
                    <p id="modalSubtitle" class="text-gray-600 dark:text-gray-400 mt-1"></p>
                </div>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0">
                    <i data-lucide="x-circle" class="h-6 w-6"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6 space-y-6" id="modalContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Comprehensive Design Guide Modal -->
    <div id="comprehensiveGuideModal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300">
            <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-600 flex justify-between items-start">
                <div class="flex-1 pr-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100">Comprehensive Design Efficiency Guide</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Complete parameter reference, statistical analysis methodology & compliance framework</p>
                </div>
                <button onclick="closeComprehensiveGuide()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0">
                    <i data-lucide="x-circle" class="h-6 w-6"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6">
                <!-- Navigation -->
                <div class="flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                    <button 
                        id="overviewNavBtn" 
                        onclick="showGuideSection('overview')"
                        class="guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors bg-primary text-white"
                    >
                        Overview
                    </button>
                    <button 
                        id="parametersNavBtn" 
                        onclick="showGuideSection('parameters')"
                        class="guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"
                    >
                        Parameters
                    </button>
                    <button 
                        id="analysisNavBtn" 
                        onclick="showGuideSection('analysis')"
                        class="guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"
                    >
                        Statistical Analysis
                    </button>
                    <button 
                        id="complianceNavBtn" 
                        onclick="showGuideSection('compliance')"
                        class="guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"
                    >
                        Compliance
                    </button>
                    <button 
                        id="implementationNavBtn" 
                        onclick="showGuideSection('implementation')"
                        class="guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"
                    >
                        Implementation
                    </button>
                </div>

                <!-- Content Sections -->
                <div id="overviewSection" class="guide-section"></div>
                <div id="parametersSection" class="guide-section hidden"></div>
                <div id="analysisSection" class="guide-section hidden"></div>
                <div id="complianceSection" class="guide-section hidden"></div>
                <div id="implementationSection" class="guide-section hidden"></div>
            </div>
        </div>
    </div>

    <!-- Statistical Methodology Modal -->
    <div id="statisticalMethodologyModal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300">
            <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-600 flex justify-between items-start">
                <div class="flex-1 pr-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100">Statistical Methodology & Impact Analysis</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">How impacts are estimated, significance is determined, and compliance is verified</p>
                </div>
                <button onclick="closeStatisticalMethodology()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0">
                    <i data-lucide="x-circle" class="h-6 w-6"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6 space-y-6">
                <!-- Quick Overview -->
                <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-4">
                        <i data-lucide="trending-up" class="h-5 w-5 mr-2 inline"></i>
                        Methodology Overview
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">1. Parameter Classification</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Each parameter is assigned impact levels (High/Medium/Low) for cost, carbon, and construction time based on industry research</p>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">2. Quantitative Analysis</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Mathematical models estimate percentage impacts on material usage, energy consumption, and construction duration</p>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">3. Compliance Verification</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Values are checked against building codes, sustainability standards, and industry best practices</p>
                        </div>
                    </div>
                </div>

                <!-- This is only Mockup and need proper work to define it properly -->
                <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-2">
                        <i data-lucide="construction" class="h-5 w-5 mr-2 inline"></i>
                        This is only Mockup and need proper work to define it properly
                    </h3>
                    <p class="text-sm text-yellow-700 dark:text-yellow-300">
                        The following calculations and formulas are illustrative examples for demonstration purposes. 
                        All values, methodologies, and statistical models require proper validation and calibration 
                        with real project data before implementation.
                    </p>
                </div>
                
                <!-- Impact Calculation Examples -->
                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Impact Calculation Examples</h3>
                    <div class="bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700 rounded-lg p-4 mb-4">
                        <p class="text-sm text-orange-800 dark:text-orange-200 font-semibold">
                            <i data-lucide="info" class="h-4 w-4 mr-1 inline"></i>
                            Note: All of the following are indicative and needs to be properly defined
                        </p>
                        <p class="text-xs text-orange-700 dark:text-orange-300 mt-1">
                            These calculations serve as examples only. Actual implementation requires detailed engineering analysis, 
                            validation with industry data, and calibration for specific project contexts.
                        </p>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Form Efficiency Impact on Energy & Cost</h4>
                            <div class="bg-gray-50 dark:bg-gray-700 rounded p-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Energy Impact Formula:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            energy_multiplier = 1 + (form_eff - 0.25) × 0.8<br>
                                            annual_energy = baseline × energy_multiplier
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Example: Form efficiency 0.35 = 108 kWh/m²/year vs 100 baseline</p>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Construction Cost Formula:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            cost_multiplier = 1 + (form_eff - 0.25) × 0.6<br>
                                            envelope_cost = baseline × cost_multiplier
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Example: Form efficiency 0.35 = $1,060/m² vs $1,000 baseline</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Structural Grid Impact on Material Usage</h4>
                            <div class="bg-gray-50 dark:bg-gray-700 rounded p-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Beam Depth Calculation:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            if span ≤ 8m: depth_factor = 1.0<br>
                                            if span > 8m: depth_factor = 1 + ((span-8)/8)^1.5
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Example: 10m span = 1.35× beam depth vs 8m span</p>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Material Impact:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            material_multiplier = depth_factor × 1.2<br>
                                            total_impact = material_multiplier × 1.1
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Example: 10m span = 1.78× total structural material</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Floor Height Impact on Building Volume</h4>
                            <div class="bg-gray-50 dark:bg-gray-700 rounded p-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Direct Volume Impact:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            volume_multiplier = actual_height / optimal_height<br>
                                            total_volume = floor_area × height
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Every 100mm adds 2-3% to total building carbon footprint</p>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Storey Efficiency:</h5>
                                        <div class="bg-gray-100 dark:bg-gray-600 rounded p-3 font-mono text-sm">
                                            floors_gained = (excess_height × floors) / typical_height<br>
                                            efficiency_loss = excess_height / total_height
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">Extra height reduces number of floors achievable in height limit</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Standards -->
                <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-4">
                        <i data-lucide="shield-check" class="h-5 w-5 mr-2 inline"></i>
                        Compliance Standards & Limits
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Building Code Compliance</h4>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                                <li>• <strong>Floor Heights:</strong> Minimum 2.4m ceiling height (NCC)</li>
                                <li>• <strong>Fire Safety:</strong> Maximum travel distances and egress widths</li>
                                <li>• <strong>Accessibility:</strong> AS 1428 compliance for universal access</li>
                                <li>• <strong>Structural:</strong> AS 1170 loading and AS 3600 concrete design</li>
                            </ul>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Sustainability Benchmarks</h4>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                                <li>• <strong>Green Star:</strong> Form efficiency TBD for points</li>
                                <li>• <strong>NABERS:</strong> Energy performance targeting 5+ stars</li>
                                <li>• <strong>Net Zero:</strong> Embodied carbon ≤ 500 kgCO₂e/m²</li>
                                <li>• <strong>LEED:</strong> Optimize energy performance criteria</li>
                            </ul>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 rounded p-4">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Industry Best Practice</h4>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                                <li>• <strong>Grid Spacing:</strong> 7.5-8.5m for structural efficiency</li>
                                <li>• <strong>Net-to-Gross:</strong> 80-85% for office buildings</li>
                                <li>• <strong>Service Runs:</strong> ≤ 25m for HVAC distribution</li>
                                <li>• <strong>Cantilevers:</strong> ≤ 2.5m without significant material penalty</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Risk Assessment Framework -->
                <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-red-800 dark:text-red-200 mb-4">
                        <i data-lucide="alert-triangle" class="h-5 w-5 mr-2 inline"></i>
                        Risk Assessment Framework
                    </h3>
                    
                    <div class="space-y-4">
                        <p class="text-red-700 dark:text-red-300">
                            The tool categorizes parameter values into three risk levels based on potential impact severity and compliance requirements:
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white dark:bg-gray-700 rounded p-4 border-l-4 border-green-500">
                                <h4 class="font-semibold text-green-700 dark:text-green-300 mb-2">✓ Optimal/Acceptable</h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Meets all compliance requirements</li>
                                    <li>• Follows industry best practices</li>
                                    <li>• Minimal additional costs or complexity</li>
                                    <li>• No action required</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 rounded p-4 border-l-4 border-yellow-500">
                                <h4 class="font-semibold text-yellow-700 dark:text-yellow-300 mb-2">⚠ Review Required</h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Meets minimum compliance</li>
                                    <li>• May impact efficiency or cost</li>
                                    <li>• Consider optimization opportunities</li>
                                    <li>• Document justification if retained</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 rounded p-4 border-l-4 border-red-500">
                                <h4 class="font-semibold text-red-700 dark:text-red-300 mb-2">⚠ High Risk</h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• May violate compliance requirements</li>
                                    <li>• Significant cost or carbon impact</li>
                                    <li>• Construction complexity issues</li>
                                    <li>• Redesign strongly recommended</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded p-4 mt-4">
                            <p class="text-sm text-yellow-800 dark:text-yellow-200">
                                <strong>Important:</strong> This tool provides guidance only. All designs should be validated by qualified professionals 
                                and detailed analysis before implementation. Local codes and project-specific requirements may override these recommendations.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BIM Integration Modal -->
    <div id="bimModal" class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300">
            <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-600 flex justify-between items-start">
                <div class="flex-1 pr-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100">BIM Integration & IFC Checks</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Connect design efficiency analysis with your BIM workflow</p>
                </div>
                <button id="closeBimModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0">
                    <i data-lucide="x-circle" class="h-6 w-6"></i>
                </button>
            </div>

            <div class="p-4 sm:p-6 space-y-6">
                <!-- BIM Integration Overview -->
                <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-6">
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-100 dark:bg-blue-800/50 rounded-lg p-3 flex-shrink-0">
                            <i data-lucide="box" class="h-8 w-8 text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2">Automated Parameter Extraction & Statistical Analysis</h3>
                            <p class="text-blue-700 dark:text-blue-300 mb-4">
                                Automatically extract design parameters from your IFC/Revit models, analyze statistical impacts, 
                                determine parameter significance, and check compliance with design limits.
                            </p>
                            <div class="bg-blue-100 dark:bg-blue-800/30 rounded p-3">
                                <p class="text-sm text-blue-800 dark:text-blue-200 font-medium mb-2">Supported BIM Software:</p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="bg-white dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-blue-700 dark:text-blue-300">Revit</span>
                                    <span class="bg-white dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-blue-700 dark:text-blue-300">ArchiCAD</span>
                                    <span class="bg-white dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-blue-700 dark:text-blue-300">Bentley AECOsim</span>
                                    <span class="bg-white dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-blue-700 dark:text-blue-300">Tekla Structures</span>
                                    <span class="bg-white dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-blue-700 dark:text-blue-300">IFC 2x3/4</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistical Analysis Features -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <i data-lucide="bar-chart-3" class="h-6 w-6 text-green-600 dark:text-green-400 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-green-800 dark:text-green-200">Statistical Impact Analysis</h4>
                                <p class="text-sm text-green-700 dark:text-green-300 mt-1">
                                    Quantify the impact of each parameter on cost, carbon, and construction time
                                </p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm text-green-700 dark:text-green-300">
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Parameter sensitivity analysis</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Monte Carlo simulation for uncertainty</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Multi-objective optimization scoring</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Correlation analysis between parameters</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <i data-lucide="target" class="h-6 w-6 text-purple-600 dark:text-purple-400 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-purple-800 dark:text-purple-200">Compliance Checking</h4>
                                <p class="text-sm text-purple-700 dark:text-purple-300 mt-1">
                                    Automatic verification against design standards and performance limits
                                </p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm text-purple-700 dark:text-purple-300">
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Building code compliance verification</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Sustainability benchmark comparisons</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Performance limit validation</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="check" class="h-4 w-4"></i>
                                <span>Risk assessment and flagging</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Code Examples Section -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">
                        <i data-lucide="code" class="h-5 w-5 mr-2 inline"></i>
                        BIM Integration Code Examples
                    </h3>
                    
                    <!-- Tab Navigation -->
                    <div class="flex space-x-1 mb-4 bg-gray-200 dark:bg-gray-600 rounded-lg p-1">
                        <button 
                            id="ifcTab" 
                            onclick="showCodeTab('ifc')"
                            class="code-tab flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors bg-white dark:bg-gray-500 text-gray-900 dark:text-gray-100"
                        >
                            IFC Extraction
                        </button>
                        <button 
                            id="revitTab" 
                            onclick="showCodeTab('revit')"
                            class="code-tab flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300"
                        >
                            Revit API
                        </button>
                        <button 
                            id="statisticsTab" 
                            onclick="showCodeTab('statistics')"
                            class="code-tab flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300"
                        >
                            Statistical Analysis
                        </button>
                    </div>

                    <!-- IFC Extraction Code -->
                    <div id="ifcCode" class="code-content">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">IFC Parameter Extraction (Python)</h4>
                        <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                            <pre class="text-green-400 text-sm"><code>import ifcopenshell
import numpy as np
from collections import defaultdict

class IFCEfficiencyAnalyzer:
    def __init__(self, ifc_file_path):
        self.model = ifcopenshell.open(ifc_file_path)
        self.parameters = {}
        self.statistical_data = defaultdict(list)
    
    def extract_building_form_efficiency(self):
        """Extract form efficiency (perimeter/area ratio) from IFC model"""
        # Get building storeys
        storeys = self.model.by_type('IfcBuildingStorey')
        
        total_perimeter = 0
        total_area = 0
        
        for storey in storeys:
            # Get spaces or slabs for each storey
            spaces = ifcopenshell.util.element.get_decomposition(storey)
            
            for space in spaces:
                if space.is_a('IfcSpace'):
                    # Extract space geometry
                    area = self._get_space_area(space)
                    perimeter = self._get_space_perimeter(space)
                    
                    total_area += area
                    total_perimeter += perimeter
                    
                    # Store for statistical analysis
                    self.statistical_data['space_areas'].append(area)
                    self.statistical_data['space_perimeters'].append(perimeter)
        
        # Calculate form efficiency
        form_efficiency = total_perimeter / total_area if total_area > 0 else 0
        
        self.parameters['form_efficiency'] = {
            'value': form_efficiency,
            'confidence': self._calculate_extraction_confidence('form'),
            'source_elements': len(storeys),
            'statistical_impact': self._analyze_form_impact(form_efficiency)
        }
        
        return form_efficiency
    
    def extract_structural_grid(self):
        """Extract structural grid spacing from columns and beams"""
        columns = self.model.by_type('IfcColumn')
        beams = self.model.by_type('IfcBeam')
        
        grid_spacings = []
        column_positions = []
        
        # Extract column positions
        for column in columns:
            pos = self._get_element_position(column)
            if pos:
                column_positions.append(pos)
        
        # Calculate grid spacings
        if len(column_positions) > 1:
            # Group columns by elevation
            columns_by_level = defaultdict(list)
            for pos in column_positions:
                level = round(pos[2], 1)  # Round Z coordinate
                columns_by_level[level].append(pos)
            
            # Calculate spacings for each level
            for level, positions in columns_by_level.items():
                if len(positions) > 1:
                    # Sort by X then Y coordinates
                    positions.sort(key=lambda p: (p[0], p[1]))
                    
                    # Calculate distances between adjacent columns
                    for i in range(len(positions) - 1):
                        dist = np.sqrt(
                            (positions[i+1][0] - positions[i][0])**2 + 
                            (positions[i+1][1] - positions[i][1])**2
                        )
                        if 3.0 <= dist <= 15.0:  # Reasonable grid spacing range
                            grid_spacings.append(dist)
        
        # Statistical analysis
        if grid_spacings:
            avg_spacing = np.mean(grid_spacings)
            std_spacing = np.std(grid_spacings)
            
            self.parameters['structural_grid'] = {
                'value': avg_spacing,
                'std_deviation': std_spacing,
                'sample_size': len(grid_spacings),
                'confidence': self._calculate_statistical_confidence(grid_spacings),
                'statistical_impact': self._analyze_grid_impact(avg_spacing, std_spacing)
            }
            
            return avg_spacing
        
        return None
    
    def extract_floor_heights(self):
        """Extract floor-to-floor heights with statistical analysis"""
        storeys = self.model.by_type('IfcBuildingStorey')
        floor_heights = []
        
        # Sort storeys by elevation
        storey_elevations = []
        for storey in storeys:
            elevation = self._get_storey_elevation(storey)
            if elevation is not None:
                storey_elevations.append(elevation)
        
        storey_elevations.sort()
        
        # Calculate floor-to-floor heights
        for i in range(len(storey_elevations) - 1):
            height = storey_elevations[i+1] - storey_elevations[i]
            if 2.5 <= height <= 6.0:  # Reasonable floor height range
                floor_heights.append(height)
        
        if floor_heights:
            avg_height = np.mean(floor_heights)
            std_height = np.std(floor_heights)
            
            # Analyze consistency and statistical significance
            coefficient_of_variation = std_height / avg_height if avg_height > 0 else 0
            
            self.parameters['floor_height'] = {
                'value': avg_height,
                'std_deviation': std_height,
                'coefficient_of_variation': coefficient_of_variation,
                'consistency_score': 1 - min(coefficient_of_variation, 0.2) / 0.2,
                'statistical_impact': self._analyze_height_impact(avg_height, std_height)
            }
            
            return avg_height
        
        return None
    
    def analyze_cantilevers(self):
        """Detect and analyze cantilever projections"""
        slabs = self.model.by_type('IfcSlab')
        columns = self.model.by_type('IfcColumn')
        
        cantilever_lengths = []
        
        for slab in slabs:
            # Get slab geometry and find unsupported edges
            slab_geometry = self._get_slab_geometry(slab)
            if slab_geometry:
                # Find maximum distance from any point to nearest column
                max_cantilever = self._calculate_max_cantilever(slab_geometry, columns)
                if max_cantilever > 1.0:  # Only consider significant cantilevers
                    cantilever_lengths.append(max_cantilever)
        
        if cantilever_lengths:
            max_cantilever = max(cantilever_lengths)
            avg_cantilever = np.mean(cantilever_lengths)
            
            self.parameters['cantilevers'] = {
                'max_value': max_cantilever,
                'average_value': avg_cantilever,
                'count': len(cantilever_lengths),
                'risk_assessment': 'high' if max_cantilever > 3.0 else 'medium' if max_cantilever > 2.0 else 'low',
                'statistical_impact': self._analyze_cantilever_impact(max_cantilever, cantilever_lengths)
            }
            
            return max_cantilever
        
        return 0
    
    def check_column_alignment(self):
        """Analyze vertical column alignment and transfer requirements"""
        columns = self.model.by_type('IfcColumn')
        
        # Group columns by level
        columns_by_level = defaultdict(list)
        for column in columns:
            level = self._get_element_level(column)
            position = self._get_element_position(column)
            if level and position:
                columns_by_level[level].append(position)
        
        # Analyze alignment between levels
        levels = sorted(columns_by_level.keys())
        alignment_score = 0
        total_columns = 0
        transfer_count = 0
        
        for i in range(len(levels) - 1):
            lower_level = levels[i]
            upper_level = levels[i + 1]
            
            aligned_count = self._count_aligned_columns(
                columns_by_level[lower_level],
                columns_by_level[upper_level],
                tolerance=1.5  # 1.5m alignment tolerance
            )
            
            upper_count = len(columns_by_level[upper_level])
            if upper_count > 0:
                level_alignment = aligned_count / upper_count
                alignment_score += level_alignment
                total_columns += upper_count
                
                # Count potential transfers
                if level_alignment < 0.8:  # Less than 80% aligned
                    transfer_count += 1
        
        overall_alignment = (alignment_score / (len(levels) - 1)) * 100 if len(levels) > 1 else 100
        
        self.parameters['column_stacking'] = {
            'alignment_percentage': overall_alignment,
            'transfer_levels': transfer_count,
            'total_levels': len(levels) - 1,
            'risk_assessment': 'low' if overall_alignment > 85 else 'medium' if overall_alignment > 70 else 'high',
            'statistical_impact': self._analyze_alignment_impact(overall_alignment, transfer_count)
        }
        
        return overall_alignment
    
    def analyze_mep_efficiency(self):
        """Analyze MEP system distribution efficiency"""
        # Get MEP elements
        hvac_elements = (self.model.by_type('IfcDuctSegment') + 
                        self.model.by_type('IfcPipeSegment') + 
                        self.model.by_type('IfcCableCarrierSegment'))
        
        equipment_rooms = self._find_equipment_rooms()
        
        if not equipment_rooms or not hvac_elements:
            return None
        
        # Calculate service run distances
        max_distances = []
        for room in equipment_rooms:
            room_pos = self._get_room_position(room)
            max_dist = self._calculate_max_service_distance(room_pos, hvac_elements)
            if max_dist:
                max_distances.append(max_dist)
        
        if max_distances:
            max_service_run = max(max_distances)
            avg_service_run = np.mean(max_distances)
            
            self.parameters['service_runs'] = {
                'max_distance': max_service_run,
                'average_distance': avg_service_run,
                'equipment_rooms': len(equipment_rooms),
                'efficiency_score': max(0, 100 - (max_service_run - 20) * 5),  # Score decreases after 20m
                'statistical_impact': self._analyze_mep_impact(max_service_run, avg_service_run)
            }
            
            return max_service_run
        
        return None
    
    def generate_comprehensive_report(self):
        """Generate comprehensive statistical analysis report"""
        report = {
            'extraction_summary': {
                'total_parameters': len(self.parameters),
                'extraction_confidence': np.mean([
                    p.get('confidence', 0) for p in self.parameters.values()
                ]),
                'model_completeness': self._assess_model_completeness()
            },
            'statistical_analysis': {},
            'compliance_check': {},
            'recommendations': []
        }
        
        # Statistical analysis for each parameter
        for param_name, param_data in self.parameters.items():
            if 'statistical_impact' in param_data:
                report['statistical_analysis'][param_name] = param_data['statistical_impact']
        
        # Compliance checking
        report['compliance_check'] = self._check_all_compliance()
        
        # Generate recommendations
        report['recommendations'] = self._generate_recommendations()
        
        return report
    
    # Helper methods for statistical analysis
    def _analyze_form_impact(self, form_efficiency):
        """Analyze statistical impact of form efficiency"""
        baseline_energy = 100  # kWh/m²/year baseline
        baseline_cost = 1000   # $/m² baseline construction cost
        
        # Form efficiency impact on energy (exponential relationship)
        energy_multiplier = 1 + (form_efficiency - 0.25) * 0.8
        energy_impact = baseline_energy * energy_multiplier
        
        # Form efficiency impact on cost (linear relationship for envelope)
        envelope_cost_multiplier = 1 + (form_efficiency - 0.25) * 0.6
        cost_impact = baseline_cost * envelope_cost_multiplier
        
        return {
            'energy_consumption': energy_impact,
            'construction_cost': cost_impact,
            'envelope_area_multiplier': envelope_cost_multiplier,
            'significance': 'high' if abs(form_efficiency - 0.25) > 0.05 else 'medium',
            'confidence_interval': self._calculate_confidence_interval(form_efficiency, 0.02)
        }
    
    def _analyze_grid_impact(self, avg_spacing, std_deviation):
        """Analyze statistical impact of structural grid spacing"""
        # Beam depth increases exponentially with span
        if avg_spacing <= 8:
            beam_depth_factor = 1.0
        else:
            beam_depth_factor = 1.0 + ((avg_spacing - 8) / 8) ** 1.5
        
        # Material quantity impact
        material_multiplier = beam_depth_factor * 1.2  # Account for increased steel/concrete
        cost_multiplier = material_multiplier * 1.1    # Labor inefficiency factor
        
        # Construction time impact
        time_multiplier = 1.0 + (beam_depth_factor - 1.0) * 0.5
        
        return {
            'beam_depth_factor': beam_depth_factor,
            'material_quantity_multiplier': material_multiplier,
            'cost_multiplier': cost_multiplier,
            'construction_time_multiplier': time_multiplier,
            'variability_impact': std_deviation / avg_spacing,  # Coefficient of variation
            'significance': 'high' if avg_spacing > 9 or std_deviation > 1.5 else 'medium'
        }
    
    def _check_all_compliance(self):
        """Check compliance with all relevant standards"""
        compliance = {}
        
        # Building code compliance
        compliance['building_code'] = {}
        if 'floor_height' in self.parameters:
            height = self.parameters['floor_height']['value']
            compliance['building_code']['minimum_height'] = {
                'value': height,
                'requirement': 2.4,  # Minimum ceiling height
                'compliant': height >= 2.4,
                'margin': height - 2.4
            }
        
        # Sustainability benchmarks
        compliance['sustainability'] = {}
        if 'form_efficiency' in self.parameters:
            form_eff = self.parameters['form_efficiency']['value']
            # Green building standards typically require form efficiency < 0.30
            compliance['sustainability']['form_efficiency'] = {
                'value': form_eff,
                'green_building_target': 0.30,
                'compliant': form_eff <= 0.30,
                'performance_level': 'excellent' if form_eff <= 0.25 else 'good' if form_eff <= 0.30 else 'needs_improvement'
            }
        
        # Structural efficiency limits
        compliance['structural'] = {}
        if 'structural_grid' in self.parameters:
            grid = self.parameters['structural_grid']['value']
            compliance['structural']['grid_efficiency'] = {
                'value': grid,
                'optimal_range': [7.5, 8.5],
                'compliant': 7.5 <= grid <= 8.5,
                'efficiency_rating': self._calculate_grid_efficiency_rating(grid)
            }
        
        return compliance
    
    def _generate_recommendations(self):
        """Generate specific recommendations based on analysis"""
        recommendations = []
        
        # Form efficiency recommendations
        if 'form_efficiency' in self.parameters:
            form_eff = self.parameters['form_efficiency']['value']
            impact = self.parameters['form_efficiency']['statistical_impact']
            
            if form_eff > 0.30:
                recommendations.append({
                    'parameter': 'form_efficiency',
                    'priority': 'high',
                    'issue': f'Form efficiency ({form_eff:.3f}) exceeds recommended limit (0.30)',
                    'impact': f'Estimated {impact["energy_consumption"]:.0f} kWh/m²/year energy consumption',
                    'action': 'Simplify building form by consolidating projections and creating more rectangular shapes',
                    'potential_savings': {
                        'energy': f'{(impact["energy_consumption"] - 100):.0f} kWh/m²/year reduction possible',
                        'cost': f'{(impact["construction_cost"] - 1000):.0f} $/m² construction cost reduction'
                    }
                })
        
        # Structural grid recommendations
        if 'structural_grid' in self.parameters:
            grid = self.parameters['structural_grid']['value']
            impact = self.parameters['structural_grid']['statistical_impact']
            
            if grid > 9.0:
                recommendations.append({
                    'parameter': 'structural_grid',
                    'priority': 'medium',
                    'issue': f'Grid spacing ({grid:.1f}m) requires deep structural elements',
                    'impact': f'{impact["material_quantity_multiplier"]:.1f}x material usage increase',
                    'action': 'Add intermediate columns or consider post-tensioned solutions',
                    'potential_savings': {
                        'material': f'{(impact["material_quantity_multiplier"] - 1) * 100:.0f}% material reduction possible',
                        'cost': f'{(impact["cost_multiplier"] - 1) * 100:.0f}% cost reduction with optimal grid'
                    }
                })
        
        # Column alignment recommendations
        if 'column_stacking' in self.parameters:
            alignment = self.parameters['column_stacking']['alignment_percentage']
            transfers = self.parameters['column_stacking']['transfer_levels']
            
            if alignment < 80:
                recommendations.append({
                    'parameter': 'column_stacking',
                    'priority': 'high',
                    'issue': f'Poor column alignment ({alignment:.0f}%) requiring {transfers} transfer structures',
                    'impact': f'Each transfer adds ~200% more structural material locally',
                    'action': 'Realign columns vertically or accept program constraints with transfer beams',
                    'potential_savings': {
                        'material': f'{transfers * 200}% local material reduction by eliminating transfers',
                        'construction': 'Significant simplification of construction sequence'
                    }
                })
        
        return recommendations

# Example usage
def analyze_ifc_model(file_path):
    analyzer = IFCEfficiencyAnalyzer(file_path)
    
    # Extract all parameters
    analyzer.extract_building_form_efficiency()
    analyzer.extract_structural_grid()
    analyzer.extract_floor_heights()
    analyzer.analyze_cantilevers()
    analyzer.check_column_alignment()
    analyzer.analyze_mep_efficiency()
    
    # Generate comprehensive report
    report = analyzer.generate_comprehensive_report()
    
    return analyzer.parameters, report</code></pre>
                        </div>
                    </div>

                    <!-- Revit API Code -->
                    <div id="revitCode" class="code-content hidden">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Revit API Parameter Extraction (C#)</h4>
                        <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                            <pre class="text-green-400 text-sm"><code>using Autodesk.Revit.DB;
using Autodesk.Revit.UI;
using System;
using System.Collections.Generic;
using System.Linq;

public class RevitEfficiencyAnalyzer
{
    private Document doc;
    private Dictionary<string, ParameterAnalysis> parameters;
    
    public class ParameterAnalysis
    {
        public double Value { get; set; }
        public double Confidence { get; set; }
        public string Significance { get; set; }
        public Dictionary<string, double> StatisticalImpact { get; set; }
        public bool PassesLimit { get; set; }
        public string ComplianceStatus { get; set; }
    }
    
    public RevitEfficiencyAnalyzer(Document document)
    {
        doc = document;
        parameters = new Dictionary<string, ParameterAnalysis>();
    }
    
    public ParameterAnalysis AnalyzeFormEfficiency()
    {
        // Get all floors/levels
        FilteredElementCollector floorCollector = new FilteredElementCollector(doc)
            .OfCategory(BuiltInCategory.OST_Floors);
        
        double totalArea = 0;
        double totalPerimeter = 0;
        List<double> floorAreas = new List<double>();
        List<double> floorPerimeters = new List<double>();
        
        foreach (Floor floor in floorCollector)
        {
            // Get floor geometry
            Options geometryOptions = new Options();
            GeometryElement geometryElement = floor.get_Geometry(geometryOptions);
            
            double floorArea = 0;
            double floorPerimeter = 0;
            
            foreach (GeometryObject geometryObject in geometryElement)
            {
                if (geometryObject is Solid solid && solid.Volume > 0)
                {
                    // Calculate area and perimeter from solid faces
                    foreach (Face face in solid.Faces)
                    {
                        if (IsHorizontalFace(face))
                        {
                            floorArea += face.Area;
                            floorPerimeter += CalculatePerimeter(face);
                        }
                    }
                }
            }
            
            if (floorArea > 0)
            {
                totalArea += floorArea;
                totalPerimeter += floorPerimeter;
                floorAreas.Add(floorArea);
                floorPerimeters.Add(floorPerimeter);
            }
        }
        
        double formEfficiency = totalArea > 0 ? totalPerimeter / totalArea : 0;
        
        // Statistical analysis
        var analysis = new ParameterAnalysis
        {
            Value = formEfficiency,
            Confidence = CalculateExtractionConfidence(floorAreas.Count),
            Significance = DetermineSignificance(formEfficiency, 0.25, 0.05),
            StatisticalImpact = CalculateFormEfficiencyImpact(formEfficiency),
            PassesLimit = formEfficiency <= 0.30,
            ComplianceStatus = formEfficiency <= 0.25 ? "Optimal" : 
                              formEfficiency <= 0.30 ? "Acceptable" : "Exceeds Limit"
        };
        
        parameters["form_efficiency"] = analysis;
        return analysis;
    }
    
    public ParameterAnalysis AnalyzeStructuralGrid()
    {
        // Get all structural columns
        FilteredElementCollector columnCollector = new FilteredElementCollector(doc)
            .OfCategory(BuiltInCategory.OST_StructuralColumns);
        
        List<XYZ> columnPositions = new List<XYZ>();
        List<double> gridSpacings = new List<double>();
        
        foreach (FamilyInstance column in columnCollector)
        {
            LocationPoint location = column.Location as LocationPoint;
            if (location != null)
            {
                columnPositions.Add(location.Point);
            }
        }
        
        // Calculate grid spacings
        if (columnPositions.Count > 1)
        {
            // Group columns by level (Z coordinate)
            var columnsByLevel = columnPositions
                .GroupBy(p => Math.Round(p.Z, 1))
                .Where(g => g.Count() > 1);
            
            foreach (var levelGroup in columnsByLevel)
            {
                var positions = levelGroup.OrderBy(p => p.X).ThenBy(p => p.Y).ToList();
                
                for (int i = 0; i < positions.Count - 1; i++)
                {
                    double distance = positions[i].DistanceTo(positions[i + 1]);
                    if (distance >= 3.0 && distance <= 15.0) // Reasonable grid spacing
                    {
                        gridSpacings.Add(distance);
                    }
                }
            }
        }
        
        if (gridSpacings.Count > 0)
        {
            double avgSpacing = gridSpacings.Average();
            double stdDev = CalculateStandardDeviation(gridSpacings);
            
            var analysis = new ParameterAnalysis
            {
                Value = avgSpacing,
                Confidence = CalculateStatisticalConfidence(gridSpacings.Count, stdDev / avgSpacing),
                Significance = DetermineSignificance(avgSpacing, 7.75, 1.0),
                StatisticalImpact = CalculateGridSpacingImpact(avgSpacing, stdDev),
                PassesLimit = avgSpacing <= 9.0,
                ComplianceStatus = avgSpacing <= 8.0 ? "Optimal" : 
                                  avgSpacing <= 9.0 ? "Acceptable" : "Exceeds Recommended"
            };
            
            parameters["structural_grid"] = analysis;
            return analysis;
        }
        
        return null;
    }
    
    public ParameterAnalysis AnalyzeFloorHeights()
    {
        // Get all levels
        FilteredElementCollector levelCollector = new FilteredElementCollector(doc)
            .OfClass(typeof(Level));
        
        List<double> elevations = new List<double>();
        List<double> floorHeights = new List<double>();
        
        foreach (Level level in levelCollector)
        {
            elevations.Add(level.Elevation);
        }
        
        elevations.Sort();
        
        // Calculate floor-to-floor heights
        for (int i = 0; i < elevations.Count - 1; i++)
        {
            double height = elevations[i + 1] - elevations[i];
            if (height >= 2.5 && height <= 6.0) // Reasonable range
            {
                floorHeights.Add(height);
            }
        }
        
        if (floorHeights.Count > 0)
        {
            double avgHeight = floorHeights.Average();
            double stdDev = CalculateStandardDeviation(floorHeights);
            double coefficientOfVariation = stdDev / avgHeight;
            
            var analysis = new ParameterAnalysis
            {
                Value = avgHeight,
                Confidence = 1.0 - Math.Min(coefficientOfVariation, 0.2) / 0.2,
                Significance = DetermineHeightSignificance(avgHeight),
                StatisticalImpact = CalculateHeightImpact(avgHeight, stdDev),
                PassesLimit = avgHeight <= 4.0,
                ComplianceStatus = avgHeight <= 3.2 ? "Optimal" : 
                                  avgHeight <= 4.0 ? "Acceptable" : "Exceeds Efficient Range"
            };
            
            parameters["floor_height"] = analysis;
            return analysis;
        }
        
        return null;
    }
    
    public ParameterAnalysis AnalyzeCantilevers()
    {
        // Get structural framing and identify cantilevers
        FilteredElementCollector beamCollector = new FilteredElementCollector(doc)
            .OfCategory(BuiltInCategory.OST_StructuralFraming);
        
        List<double> cantileverLengths = new List<double>();
        
        foreach (FamilyInstance beam in beamCollector)
        {
            // Analyze beam support conditions
            double cantileverLength = AnalyzeBeamCantilever(beam);
            if (cantileverLength > 1.0) // Significant cantilever
            {
                cantileverLengths.Add(cantileverLength);
            }
        }
        
        // Also check floor slabs for cantilevers
        FilteredElementCollector floorCollector = new FilteredElementCollector(doc)
            .OfCategory(BuiltInCategory.OST_Floors);
        
        foreach (Floor floor in floorCollector)
        {
            double maxCantilever = AnalyzeFloorCantilever(floor);
            if (maxCantilever > 1.0)
            {
                cantileverLengths.Add(maxCantilever);
            }
        }
        
        double maxCantilever = cantileverLengths.Count > 0 ? cantileverLengths.Max() : 0;
        
        var analysis = new ParameterAnalysis
        {
            Value = maxCantilever,
            Confidence = CalculateGeometricConfidence(cantileverLengths.Count),
            Significance = maxCantilever > 2.0 ? "High" : maxCantilever > 1.0 ? "Medium" : "Low",
            StatisticalImpact = CalculateCantileverImpact(maxCantilever, cantileverLengths),
            PassesLimit = maxCantilever <= 2.5,
            ComplianceStatus = maxCantilever <= 1.5 ? "Optimal" : 
                              maxCantilever <= 2.5 ? "Acceptable" : "Structural Risk"
        };
        
        parameters["cantilevers"] = analysis;
        return analysis;
    }
    
    // Statistical Impact Calculation Methods
    private Dictionary<string, double> CalculateFormEfficiencyImpact(double formEfficiency)
    {
        double baselineEnergy = 100; // kWh/m²/year
        double baselineCost = 1000;  // $/m²
        
        double energyMultiplier = 1 + (formEfficiency - 0.25) * 0.8;
        double costMultiplier = 1 + (formEfficiency - 0.25) * 0.6;
        
        return new Dictionary<string, double>
        {
            ["energy_impact"] = baselineEnergy * energyMultiplier,
            ["cost_impact"] = baselineCost * costMultiplier,
            ["envelope_multiplier"] = costMultiplier,
            ["carbon_impact"] = CalculateCarbonImpact(energyMultiplier, costMultiplier)
        };
    }
    
    private Dictionary<string, double> CalculateGridSpacingImpact(double spacing, double stdDev)
    {
        double beamDepthFactor = spacing <= 8 ? 1.0 : 1.0 + Math.Pow((spacing - 8) / 8, 1.5);
        double materialMultiplier = beamDepthFactor * 1.2;
        double costMultiplier = materialMultiplier * 1.1;
        double timeMultiplier = 1.0 + (beamDepthFactor - 1.0) * 0.5;
        
        return new Dictionary<string, double>
        {
            ["beam_depth_factor"] = beamDepthFactor,
            ["material_multiplier"] = materialMultiplier,
            ["cost_multiplier"] = costMultiplier,
            ["time_multiplier"] = timeMultiplier,
            ["variability_coefficient"] = stdDev / spacing
        };
    }
    
    // Compliance Checking Methods
    public Dictionary<string, object> CheckAllCompliance()
    {
        var compliance = new Dictionary<string, object>();
        
        // Building code compliance
        var buildingCodeCompliance = new Dictionary<string, object>();
        if (parameters.ContainsKey("floor_height"))
        {
            var height = parameters["floor_height"];
            buildingCodeCompliance["minimum_height"] = new
            {
                value = height.Value,
                requirement = 2.4,
                compliant = height.Value >= 2.4,
                margin = height.Value - 2.4
            };
        }
        compliance["building_code"] = buildingCodeCompliance;
        
        // Sustainability benchmarks
        var sustainabilityCompliance = new Dictionary<string, object>();
        if (parameters.ContainsKey("form_efficiency"))
        {
            var formEff = parameters["form_efficiency"];
            sustainabilityCompliance["form_efficiency"] = new
            {
                value = formEff.Value,
                green_building_target = 0.30,
                compliant = formEff.Value <= 0.30,
                performance_level = formEff.Value <= 0.25 ? "excellent" : 
                                   formEff.Value <= 0.30 ? "good" : "needs_improvement"
            };
        }
        compliance["sustainability"] = sustainabilityCompliance;
        
        // Structural efficiency
        var structuralCompliance = new Dictionary<string, object>();
        if (parameters.ContainsKey("structural_grid"))
        {
            var grid = parameters["structural_grid"];
            structuralCompliance["grid_efficiency"] = new
            {
                value = grid.Value,
                optimal_range = new[] { 7.5, 8.5 },
                compliant = grid.Value >= 7.5 && grid.Value <= 8.5,
                efficiency_rating = CalculateGridEfficiencyRating(grid.Value)
            };
        }
        compliance["structural"] = structuralCompliance;
        
        return compliance;
    }
    
    public List<object> GenerateRecommendations()
    {
        var recommendations = new List<object>();
        
        foreach (var param in parameters)
        {
            if (!param.Value.PassesLimit)
            {
                var recommendation = new
                {
                    parameter = param.Key,
                    priority = param.Value.Significance.ToLower(),
                    current_value = param.Value.Value,
                    compliance_status = param.Value.ComplianceStatus,
                    statistical_impact = param.Value.StatisticalImpact,
                    action_required = GetActionRecommendation(param.Key, param.Value)
                };
                
                recommendations.Add(recommendation);
            }
        }
        
        return recommendations;
    }
    
    // Helper methods for geometry analysis and calculations would be implemented here
    // ... (Additional implementation details)
}</code></pre>
                        </div>
                    </div>

                    <!-- Statistical Analysis Code -->
                    <div id="statisticsCode" class="code-content hidden">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Statistical Analysis & Significance Testing (Python)</h4>
                        <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                            <pre class="text-green-400 text-sm"><code>import numpy as np
import pandas as pd
from scipy import stats
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

class ParameterStatisticalAnalyzer:
    def __init__(self):
        self.parameter_database = None
        self.benchmark_data = None
        self.load_benchmark_data()
    
    def load_benchmark_data(self):
        """Load benchmark data from industry standards and completed projects"""
        # Example benchmark data structure
        self.benchmark_data = {
            'form_efficiency': {
                'optimal': {'mean': 0.22, 'std': 0.02, 'n': 150},
                'acceptable': {'mean': 0.27, 'std': 0.03, 'n': 300},
                'poor': {'mean': 0.35, 'std': 0.05, 'n': 100}
            },
            'structural_grid': {
                'optimal': {'mean': 7.8, 'std': 0.3, 'n': 200},
                'acceptable': {'mean': 8.5, 'std': 0.8, 'n': 250},
                'poor': {'mean': 10.2, 'std': 1.5, 'n': 80}
            },
            # Add more parameters...
        }
    
    def calculate_parameter_significance(self, parameter_name, observed_value, 
                                       project_context=None):
        """
        Calculate statistical significance of a parameter value
        using industry benchmarks and project-specific context
        """
        if parameter_name not in self.benchmark_data:
            return None
        
        benchmark = self.benchmark_data[parameter_name]
        
        # Determine which benchmark category the value falls into
        category = self._classify_parameter_value(parameter_name, observed_value)
        
        # Calculate z-score relative to benchmark
        benchmark_stats = benchmark[category]
        z_score = (observed_value - benchmark_stats['mean']) / benchmark_stats['std']
        
        # Calculate p-value (two-tailed test)
        p_value = 2 * (1 - stats.norm.cdf(abs(z_score)))
        
        # Determine significance level
        if p_value < 0.01:
            significance = "Highly Significant"
        elif p_value < 0.05:
            significance = "Significant"
        elif p_value < 0.10:
            significance = "Marginally Significant"
        else:
            significance = "Not Significant"
        
        # Calculate confidence intervals
        confidence_95 = stats.norm.interval(0.95, 
                                          loc=benchmark_stats['mean'],
                                          scale=benchmark_stats['std'])
        
        # Effect size (Cohen's d)
        effect_size = abs(z_score)
        effect_interpretation = self._interpret_effect_size(effect_size)
        
        return {
            'observed_value': observed_value,
            'benchmark_category': category,
            'z_score': z_score,
            'p_value': p_value,
            'significance': significance,
            'confidence_interval_95': confidence_95,
            'effect_size': effect_size,
            'effect_interpretation': effect_interpretation,
            'sample_size': benchmark_stats['n']
        }
    
    def analyze_multi_parameter_correlation(self, project_parameters):
        """
        Analyze correlations between multiple parameters and their
        combined impact on cost, carbon, and construction time
        """
        # Create feature matrix
        feature_names = list(project_parameters.keys())
        X = np.array([list(project_parameters.values())])
        
        # Load historical project data for correlation analysis
        historical_data = self._load_historical_project_data()
        
        if historical_data is None:
            return self._simplified_correlation_analysis(project_parameters)
        
        # Fit random forest model to understand feature importance
        rf_cost = RandomForestRegressor(n_estimators=100, random_state=42)
        rf_carbon = RandomForestRegressor(n_estimators=100, random_state=42)
        rf_time = RandomForestRegressor(n_estimators=100, random_state=42)
        
        X_hist = historical_data[feature_names].values
        y_cost = historical_data['cost_per_sqm'].values
        y_carbon = historical_data['carbon_intensity'].values
        y_time = historical_data['construction_months'].values
        
        # Fit models
        rf_cost.fit(X_hist, y_cost)
        rf_carbon.fit(X_hist, y_carbon)
        rf_time.fit(X_hist, y_time)
        
        # Get feature importance
        cost_importance = dict(zip(feature_names, rf_cost.feature_importances_))
        carbon_importance = dict(zip(feature_names, rf_carbon.feature_importances_))
        time_importance = dict(zip(feature_names, rf_time.feature_importances_))
        
        # Predict impact for current project
        predicted_cost = rf_cost.predict(X)[0]
        predicted_carbon = rf_carbon.predict(X)[0]
        predicted_time = rf_time.predict(X)[0]
        
        # Calculate correlation matrix
        correlation_matrix = historical_data[feature_names].corr()
        
        return {
            'feature_importance': {
                'cost': cost_importance,
                'carbon': carbon_importance,
                'time': time_importance
            },
            'predicted_outcomes': {
                'cost_per_sqm': predicted_cost,
                'carbon_intensity': predicted_carbon,
                'construction_months': predicted_time
            },
            'parameter_correlations': correlation_matrix.to_dict(),
            'key_insights': self._generate_correlation_insights(
                correlation_matrix, cost_importance, carbon_importance
            )
        }
    
    def perform_sensitivity_analysis(self, base_parameters, target_outcomes):
        """
        Perform sensitivity analysis to determine which parameters
        have the highest impact on target outcomes
        """
        sensitivity_results = {}
        
        for param_name, base_value in base_parameters.items():
            # Test parameter variations (±10%, ±20%)
            variations = [-0.2, -0.1, 0, 0.1, 0.2]
            outcomes = []
            
            for variation in variations:
                modified_params = base_parameters.copy()
                modified_params[param_name] = base_value * (1 + variation)
                
                # Calculate impacts for modified parameters
                impact = self._calculate_total_impact(modified_params)
                outcomes.append(impact)
            
            # Calculate sensitivity (slope of response)
            param_variations = [base_value * (1 + v) for v in variations]
            
            sensitivity_results[param_name] = {
                'cost_sensitivity': self._calculate_sensitivity(param_variations, 
                                                               [o['cost'] for o in outcomes]),
                'carbon_sensitivity': self._calculate_sensitivity(param_variations,
                                                                [o['carbon'] for o in outcomes]),
                'time_sensitivity': self._calculate_sensitivity(param_variations,
                                                              [o['time'] for o in outcomes]),
                'overall_sensitivity': self._calculate_overall_sensitivity(outcomes)
            }
        
        # Rank parameters by sensitivity
        sensitivity_ranking = self._rank_parameters_by_sensitivity(sensitivity_results)
        
        return {
            'sensitivity_analysis': sensitivity_results,
            'parameter_ranking': sensitivity_ranking,
            'top_3_most_sensitive': sensitivity_ranking[:3],
            'recommendations': self._generate_sensitivity_recommendations(sensitivity_ranking)
        }
    
    def check_parameter_compliance_limits(self, parameters, building_type, 
                                        project_context=None):
        """
        Check if parameters pass current design limits and standards
        """
        # Define compliance limits based on building type and standards
        compliance_limits = self._get_compliance_limits(building_type)
        
        compliance_results = {}
        
        for param_name, value in parameters.items():
            if param_name in compliance_limits:
                limits = compliance_limits[param_name]
                
                # Check against multiple standards
                standard_checks = {}
                
                for standard_name, limit_values in limits.items():
                    if 'min' in limit_values and 'max' in limit_values:
                        passes = limit_values['min'] <= value <= limit_values['max']
                        margin = min(value - limit_values['min'], 
                                   limit_values['max'] - value)
                    elif 'max' in limit_values:
                        passes = value <= limit_values['max']
                        margin = limit_values['max'] - value
                    elif 'min' in limit_values:
                        passes = value >= limit_values['min']
                        margin = value - limit_values['min']
                    else:
                        passes = None
                        margin = None
                    
                    standard_checks[standard_name] = {
                        'passes': passes,
                        'margin': margin,
                        'limit_values': limit_values,
                        'severity': self._assess_violation_severity(margin, passes)
                    }
                
                # Overall compliance assessment
                overall_compliance = all(check['passes'] for check in standard_checks.values() 
                                       if check['passes'] is not None)
                
                compliance_results[param_name] = {
                    'value': value,
                    'overall_compliant': overall_compliance,
                    'standard_checks': standard_checks,
                    'worst_violation': self._find_worst_violation(standard_checks),
                    'compliance_score': self._calculate_compliance_score(standard_checks)
                }
        
        # Generate compliance summary
        total_parameters = len(compliance_results)
        compliant_parameters = sum(1 for r in compliance_results.values() 
                                 if r['overall_compliant'])
        
        compliance_summary = {
            'total_parameters_checked': total_parameters,
            'compliant_parameters': compliant_parameters,
            'compliance_rate': compliant_parameters / total_parameters if total_parameters > 0 else 0,
            'critical_violations': [name for name, result in compliance_results.items()
                                  if not result['overall_compliant'] and 
                                     result['worst_violation']['severity'] == 'critical'],
            'overall_assessment': self._assess_overall_compliance(compliance_results)
        }
        
        return {
            'parameter_compliance': compliance_results,
            'compliance_summary': compliance_summary,
            'recommendations': self._generate_compliance_recommendations(compliance_results)
        }
    
    def monte_carlo_uncertainty_analysis(self, parameters, num_simulations=1000):
        """
        Perform Monte Carlo simulation to assess uncertainty in outcomes
        based on parameter variations and measurement uncertainty
        """
        # Define parameter uncertainty distributions
        param_distributions = {}
        for param_name, value in parameters.items():
            # Assume normal distribution with 5% coefficient of variation
            std_dev = value * 0.05
            param_distributions[param_name] = stats.norm(loc=value, scale=std_dev)
        
        # Run Monte Carlo simulation
        simulation_results = []
        
        for i in range(num_simulations):
            # Sample parameter values
            sampled_params = {}
            for param_name, distribution in param_distributions.items():
                sampled_params[param_name] = distribution.rvs()
            
            # Calculate outcomes for sampled parameters
            outcome = self._calculate_total_impact(sampled_params)
            simulation_results.append(outcome)
        
        # Analyze simulation results
        cost_values = [r['cost'] for r in simulation_results]
        carbon_values = [r['carbon'] for r in simulation_results]
        time_values = [r['time'] for r in simulation_results]
        
        uncertainty_analysis = {
            'cost_statistics': {
                'mean': np.mean(cost_values),
                'std': np.std(cost_values),
                'confidence_95': np.percentile(cost_values, [2.5, 97.5]),
                'coefficient_of_variation': np.std(cost_values) / np.mean(cost_values)
            },
            'carbon_statistics': {
                'mean': np.mean(carbon_values),
                'std': np.std(carbon_values),
                'confidence_95': np.percentile(carbon_values, [2.5, 97.5]),
                'coefficient_of_variation': np.std(carbon_values) / np.mean(carbon_values)
            },
            'time_statistics': {
                'mean': np.mean(time_values),
                'std': np.std(time_values),
                'confidence_95': np.percentile(time_values, [2.5, 97.5]),
                'coefficient_of_variation': np.std(time_values) / np.mean(time_values)
            },
            'risk_assessment': self._assess_uncertainty_risk(cost_values, carbon_values, time_values)
        }
        
        return uncertainty_analysis
    
    def generate_optimization_recommendations(self, current_parameters, 
                                            optimization_targets):
        """
        Generate specific recommendations for parameter optimization
        based on statistical analysis and target priorities
        """
        # Analyze current parameter performance
        current_impacts = self._calculate_total_impact(current_parameters)
        
        # Identify optimization opportunities
        opportunities = []
        
        for param_name, current_value in current_parameters.items():
            # Get parameter significance
            significance = self.calculate_parameter_significance(param_name, current_value)
            
            if significance and significance['significance'] in ['Significant', 'Highly Significant']:
                # Calculate potential improvement
                optimal_value = self._get_optimal_value(param_name)
                improved_params = current_parameters.copy()
                improved_params[param_name] = optimal_value
                improved_impacts = self._calculate_total_impact(improved_params)
                
                # Calculate benefit
                cost_saving = current_impacts['cost'] - improved_impacts['cost']
                carbon_reduction = current_impacts['carbon'] - improved_impacts['carbon']
                time_saving = current_impacts['time'] - improved_impacts['time']
                
                opportunities.append({
                    'parameter': param_name,
                    'current_value': current_value,
                    'optimal_value': optimal_value,
                    'improvement_required': abs(optimal_value - current_value),
                    'benefits': {
                        'cost_saving': cost_saving,
                        'carbon_reduction': carbon_reduction,
                        'time_saving': time_saving
                    },
                    'priority_score': self._calculate_priority_score(
                        cost_saving, carbon_reduction, time_saving, optimization_targets
                    ),
                    'implementation_difficulty': self._assess_implementation_difficulty(param_name),
                    'statistical_significance': significance['significance']
                })
        
        # Sort by priority score
        opportunities.sort(key=lambda x: x['priority_score'], reverse=True)
        
        return {
            'optimization_opportunities': opportunities,
            'top_3_recommendations': opportunities[:3],
            'quick_wins': [opp for opp in opportunities 
                          if opp['implementation_difficulty'] == 'Low' and opp['priority_score'] > 0.7],
            'total_potential_savings': self._calculate_total_potential_savings(opportunities)
        }

# Example usage
def analyze_project_statistically(parameters, building_type="office"):
    analyzer = ParameterStatisticalAnalyzer()
    
    # Statistical significance analysis
    significance_results = {}
    for param_name, value in parameters.items():
        significance = analyzer.calculate_parameter_significance(param_name, value)
        if significance:
            significance_results[param_name] = significance
    
    # Multi-parameter correlation analysis
    correlation_analysis = analyzer.analyze_multi_parameter_correlation(parameters)
    
    # Sensitivity analysis
    sensitivity_analysis = analyzer.perform_sensitivity_analysis(
        parameters, ['cost', 'carbon', 'time']
    )
    
    # Compliance checking
    compliance_check = analyzer.check_parameter_compliance_limits(
        parameters, building_type
    )
    
    # Uncertainty analysis
    uncertainty_analysis = analyzer.monte_carlo_uncertainty_analysis(parameters)
    
    # Optimization recommendations
    optimization_targets = {'cost': 0.4, 'carbon': 0.4, 'time': 0.2}  # Weightings
    optimization_recs = analyzer.generate_optimization_recommendations(
        parameters, optimization_targets
    )
    
    return {
        'significance_analysis': significance_results,
        'correlation_analysis': correlation_analysis,
        'sensitivity_analysis': sensitivity_analysis,
        'compliance_check': compliance_check,
        'uncertainty_analysis': uncertainty_analysis,
        'optimization_recommendations': optimization_recs
    }</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Implementation Guide -->
                <div class="bg-orange-50 dark:bg-orange-900/30 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-orange-800 dark:text-orange-200 mb-4">
                        <i data-lucide="tool" class="h-5 w-5 mr-2 inline"></i>
                        Implementation Guide
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-orange-800 dark:text-orange-200 mb-2">Getting Started</h4>
                            <ol class="list-decimal list-inside text-sm text-orange-700 dark:text-orange-300 space-y-1">
                                <li>Install required dependencies (ifcopenshell, pandas, scipy)</li>
                                <li>Set up Revit API development environment</li>
                                <li>Configure BIM model export settings</li>
                                <li>Establish benchmark database connections</li>
                                <li>Test parameter extraction on sample models</li>
                            </ol>
                        </div>
                        <div>
                            <h4 class="font-semibold text-orange-800 dark:text-orange-200 mb-2">Key Features</h4>
                            <ul class="list-disc list-inside text-sm text-orange-700 dark:text-orange-300 space-y-1">
                                <li>Automated parameter extraction from IFC/Revit</li>
                                <li>Statistical significance testing</li>
                                <li>Multi-parameter correlation analysis</li>
                                <li>Monte Carlo uncertainty simulation</li>
                                <li>Compliance checking against standards</li>
                                <li>Optimization recommendations</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Get Started Section -->
                <div class="bg-gradient-to-r from-primary to-blue-600 text-white rounded-lg p-6">
                    <div class="flex items-start gap-4">
                        <div class="bg-white/20 rounded-lg p-3 flex-shrink-0">
                            <i data-lucide="rocket" class="h-8 w-8"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-2">Ready to Integrate?</h3>
                            <p class="text-blue-100 mb-4">Contact our development team to set up BIM integration for your workflow through Lendlease Integrated Solutions.</p>
                            <div class="flex flex-wrap gap-3">
                                <a href="https://lendlease.sharepoint.com/sites/Microsite-Integrated-Solutions" target="_blank" rel="noopener noreferrer" class="bg-white text-primary px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors duration-300 inline-flex items-center">
                                    <i data-lucide="external-link" class="h-5 w-5 mr-2"></i>
                                    Integrated Solutions
                                </a>
                                <button onclick="downloadBIMCode()" class="bg-white/20 text-white px-6 py-3 rounded-lg font-semibold hover:bg-white/30 transition-colors duration-300">
                                    <i data-lucide="download" class="h-5 w-5 mr-2 inline"></i>
                                    Download Code Examples
                                </button>
                                <button onclick="contactBIMSupport()" class="bg-white/20 text-white px-6 py-3 rounded-lg font-semibold hover:bg-white/30 transition-colors duration-300">
                                    <i data-lucide="mail" class="h-5 w-5 mr-2 inline"></i>
                                    Contact Support
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enable dark mode by default for energy efficiency
        document.documentElement.classList.add('dark');
        
        // Still allow system preference override
        window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        });

        // Application state
        let selectedParameter = null;
        let filterCategory = 'all';
        let searchTerm = '';
        let viewMode = 'technical';
        let currentPage = 'landing';
        let inputMode = 'simple';
        let uploadedFiles = [];
        
        // Project data
        let projectData = {
            name: '',
            type: '',
            parameters: {}
        };

        // Enhanced parameters data with Australian spelling and visual explanations
        const parameters = [
            {
                id: 'form-efficiency',
                category: 'Building Form',
                parameter: 'Form Efficiency',
                metric: 'P/A Ratio',
                definition: 'The ratio of exterior wall perimeter to floor area. Lower values indicate more compact, efficient forms. Calculated as: Building Perimeter (m) ÷ Floor Area (m²).',
                detailedExplanation: 'Form efficiency measures how compact your building shape is. A square building is more efficient than a long, thin building or one with many projections. Complex shapes increase the external wall area without increasing usable floor space, leading to higher costs for structure, cladding, and ongoing energy consumption.',
                visualSketch: `
                    <svg viewBox="0 0 400 180" class="w-full h-40 mb-4">
                        <!-- Simple Square Form (Efficient) -->
                        <g transform="translate(40, 30)">
                            <rect x="0" y="0" width="80" height="80" fill="#e8f5e8" stroke="#059669" stroke-width="3"/>
                            <text x="40" y="95" text-anchor="middle" class="text-sm font-bold fill-green-700">SQUARE</text>
                            <text x="40" y="110" text-anchor="middle" class="text-xs fill-green-600">100m × 100m</text>
                            <text x="40" y="125" text-anchor="middle" class="text-xs fill-green-600">P/A = 0.040</text>
                            <text x="40" y="140" text-anchor="middle" class="text-xs font-bold fill-green-600">OPTIMAL</text>
                        </g>
                        
                        <!-- Complex Shape with Projections (Inefficient) -->
                        <g transform="translate(260, 20)">
                            <!-- Main rectangle -->
                            <rect x="0" y="10" width="50" height="60" fill="#fde8e8" stroke="#dc2626" stroke-width="2"/>
                            <!-- Top projection -->
                            <rect x="15" y="0" width="20" height="15" fill="#fde8e8" stroke="#dc2626" stroke-width="2"/>
                            <!-- Right projection -->
                            <rect x="50" y="25" width="25" height="20" fill="#fde8e8" stroke="#dc2626" stroke-width="2"/>
                            <!-- Bottom projection -->
                            <rect x="10" y="70" width="30" height="15" fill="#fde8e8" stroke="#dc2626" stroke-width="2"/>
                            <!-- Left small projection -->
                            <rect x="0" y="40" width="10" height="15" fill="#fde8e8" stroke="#dc2626" stroke-width="2"/>
                            
                            <text x="37" y="105" text-anchor="middle" class="text-sm font-bold fill-red-700">COMPLEX</text>
                            <text x="37" y="120" text-anchor="middle" class="text-xs fill-red-600">Many projections</text>
                            <text x="37" y="135" text-anchor="middle" class="text-xs fill-red-600">P/A = 0.165</text>
                            <text x="37" y="150" text-anchor="middle" class="text-xs font-bold fill-red-600">INEFFICIENT</text>
                        </g>
                        
                        <!-- Comparison Arrow -->
                        <g transform="translate(170, 70)">
                            <path d="M 0 0 L 60 0" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <text x="30" y="-8" text-anchor="middle" class="text-xs fill-gray-600 font-bold">4× MORE</text>
                            <text x="30" y="15" text-anchor="middle" class="text-xs fill-gray-600">external wall</text>
                        </g>
                        
                        <defs>
                            <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="0" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#6b7280"/>
                            </marker>
                        </defs>
                    </svg>
                `,
                quickRule: 'Keep building shape simple and compact',
                optimal: '<0.25',
                acceptable: '<0.30',
                risk: '>0.30',
                benefits: ['💰 Considerable material savings', '🌿 Major energy impacts', '⏱️ Faster construction'],
                technicalNote: 'Compact building forms dramatically reduce material usage and energy consumption. A more efficient footprint can save 15-20% in structural materials and 10-15% in ongoing energy costs by minimising the building envelope surface area.',
                action: 'Simplify building outline',
                remediation: ['Consolidate projections', 'Square off corners', 'Combine service areas', 'Use rectangular forms'],
                impactScore: { cost: 'Medium', carbon: 'High', time: 'Medium' },
                keyImpact: '+15-20% materials, +10-15% energy',
                inputType: 'calculation',
                unit: 'ratio',
                inputLabel: 'External Perimeter to Area Ratio',
                calculation: {
                    inputs: ['perimeter', 'area'],
                    labels: ['Building Perimeter (m)', 'Floor Area (m²)'],
                    formula: 'perimeter / area'
                },
                ranges: { optimal: { min: 0, max: 0.25 }, acceptable: { min: 0.25, max: 0.30 }, risk: { min: 0.30, max: 1 } },
                defaultValue: 0.28
            },
            {
                id: 'building-proportion',
                category: 'Building Form',
                parameter: 'Height/Width Ratio',
                metric: 'H/W Ratio',
                definition: 'The ratio of building height to its maximum width. Measures the slenderness of the building. Calculated as: Building Height (m) ÷ Maximum Building Width (m).',
                detailedExplanation: 'This parameter measures how slender your building is. Very tall, narrow buildings (above 8:1 ratio) require expensive wind engineering, sophisticated lateral force systems, and complex foundation solutions. They also have higher maintenance costs and more challenging construction logistics.',
                visualSketch: `
                    <svg viewBox="0 0 400 200" class="w-full h-32 mb-4">
                        <!-- Optimal Proportion -->
                        <g transform="translate(60, 40)">
                            <rect x="0" y="0" width="60" height="120" fill="none" stroke="#059669" stroke-width="2"/>
                            <text x="30" y="135" text-anchor="middle" class="text-xs fill-green-600">Good 6:1</text>
                            <text x="30" y="150" text-anchor="middle" class="text-xs fill-green-600">Simple Structure</text>
                            <!-- Wind arrows (small) -->
                            <path d="M -10 60 L 5 60" stroke="#059669" stroke-width="1" marker-end="url(#smallarrow)"/>
                        </g>
                        
                        <!-- Risk Proportion -->
                        <g transform="translate(250, 20)">
                            <rect x="0" y="0" width="30" height="140" fill="none" stroke="#dc2626" stroke-width="2"/>
                            <text x="15" y="155" text-anchor="middle" class="text-xs fill-red-600">Risk 9:1</text>
                            <text x="15" y="170" text-anchor="middle" class="text-xs fill-red-600">Complex Wind</text>
                            <!-- Wind arrows (large) -->
                            <path d="M -15 70 L 10 70" stroke="#dc2626" stroke-width="2" marker-end="url(#largearrow)"/>
                            <path d="M -15 90 L 10 90" stroke="#dc2626" stroke-width="2" marker-end="url(#largearrow)"/>
                        </g>
                        
                        <defs>
                            <marker id="smallarrow" markerWidth="8" markerHeight="6" refX="0" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#059669"/>
                            </marker>
                            <marker id="largearrow" markerWidth="10" markerHeight="8" refX="0" refY="4" orient="auto">
                                <polygon points="0 0, 10 4, 0 8" fill="#dc2626"/>
                            </marker>
                        </defs>
                    </svg>
                `,
                quickRule: 'Avoid very tall, thin buildings',
                optimal: '<7:1',
                acceptable: '<8:1',
                risk: '>8:1',
                benefits: ['💰 Reduced wind costs', '⏱️ Simpler structural build', '🌿 Material efficiency'],
                technicalNote: 'Slender buildings require increasingly expensive wind resistance systems and sophisticated structural solutions. Buildings taller than 7 times their width need specialised lateral systems that can increase structural costs by 20-30%.',
                action: 'Review massing proportions',
                remediation: ['Widen floor plate', 'Add setbacks at height', 'Use outrigger systems', 'Consider building separation'],
                impactScore: { cost: 'Medium', carbon: 'Medium', time: 'High' },
                keyImpact: '+20-30% lateral system',
                inputType: 'calculation',
                unit: ':1',
                inputLabel: 'Height ÷ Width Ratio',
                calculation: {
                    inputs: ['height', 'width'],
                    labels: ['Building Height (m)', 'Max Building Width (m)'],
                    formula: 'height / width'
                },
                ranges: { optimal: { min: 0, max: 7 }, acceptable: { min: 7, max: 8 }, risk: { min: 8, max: 20 } },
                defaultValue: 6.8
            },
            {
                id: 'structural-grid',
                category: 'Structure',
                parameter: 'Grid Spacing',
                metric: 'Bay Size',
                definition: 'The distance between structural columns, determining the span of beams and floor systems.',
                detailedExplanation: 'Structural grid spacing significantly affects beam depth, material quantity, and construction cost. Spans beyond 9m require much deeper beams or expensive post-tensioned systems. The optimal 7.5-8m spacing provides the best balance between structural efficiency and spatial flexibility.',
                visualSketch: `
                    <svg viewBox="0 0 400 200" class="w-full h-32 mb-4">
                        <!-- Optimal Grid -->
                        <g transform="translate(30, 40)">
                            <rect x="0" y="0" width="140" height="80" fill="none" stroke="#059669" stroke-width="2"/>
                            <!-- Columns -->
                            <rect x="0" y="0" width="4" height="80" fill="#059669"/>
                            <rect x="68" y="0" width="4" height="80" fill="#059669"/>
                            <rect x="136" y="0" width="4" height="80" fill="#059669"/>
                            <!-- Beam (normal depth) -->
                            <rect x="0" y="35" width="140" height="10" fill="#059669" opacity="0.6"/>
                            <!-- Dimension -->
                            <text x="34" y="100" text-anchor="middle" class="text-xs fill-green-600">7.5m</text>
                            <text x="102" y="100" text-anchor="middle" class="text-xs fill-green-600">7.5m</text>
                            <text x="70" y="115" text-anchor="middle" class="text-xs fill-green-600">Optimal</text>
                        </g>
                        
                        <!-- Risk Grid -->
                        <g transform="translate(220, 30)">
                            <rect x="0" y="0" width="140" height="100" fill="none" stroke="#dc2626" stroke-width="2"/>
                            <!-- Columns -->
                            <rect x="0" y="0" width="4" height="100" fill="#dc2626"/>
                            <rect x="136" y="0" width="4" height="100" fill="#dc2626"/>
                            <!-- Beam (deep) -->
                            <rect x="0" y="30" width="140" height="20" fill="#dc2626" opacity="0.6"/>
                            <!-- Dimension -->
                            <text x="70" y="120" text-anchor="middle" class="text-xs fill-red-600">11m span</text>
                            <text x="70" y="135" text-anchor="middle" class="text-xs fill-red-600">Deep beam</text>
                        </g>
                    </svg>
                `,
                quickRule: 'Keep structural bay size around 7.5-8m',
                optimal: '7.5-8.0m',
                acceptable: '6-9m',
                risk: '>10.5m',
                benefits: ['💰 Optimal beam sizing', '⏱️ Standard construction', '🌿 Balanced materials'],
                technicalNote: 'Optimal structural bay spacing balances structural efficiency with space planning flexibility. Grids beyond 9m require significantly deeper beams, increasing material use and floor height.',
                action: 'Standardise grid at 7.5-8m',
                remediation: ['Add intermediate columns', 'Use post-tensioning', 'Accept deeper beams', 'Consider steel alternatives'],
                impactScore: { cost: 'Medium', carbon: 'High', time: 'Medium' },
                keyImpact: '+40% beam depth at 10.5m',
                inputType: 'number',
                unit: 'm',
                ranges: { optimal: { min: 7.5, max: 8.0 }, acceptable: { min: 6, max: 9 }, risk: { min: 9, max: 15 } },
                defaultValue: 7.8
            },
            {
                id: 'floor-height',
                category: 'Vertical Design',
                parameter: 'Floor-to-Floor Height',
                metric: 'F2F Height',
                definition: 'The vertical distance from finished floor to finished floor above, affecting building volume and structural requirements.',
                detailedExplanation: 'Floor-to-floor height directly impacts material quantities, number of floors achievable, and building efficiency. Office buildings need more height for MEP distribution, while residential buildings can be more compact. Extra height significantly increases structural material and overall building carbon footprint.',
                visualSketch: `
                    <svg viewBox="0 0 400 200" class="w-full h-32 mb-4">
                        <!-- Residential Optimal -->
                        <g transform="translate(50, 20)">
                            <rect x="0" y="20" width="60" height="30" fill="none" stroke="#059669" stroke-width="2"/>
                            <rect x="0" y="55" width="60" height="30" fill="none" stroke="#059669" stroke-width="2"/>
                            <rect x="0" y="90" width="60" height="30" fill="none" stroke="#059669" stroke-width="2"/>
                            <!-- Height dimension -->
                            <path d="M 65 20 L 65 50" stroke="#059669" stroke-width="1"/>
                            <path d="M 62 20 L 68 20" stroke="#059669" stroke-width="1"/>
                            <path d="M 62 50 L 68 50" stroke="#059669" stroke-width="1"/>
                            <text x="75" y="38" class="text-xs fill-green-600">3.1m</text>
                            <text x="30" y="140" text-anchor="middle" class="text-xs fill-green-600">Residential</text>
                            <text x="30" y="155" text-anchor="middle" class="text-xs fill-green-600">Optimal</text>
                        </g>
                        
                        <!-- Office Optimal -->
                        <g transform="translate(160, 20)">
                            <rect x="0" y="10" width="60" height="40" fill="none" stroke="#d97706" stroke-width="2"/>
                            <rect x="0" y="55" width="60" height="40" fill="none" stroke="#d97706" stroke-width="2"/>
                            <rect x="0" y="100" width="60" height="40" fill="none" stroke="#d97706" stroke-width="2"/>
                            <!-- MEP zone -->
                            <rect x="5" y="40" width="50" height="10" fill="#d97706" opacity="0.3"/>
                            <rect x="5" y="85" width="50" height="10" fill="#d97706" opacity="0.3"/>
                            <!-- Height dimension -->
                            <path d="M 65 10 L 65 50" stroke="#d97706" stroke-width="1"/>
                            <path d="M 62 10 L 68 10" stroke="#d97706" stroke-width="1"/>
                            <path d="M 62 50 L 68 50" stroke="#d97706" stroke-width="1"/>
                            <text x="75" y="33" class="text-xs fill-yellow-600">3.9m</text>
                            <text x="30" y="155" text-anchor="middle" class="text-xs fill-yellow-600">Office</text>
                            <text x="30" y="170" text-anchor="middle" class="text-xs fill-yellow-600">Standard</text>
                        </g>
                        
                        <!-- Excessive Height -->
                        <g transform="translate(280, 10)">
                            <rect x="0" y="0" width="60" height="55" fill="none" stroke="#dc2626" stroke-width="2"/>
                            <rect x="0" y="60" width="60" height="55" fill="none" stroke="#dc2626" stroke-width="2"/>
                            <!-- Wasted space -->
                            <rect x="5" y="35" width="50" height="20" fill="#dc2626" opacity="0.2"/>
                            <text x="30" y="47" text-anchor="middle" class="text-xs fill-red-600">Waste</text>
                            <!-- Height dimension -->
                            <path d="M 65 0 L 65 55" stroke="#dc2626" stroke-width="1"/>
                            <path d="M 62 0 L 68 0" stroke="#dc2626" stroke-width="1"/>
                            <path d="M 62 55 L 68 55" stroke="#dc2626" stroke-width="1"/>
                            <text x="75" y="30" class="text-xs fill-red-600">5.0m</text>
                            <text x="30" y="140" text-anchor="middle" class="text-xs fill-red-600">Excessive</text>
                            <text x="30" y="155" text-anchor="middle" class="text-xs fill-red-600">+50% Carbon</text>
                        </g>
                    </svg>
                `,
                quickRule: 'Standard heights reduce costs considerably',
                optimal: '3.1m (res) / 3.9m (off)',
                acceptable: '3.0-3.3m / 3.6-4.2m',
                risk: '>3.6m / >4.5m',
                benefits: ['💰 Major cost savings', '⏱️ Standard formwork', '🌿 Less structural materials'],
                technicalNote: 'Every 100mm adds one floor per 30-storey building. Every 100mm of extra height adds ~2-3% to total building carbon through additional materials. Office buildings typically require higher floor-to-floor heights (3.9m) to accommodate larger MEP systems, while residential buildings can use lower heights (3.1m).',
                action: 'Minimise to functional needs',
                remediation: ['Optimise MEP zones', 'Use exposed ceilings', 'Coordinate services', 'Reduce plenum space'],
                impactScore: { cost: 'Medium', carbon: 'Medium', time: 'Low' },
                keyImpact: '+2-3% total carbon per 100mm',
                inputType: 'number',
                unit: 'm',
                buildingTypeSpecific: {
                    office: {
                        optimal: { min: 3.6, max: 3.9 },
                        acceptable: { min: 3.6, max: 4.2 },
                        risk: { min: 4.5, max: 6 },
                        note: 'Office buildings require additional height for MEP systems and suspended ceilings'
                    },
                    residential: {
                        optimal: { min: 3.0, max: 3.1 },
                        acceptable: { min: 3.0, max: 3.3 },
                        risk: { min: 3.6, max: 6 },
                        note: 'Residential buildings can use lower heights with simpler MEP requirements'
                    }
                },
                ranges: { optimal: { min: 3.0, max: 3.9 }, acceptable: { min: 3.0, max: 4.2 }, risk: { min: 4.2, max: 6 } },
                defaultValue: 3.9
            },
            {
                id: 'cantilevers',
                category: 'Special Conditions',
                parameter: 'Cantilever Projection',
                metric: 'Projection Length',
                definition: 'The distance that building elements extend beyond their primary structural support.',
                detailedExplanation: 'Cantilevers create dramatic architectural effects but have exponential structural costs. Each metre of cantilever beyond 1.5m requires significantly more structural material in supporting elements. Long cantilevers also create complex connection details and construction challenges.',
                visualSketch: `
                    <svg viewBox="0 0 400 220" class="w-full h-32 mb-4">
                        <!-- Cantilever Options Title -->
                        <text x="100" y="20" text-anchor="middle" class="text-sm font-bold fill-gray-700">CANTILEVER OPTIONS</text>
                        
                        <!-- Base square with three different cantilever projections -->
                        <g transform="translate(50, 40)">
                            <!-- Base square -->
                            <rect x="0" y="0" width="80" height="80" fill="#e8f5e8" stroke="#059669" stroke-width="3"/>
                            <!-- Three beams showing different performance levels -->
                            <!-- Optimal beam (short/none) -->
                            <rect x="80" y="20" width="25" height="8" fill="#059669" stroke="#059669" stroke-width="1"/>
                            <text x="92" y="35" text-anchor="middle" class="text-xs fill-green-600">1.5m</text>
                            <text x="92" y="45" text-anchor="middle" class="text-xs fill-green-600">OPTIMAL</text>
                            
                            <!-- Acceptable beam (medium) -->
                            <rect x="80" y="36" width="40" height="8" fill="#d97706" stroke="#d97706" stroke-width="1"/>
                            <text x="100" y="51" text-anchor="middle" class="text-xs fill-yellow-600">2.5m</text>
                            <text x="100" y="61" text-anchor="middle" class="text-xs fill-yellow-600">ACCEPTABLE</text>
                            
                            <!-- Risk beam (long) -->
                            <rect x="80" y="52" width="60" height="8" fill="#dc2626" stroke="#dc2626" stroke-width="1"/>
                            <text x="110" y="67" text-anchor="middle" class="text-xs fill-red-600">3.5m</text>
                            <text x="110" y="77" text-anchor="middle" class="text-xs fill-red-600">RISK</text>
                        </g>
                        
                        <!-- Material Impact Title with more spacing -->
                        <text x="300" y="20" text-anchor="middle" class="text-sm font-bold fill-gray-700">MATERIAL IMPACT</text>
                        
                        <!-- Performance impact chart -->
                        <g transform="translate(220, 50)">
                            <!-- Impact bars -->
                            <rect x="20" y="20" width="20" height="20" fill="#059669"/>
                            <text x="5" y="35" class="text-xs fill-green-600">1.0×</text>
                            <text x="45" y="35" class="text-xs fill-green-600">Baseline</text>
                            
                            <rect x="20" y="45" width="35" height="20" fill="#d97706"/>
                            <text x="5" y="60" class="text-xs fill-yellow-600">1.4×</text>
                            <text x="60" y="60" class="text-xs fill-yellow-600">40% More</text>
                            
                            <rect x="20" y="70" width="60" height="20" fill="#dc2626"/>
                            <text x="5" y="85" class="text-xs fill-red-600">2.0×</text>
                            <text x="85" y="85" class="text-xs fill-red-600">100% More</text>
                            
                            <text x="80" y="105" text-anchor="middle" class="text-xs fill-gray-600">Structural Material</text>
                        </g>
                    </svg>
                `,
                quickRule: 'Minimise or eliminate cantilevers',
                optimal: '<1.5m',
                acceptable: '<2.5m',
                risk: '>3.5m',
                benefits: ['💰 Significant material savings', '🌿 Major carbon reduction', '⏱️ Simpler construction'],
                technicalNote: 'Cantilevers have exponential material impact. Each metre of cantilever can require 40-60% more structural material in the supporting elements.',
                action: 'Minimise or eliminate',
                remediation: ['Add columns below', 'Use lightweight materials', 'Consider cable supports', 'Reduce cantilever length'],
                impactScore: { cost: 'High', carbon: 'High', time: 'High' },
                keyImpact: '+40-60% structure per metre',
                inputType: 'number',
                unit: 'm',
                inputLabel: 'Maximum Cantilever Projection',
                ranges: { optimal: { min: 0, max: 1.5 }, acceptable: { min: 1.5, max: 2.5 }, risk: { min: 3.5, max: 10 } },
                defaultValue: 0
            },
            {
                id: 'transfer-structures',
                category: 'Structure',
                parameter: 'Transfer Levels',
                metric: 'Number of Transfers',
                definition: 'The number of levels where structural loads are transferred between misaligned vertical elements.',
                detailedExplanation: 'Transfer structures are among the most expensive and carbon-intensive building elements. They occur when columns cannot align vertically due to program changes, requiring massive horizontal beams to transfer loads. Each transfer level typically uses 2-3 times more structural material than standard floors.',
                visualSketch: `
                    <svg viewBox="0 0 400 190" class="w-full h-32 mb-4">
                        <!-- Title -->
                        <text x="200" y="15" text-anchor="middle" class="text-sm font-bold fill-gray-700">COLUMN ALIGNMENT COMPARISON</text>
                        
                        <!-- Good: Straight Columns -->
                        <g transform="translate(60, 30)">
                            <!-- Simple building outline -->
                            <rect x="0" y="0" width="80" height="120" fill="none" stroke="#059669" stroke-width="3"/>
                            
                            <!-- Floor lines -->
                            <line x1="0" y1="30" x2="80" y2="30" stroke="#059669" stroke-width="1"/>
                            <line x1="0" y1="60" x2="80" y2="60" stroke="#059669" stroke-width="1"/>
                            <line x1="0" y1="90" x2="80" y2="90" stroke="#059669" stroke-width="1"/>
                            
                            <!-- Straight columns (good) -->
                            <line x1="20" y1="0" x2="20" y2="120" stroke="#059669" stroke-width="3"/>
                            <line x1="40" y1="0" x2="40" y2="120" stroke="#059669" stroke-width="3"/>
                            <line x1="60" y1="0" x2="60" y2="120" stroke="#059669" stroke-width="3"/>
                        </g>
                        
                        <!-- Labels for good case with gap -->
                        <text x="100" y="170" text-anchor="middle" class="text-xs fill-green-600 font-bold">✓ GOOD</text>
                        <text x="100" y="180" text-anchor="middle" class="text-xs fill-green-600">Columns stack vertically</text>
                        
                        <!-- Problem: Offset Columns -->
                        <g transform="translate(240, 30)">
                            <!-- Building outline -->
                            <rect x="0" y="0" width="80" height="120" fill="none" stroke="#dc2626" stroke-width="3"/>
                            
                            <!-- Floor lines -->
                            <line x1="0" y1="30" x2="80" y2="30" stroke="#dc2626" stroke-width="1"/>
                            <line x1="0" y1="60" x2="80" y2="60" stroke="#dc2626" stroke-width="1"/>
                            <line x1="0" y1="90" x2="80" y2="90" stroke="#dc2626" stroke-width="1"/>
                            
                            <!-- Upper columns (offset) -->
                            <line x1="15" y1="0" x2="15" y2="60" stroke="#dc2626" stroke-width="3"/>
                            <line x1="65" y1="0" x2="65" y2="60" stroke="#dc2626" stroke-width="3"/>
                            
                            <!-- THICK TRANSFER BEAM -->
                            <rect x="0" y="55" width="80" height="10" fill="#dc2626" opacity="0.8"/>
                            
                            <!-- Lower columns (different positions) -->
                            <line x1="25" y1="65" x2="25" y2="120" stroke="#dc2626" stroke-width="3"/>
                            <line x1="55" y1="65" x2="55" y2="120" stroke="#dc2626" stroke-width="3"/>
                            
                            <!-- Show the offset with arrows -->
                            <path d="M 15 70 L 25 70" stroke="#dc2626" stroke-width="2" marker-end="url(#redarrow)"/>
                            <path d="M 65 70 L 55 70" stroke="#dc2626" stroke-width="2" marker-end="url(#redarrow)"/>
                        </g>
                        
                        <!-- Labels for problem case with gap -->
                        <text x="280" y="170" text-anchor="middle" class="text-xs fill-red-600 font-bold">✗ PROBLEM</text>
                        <text x="280" y="180" text-anchor="middle" class="text-xs fill-red-600">Columns don't align = transfer needed</text>
                        
                        <defs>
                            <marker id="redarrow" markerWidth="8" markerHeight="6" refX="0" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#dc2626"/>
                            </marker>
                        </defs>
                    </svg>
                `,
                quickRule: 'Align vertical structure wherever possible',
                optimal: '0-1',
                acceptable: '2',
                risk: '>2',
                benefits: ['💰 Massive cost savings', '🌿 Major carbon reduction', '⏱️ Faster construction'],
                technicalNote: 'Transfers are the most carbon-intensive structural element, requiring 2-3 times the material of typical structure. They should be avoided whenever possible.',
                action: 'Align vertical structure',
                remediation: ['Relocate columns', 'Adjust program stacking', 'Accept layout constraints', 'Use steel alternatives'],
                impactScore: { cost: 'High', carbon: 'High', time: 'High' },
                keyImpact: '2-3x material at transfers',
                inputType: 'number',
                unit: 'levels',
                inputLabel: 'Number of Transfer Levels',
                ranges: { optimal: { min: 0, max: 1 }, acceptable: { min: 1, max: 2 }, risk: { min: 2, max: 10 } },
                defaultValue: 0
            },
            {
                id: 'window-wall-ratio',
                category: 'Envelope',
                parameter: 'Window-to-Wall Ratio',
                metric: 'WWR %',
                definition: 'The percentage of wall area occupied by windows and glazed openings.',
                detailedExplanation: 'Window-to-wall ratio significantly affects energy performance and facade cost. Glass has much higher heat transfer than insulated walls, leading to increased cooling and heating loads. Very high glazing ratios (>60%) dramatically increase both energy consumption and facade embodied carbon.',
                visualSketch: `
                    <svg viewBox="0 0 400 200" class="w-full h-32 mb-4">
                        <!-- Optimal WWR -->
                        <g transform="translate(50, 40)">
                            <rect x="0" y="0" width="60" height="100" fill="none" stroke="#059669" stroke-width="2"/>
                            <!-- Windows (40%) -->
                            <rect x="5" y="5" width="20" height="25" fill="#87CEEB" stroke="#059669" stroke-width="1"/>
                            <rect x="35" y="5" width="20" height="25" fill="#87CEEB" stroke="#059669" stroke-width="1"/>
                            <rect x="5" y="40" width="20" height="25" fill="#87CEEB" stroke="#059669" stroke-width="1"/>
                            <rect x="35" y="40" width="20" height="25" fill="#87CEEB" stroke="#059669" stroke-width="1"/>
                            <!-- Solid wall areas -->
                            <rect x="5" y="75" width="50" height="20" fill="#D3D3D3" stroke="#059669" stroke-width="1"/>
                            <text x="30" y="120" text-anchor="middle" class="text-xs fill-green-600">Optimal 40%</text>
                            <text x="30" y="135" text-anchor="middle" class="text-xs fill-green-600">Balanced</text>
                        </g>
                        
                        <!-- Acceptable WWR -->
                        <g transform="translate(160, 40)">
                            <rect x="0" y="0" width="60" height="100" fill="none" stroke="#d97706" stroke-width="2"/>
                            <!-- Windows (50%) -->
                            <rect x="5" y="5" width="50" height="20" fill="#87CEEB" stroke="#d97706" stroke-width="1"/>
                            <rect x="5" y="30" width="50" height="20" fill="#87CEEB" stroke="#d97706" stroke-width="1"/>
                            <rect x="5" y="55" width="50" height="15" fill="#87CEEB" stroke="#d97706" stroke-width="1"/>
                            <!-- Solid wall areas -->
                            <rect x="5" y="75" width="50" height="20" fill="#D3D3D3" stroke="#d97706" stroke-width="1"/>
                            <text x="30" y="120" text-anchor="middle" class="text-xs fill-yellow-600">Acceptable 50%</text>
                            <text x="30" y="135" text-anchor="middle" class="text-xs fill-yellow-600">Higher Energy</text>
                        </g>
                        
                        <!-- Risk WWR -->
                        <g transform="translate(280, 40)">
                            <rect x="0" y="0" width="60" height="100" fill="none" stroke="#dc2626" stroke-width="2"/>
                            <!-- Windows (70%) -->
                            <rect x="5" y="5" width="50" height="25" fill="#87CEEB" stroke="#dc2626" stroke-width="1"/>
                            <rect x="5" y="35" width="50" height="25" fill="#87CEEB" stroke="#dc2626" stroke-width="1"/>
                            <rect x="5" y="65" width="50" height="20" fill="#87CEEB" stroke="#dc2626" stroke-width="1"/>
                            <!-- Minimal solid wall -->
                            <rect x="5" y="90" width="50" height="5" fill="#D3D3D3" stroke="#dc2626" stroke-width="1"/>
                            <text x="30" y="120" text-anchor="middle" class="text-xs fill-red-600">Risk 70%</text>
                            <text x="30" y="135" text-anchor="middle" class="text-xs fill-red-600">High Energy</text>
                        </g>
                    </svg>
                `,
                quickRule: 'Balance daylight with thermal performance',
                optimal: '35-40%',
                acceptable: '30-50%',
                risk: '>60%',
                benefits: ['💰 Lower HVAC costs', '🌿 Improved energy performance', '⏱️ Simpler construction'],
                technicalNote: 'Glass has 5x the heat transfer of insulated walls. High glazing ratios increase cooling loads by 15-25% and can increase facade carbon by 40-70%.',
                action: 'Balance views with solid wall',
                remediation: ['Add spandrels', 'Use vision strips', 'Optimise by orientation', 'Add shading devices'],
                impactScore: { cost: 'High', carbon: 'Medium', time: 'Medium' },
                keyImpact: '+40-70% facade carbon at 60%',
                inputType: 'number',
                unit: '%',
                ranges: { optimal: { min: 35, max: 40 }, acceptable: { min: 30, max: 50 }, risk: { min: 60, max: 90 } },
                defaultValue: 45
            },
            {
                id: 'net-to-gross',
                category: 'Planning',
                parameter: 'Net-to-Gross Ratio',
                metric: 'NGA %',
                definition: 'The ratio of usable floor area to total floor area, indicating planning efficiency.',
                quickRule: 'Optimize core and circulation for maximum efficiency',
                optimal: '80-85% (office)',
                acceptable: '75-80%',
                risk: '<75%',
                benefits: ['💰 Direct revenue impact', '🌿 Better space utilization', '⏱️ Efficient planning'],
                technicalNote: 'Every 1% improvement in net-to-gross ratio equals 1% more revenue-generating space. Poor ratios indicate inefficient core and circulation design.',
                action: 'Optimize core and circulation',
                remediation: ['Centralize cores', 'Combine services', 'Reduce circulation', 'Optimize elevator arrangement'],
                impactScore: { cost: 'High', carbon: 'Medium', time: 'Medium' },
                keyImpact: 'Direct revenue impact',
                inputType: 'number',
                unit: '%',
                inputLabel: 'Net Gross Area/Gross Floor Area (%)',
                ranges: { optimal: { min: 80, max: 85 }, acceptable: { min: 75, max: 80 }, risk: { min: 60, max: 75 } },
                defaultValue: 78
            },
            {
                id: 'column-stacking',
                category: 'Structure',
                parameter: 'Column Alignment',
                metric: 'Stacking %',
                definition: 'The percentage of columns that stack vertically without requiring transfer structures. Based on 1.5m eccentricity tolerance across each column.',
                quickRule: 'Maintain vertical continuity of structure',
                optimal: '>85%',
                acceptable: '70-85%',
                risk: '<70%',
                benefits: ['💰 Eliminates transfer costs', '🌿 Major carbon reduction', '⏱️ Simpler construction'],
                technicalNote: 'Poor column alignment forces expensive transfer structures. Each transfer can add 200% more material locally and complicate construction significantly. Analysis based on 1.5m eccentricity tolerance.',
                action: 'Maintain vertical continuity',
                remediation: ['Adjust layouts', 'Accept program constraints', 'Add transfer beams', 'Relocate service cores'],
                impactScore: { cost: 'High', carbon: 'High', time: 'Medium' },
                keyImpact: 'Each transfer +200% local structure',
                inputType: 'number',
                unit: '%',
                inputLabel: 'Column Alignment Percentage',
                ranges: { optimal: { min: 85, max: 100 }, acceptable: { min: 70, max: 85 }, risk: { min: 0, max: 70 } },
                defaultValue: 82
            },
            {
                id: 'service-runs',
                category: 'MEP',
                parameter: 'Horizontal Service Runs',
                metric: 'Distance from Core',
                definition: 'The maximum horizontal distance from service cores to the furthest served space.',
                quickRule: 'Keep service runs short and direct',
                optimal: '<25m',
                acceptable: '25-35m',
                risk: '>35m',
                benefits: ['💰 Reduced duct sizing', '🌿 Less material usage', '⏱️ Simpler installation'],
                technicalNote: 'Long service runs need upsizing for pressure drop, increasing material use by 40% for ducts and 30% overall. They also reduce system efficiency.',
                action: 'Add risers or relocate core',
                remediation: ['Add satellite risers', 'Relocate equipment rooms', 'Use fan-powered boxes', 'Optimize core location'],
                impactScore: { cost: 'Medium', carbon: 'Medium', time: 'Medium' },
                keyImpact: '+40% duct size, +30% material',
                inputType: 'number',
                unit: 'm',
                inputLabel: 'Maximum Distance from Core',
                ranges: { optimal: { min: 0, max: 25 }, acceptable: { min: 25, max: 35 }, risk: { min: 35, max: 100 } },
                defaultValue: 28
            }
        ];

        // Get unique categories
        const categories = [...new Set(parameters.map(p => p.category))];

        // Initialize icons
        function initializeIcons() {
            lucide.createIcons();
        }

        // Landing page functions
        function startAnalysis() {
            showPage('input');
        }

        function startFileUpload() {
            document.getElementById('fileUploadModal').classList.remove('hidden');
        }

        function startManualInput() {
            showPage('input');
        }

        function scrollToLearnMore() {
            document.getElementById('learnMoreSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function scrollToDemo() {
            // Scroll to the flowchart section which acts as a demo
            document.querySelector('.grid.lg\\:grid-cols-2').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function scrollToFeatures() {
            const featuresSection = document.getElementById('featuresSection');
            featuresSection.classList.remove('hidden');
            featuresSection.scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function quickStart() {
            const projectName = document.getElementById('quickProjectName').value.trim();
            if (projectName) {
                projectData.name = projectName;
                document.getElementById('projectName').value = projectName;
            }
            showPage('input');
        }

        function handleQuickStart(event) {
            if (event.key === 'Enter') {
                quickStart();
            }
        }

        // File upload functions
        function closeFileUploadModal() {
            document.getElementById('fileUploadModal').classList.add('hidden');
            uploadedFiles = [];
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('processFilesBtn').disabled = true;
        }

        function setupFileUpload() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            
            // Drag and drop handlers
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });
            
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });
        }

        function handleFiles(files) {
            const allowedTypes = ['.ifc', '.rvt', '.rfa', '.dwg'];
            const maxSize = 50 * 1024 * 1024; // 50MB
            
            files.forEach(file => {
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (!allowedTypes.includes(fileExtension)) {
                    showNotification(`File ${file.name} is not supported. Please upload IFC, Revit, or AutoCAD files.`, 'error');
                    return;
                }
                
                if (file.size > maxSize) {
                    showNotification(`File ${file.name} is too large. Maximum size is 50MB.`, 'error');
                    return;
                }
                
                uploadedFiles.push(file);
            });
            
            updateFileList();
            document.getElementById('processFilesBtn').disabled = uploadedFiles.length === 0;
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            
            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }
            
            fileList.innerHTML = `
                <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Selected Files (${uploadedFiles.length})</h4>
                <div class="space-y-2">
                    ${uploadedFiles.map((file, index) => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center">
                                <i data-lucide="file" class="h-4 w-4 text-blue-500 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800 dark:text-gray-100">${file.name}</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">${formatFileSize(file.size)}</div>
                                </div>
                            </div>
                            <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700 transition-colors">
                                <i data-lucide="x" class="h-4 w-4"></i>
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
            
            initializeIcons();
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            document.getElementById('processFilesBtn').disabled = uploadedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function processUploadedFiles() {
            if (uploadedFiles.length === 0) return;
            
            // Show upload progress
            document.getElementById('uploadProgress').classList.remove('hidden');
            
            // Simulate file processing
            let progress = 0;
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // Simulate extracted parameters
                    setTimeout(() => {
                        extractParametersFromFiles();
                        closeFileUploadModal();
                        showPage('input');
                        showNotification('Parameters successfully extracted from uploaded files!', 'success');
                    }, 500);
                }
                
                progressBar.style.width = progress + '%';
                progressPercent.textContent = Math.round(progress) + '%';
            }, 200);
        }

        function extractParametersFromFiles() {
            // Simulate parameter extraction with realistic values
            const extractedData = {
                name: 'Project from ' + uploadedFiles[0].name.replace(/\.[^/.]+$/, ""),
                type: 'office', // Default to office for BIM files
                parameters: {
                    'form-efficiency': { value: 0.26, status: 'acceptable' },
                    'building-proportion': { value: 6.2, status: 'optimal' },
                    'structural-grid': { value: 8.5, status: 'acceptable' },
                    'floor-height': { value: 4.1, status: 'acceptable' },
                    'cantilevers': { value: 2.8, status: 'acceptable' },
                    'transfer-structures': { value: 1, status: 'optimal' },
                    'window-wall-ratio': { value: 42, status: 'acceptable' },
                    'net-to-gross': { value: 79, status: 'acceptable' },
                    'column-stacking': { value: 88, status: 'optimal' },
                    'service-runs': { value: 31, status: 'acceptable' }
                }
            };
            
            // Populate project data
            projectData = extractedData;
            
            // Update UI
            document.getElementById('projectName').value = extractedData.name;
            document.getElementById('buildingType').value = extractedData.type;
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white',
                warning: 'bg-yellow-500 text-black'
            };
            
            notification.className += ` ${colors[type] || colors.info}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <i data-lucide="x" class="h-4 w-4"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            initializeIcons();
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Input mode switching function
        function switchInputMode(mode) {
            inputMode = mode;
            
            // Update button states
            const detailedBtn = document.getElementById('detailedInputBtn');
            const simpleBtn = document.getElementById('simpleInputBtn');
            
            if (mode === 'detailed') {
                detailedBtn.className = 'input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors bg-primary text-white';
                simpleBtn.className = 'input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600';
            } else {
                detailedBtn.className = 'input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600';
                simpleBtn.className = 'input-mode-btn px-4 py-2 rounded-md text-sm font-medium transition-colors bg-primary text-white';
            }
            
            // Re-render the parameter inputs
            renderParameterInputs();
        }

        // Page navigation functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            document.getElementById(pageId + 'Page').classList.add('active');
            
            // Show/hide step navigation based on page
            const stepNav = document.getElementById('stepNavigation');
            if (pageId === 'landing') {
                stepNav.style.display = 'none';
            } else {
                stepNav.style.display = 'block';
                updateStepIndicators(pageId);
            }
            
            // Update current page
            currentPage = pageId;
            
            // Initialize page-specific content
            if (pageId === 'input') {
                renderParameterInputs();
            } else if (pageId === 'analysis') {
                initializeCategoryFilter();
                // Start with technical view first as requested
                viewMode = 'technical';
                renderTechnicalView();
            } else if (pageId === 'summary') {
                renderSummaryPage();
            }
            
            initializeIcons();
        }

        function updateStepIndicators(currentStep) {
            const stepOrder = ['landing', 'input', 'analysis', 'summary', 'resources'];
            const currentIndex = stepOrder.indexOf(currentStep);
            
            document.querySelectorAll('.step-nav-btn').forEach((btn, index) => {
                btn.classList.remove('step-active', 'step-completed');
                btn.classList.add('text-gray-600');
                
                if (index < currentIndex) {
                    btn.classList.add('step-completed');
                    btn.classList.remove('text-gray-600');
                } else if (index === currentIndex) {
                    btn.classList.add('step-active');
                    btn.classList.remove('text-gray-600');
                }
            });
        }

        // Input page functions
        function renderParameterInputs() {
            if (inputMode === 'simple') {
                renderSimpleParameterInputs();
            } else {
                renderDetailedParameterInputs();
            }
        }

        function renderSimpleParameterInputs() {
            const container = document.getElementById('parameterInputs');
            
            // Group parameters by sustainability impact priority (high impact first)
            const highImpactParams = parameters.filter(p => 
                p.impactScore.carbon === 'High' || p.impactScore.cost === 'High'
            );
            const mediumImpactParams = parameters.filter(p => 
                (p.impactScore.carbon === 'Medium' || p.impactScore.cost === 'Medium') && 
                !highImpactParams.includes(p)
            );
            const lowImpactParams = parameters.filter(p => 
                !highImpactParams.includes(p) && !mediumImpactParams.includes(p)
            );
            
            const categoryGroups = {
                'High Impact - Priority Actions': highImpactParams,
                'Medium Impact - Important': mediumImpactParams,
                'Low Impact - Fine-tuning': lowImpactParams
            };
            
            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    ${Object.entries(categoryGroups).map(([categoryName, params]) => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 pb-2 border-b border-gray-200 dark:border-gray-600">
                                ${categoryName}
                            </h3>
                            <div class="space-y-4">
                                ${params.map(param => {
                                    const currentValue = projectData.parameters[param.id]?.value || param.defaultValue;
                                    const currentStatus = projectData.parameters[param.id]?.status || 'not-considered';
                                    const isMinimized = projectData.parameters[param.id]?.minimized || false;
                                    
                                    return `
                                        <div id="param-container-${param.id}" class="space-y-2">
                                            <div class="flex items-center gap-2">
                                                <h4 class="text-sm font-medium text-gray-800 dark:text-gray-100 flex-1">${param.parameter}</h4>
                                                ${isMinimized ? `
                                                    <div class="flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs">
                                                        <i data-lucide="eye-off" class="h-3 w-3"></i>
                                                        <span>Excluded</span>
                                                    </div>
                                                ` : ''}
                                                ${currentStatus === 'risk' ? `
                                                    <div class="flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-full text-xs">
                                                        <i data-lucide="alert-triangle" class="h-3 w-3"></i>
                                                        <span>Needs Review</span>
                                                    </div>
                                                ` : ''}
                                                ${!isMinimized ? `
                                                    <button 
                                                        class="exclude-button w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 hover:bg-red-500 hover:text-white flex items-center justify-center text-xs transition-colors"
                                                        onclick="excludeParameterFromAnalysis('${param.id}')"
                                                        title="Exclude this parameter from analysis"
                                                    >
                                                        <i data-lucide="x" class="h-3 w-3"></i>
                                                    </button>
                                                ` : `
                                                    <button 
                                                        class="include-button w-4 h-4 rounded-full bg-blue-200 dark:bg-blue-600 text-blue-600 dark:text-blue-300 hover:bg-green-500 hover:text-white flex items-center justify-center text-xs transition-colors"
                                                        onclick="includeParameterInAnalysis('${param.id}')"
                                                        title="Include this parameter back in analysis"
                                                    >
                                                        <i data-lucide="plus" class="h-3 w-3"></i>
                                                    </button>
                                                `}
                                                <div class="relative">
                                                    <button 
                                                        class="info-button w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 hover:bg-primary hover:text-white flex items-center justify-center text-xs transition-colors"
                                                        onclick="toggleParameterInfo('simple-${param.id}')"
                                                    >
                                                        <i data-lucide="info" class="h-3 w-3"></i>
                                                    </button>
                                                    <div id="info-simple-${param.id}" class="info-popup hidden absolute z-20 right-0 top-6 w-96 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-h-96 overflow-y-auto">
                                                        <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3">${param.parameter}</h4>
                                                        
                                                        ${param.visualSketch ? `
                                                            <div class="mb-4">
                                                                <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Visual Guide:</div>
                                                                ${param.visualSketch}
                                                            </div>
                                                        ` : ''}
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Definition:</div>
                                                            <p class="text-xs text-gray-600 dark:text-gray-400">${param.definition}</p>
                                                        </div>
                                                        
                                                        ${param.detailedExplanation ? `
                                                            <div class="mb-3">
                                                                <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Detailed Explanation:</div>
                                                                <p class="text-xs text-gray-600 dark:text-gray-400">${param.detailedExplanation}</p>
                                                            </div>
                                                        ` : ''}
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Quick Rule:</div>
                                                            <p class="text-xs text-gray-600 dark:text-gray-400">${param.quickRule}</p>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Performance Ranges:</div>
                                                            <div class="space-y-1">
                                                                <div class="flex items-center justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-xs">
                                                                    <span class="text-green-700 dark:text-green-300 font-medium">Optimal</span>
                                                                    <span class="text-green-800 dark:text-green-200">${param.optimal}</span>
                                                                </div>
                                                                <div class="flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded text-xs">
                                                                    <span class="text-yellow-700 dark:text-yellow-300 font-medium">Acceptable</span>
                                                                    <span class="text-yellow-800 dark:text-yellow-200">${param.acceptable}</span>
                                                                </div>
                                                                <div class="flex items-center justify-between p-2 bg-red-50 dark:bg-red-900/30 rounded text-xs">
                                                                    <span class="text-red-700 dark:text-red-300 font-medium">Risk</span>
                                                                    <span class="text-red-800 dark:text-red-200">${param.risk}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impact Assessment:</div>
                                                            <div class="flex gap-1 mb-2">
                                                                ${createImpactIndicator(param.impactScore.cost, 'cost')}
                                                                ${createImpactIndicator(param.impactScore.time, 'time')}
                                                                ${createImpactIndicator(param.impactScore.carbon, 'carbon')}
                                                            </div>
                                                            <p class="text-xs text-gray-600 dark:text-gray-400">${param.keyImpact}</p>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Key Benefits:</div>
                                                            <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                                                                ${param.benefits.map(benefit => `<li>• ${benefit}</li>`).join('')}
                                                            </ul>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Why This Matters:</div>
                                                            <p class="text-xs text-gray-600 dark:text-gray-400">${param.technicalNote}</p>
                                                        </div>
                                                        
                                                        <div>
                                                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Remediation Options:</div>
                                                            <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                                                                ${param.remediation.map(remedy => `<li>• ${remedy}</li>`).join('')}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    ${currentStatus === 'risk' ? `
                                                        <button 
                                                            class="comment-button w-4 h-4 rounded-full bg-orange-200 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 hover:bg-orange-300 hover:text-orange-800 flex items-center justify-center text-xs transition-colors"
                                                            onclick="toggleParameterComment('${param.id}')"
                                                            title="Add comment for out-of-range value"
                                                        >
                                                            <i data-lucide="message-circle" class="h-3 w-3"></i>
                                                        </button>
                                                    ` : ''}
                                                    <div class="status-indicator px-2 py-1 rounded text-xs font-medium ${getSimpleStatusClass(currentStatus)} ${currentStatus === 'risk' ? 'border-2 border-red-400 shadow-md' : ''}">
                                                        ${getSimpleStatusIcon(currentStatus)}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <p class="text-xs text-gray-600 dark:text-gray-400">${param.quickRule}</p>
                                            
                                            <div id="content-${param.id}" ${isMinimized ? 'class="hidden"' : ''}>
                                                ${isMinimized ? `
                                                    <div class="mb-3 p-3 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg">
                                                        <label class="block text-xs font-medium text-blue-800 dark:text-blue-200 mb-2">
                                                            Why was this subsection minimized?
                                                        </label>
                                                        <textarea 
                                                            id="minimize-reason-${param.id}"
                                                            rows="2"
                                                            placeholder="Enter reason for minimizing this parameter..."
                                                            class="w-full px-2 py-1 border border-blue-300 dark:border-blue-600 rounded text-xs bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-blue-500 focus:border-transparent"
                                                            onchange="updateParameterMinimizeReason('${param.id}', this.value)"
                                                        >${projectData.parameters[param.id]?.minimizeReason || ''}</textarea>
                                                    </div>
                                                ` : `
                                                    <div>
                                                        ${param.inputType === 'calculation' ? `
                                                            <div class="mb-2">
                                                                <div class="flex gap-1 mb-1">
                                                                    <button 
                                                                        type="button"
                                                                        id="mode-calculation-${param.id}"
                                                                        onclick="toggleInputMode('${param.id}', 'calculation')"
                                                                        class="flex-1 px-2 py-1 text-xs rounded bg-primary text-white"
                                                                    >
                                                                        Calculate
                                                                    </button>
                                                                    <button 
                                                                        type="button"
                                                                        id="mode-direct-${param.id}"
                                                                        onclick="toggleInputMode('${param.id}', 'direct')"
                                                                        class="flex-1 px-2 py-1 text-xs rounded bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300"
                                                                    >
                                                                        Direct
                                                                    </button>
                                                                </div>
                                                                <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">
                                                                    ${param.id === 'form-efficiency' ? 'Ratio = Perimeter (m) ÷ Area (m²)' : 'Ratio = Height (m) ÷ Width (m)'}
                                                                </p>
                                                            </div>
                                                            
                                                            <div id="calculation-inputs-${param.id}" class="space-y-2">
                                                                <div class="grid grid-cols-2 gap-1">
                                                                    <div>
                                                                        <label class="block text-xs text-gray-700 dark:text-gray-300">${param.calculation?.labels[0] || 'Perimeter (m)'}</label>
                                                                        <input 
                                                                            type="number" 
                                                                            id="${param.calculation?.inputs[0] || 'perimeter'}-${param.id}" 
                                                                            step="0.1"
                                                                            class="w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-primary focus:border-transparent"
                                                                            placeholder="0"
                                                                            onchange="calculateFormEfficiency('${param.id}')"
                                                                        >
                                                                    </div>
                                                                    <div>
                                                                        <label class="block text-xs text-gray-700 dark:text-gray-300">${param.calculation?.labels[1] || 'Area (m²)'}</label>
                                                                        <input 
                                                                            type="number" 
                                                                            id="${param.calculation?.inputs[1] || 'area'}-${param.id}" 
                                                                            step="0.1"
                                                                            class="w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-primary focus:border-transparent"
                                                                            placeholder="0"
                                                                            onchange="calculateFormEfficiency('${param.id}')"
                                                                        >
                                                                    </div>
                                                                </div>
                                                                <div class="flex gap-1">
                                                                    <input 
                                                                        type="number" 
                                                                        id="simple-input-${param.id}" 
                                                                        value="${currentValue}"
                                                                        step="0.001"
                                                                        readonly
                                                                        class="flex-1 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-gray-100"
                                                                        placeholder="Calculated ratio"
                                                                    >
                                                                    <button 
                                                                        type="button"
                                                                        onclick="useOptimalValueSimple('${param.id}')"
                                                                        class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors text-xs font-medium whitespace-nowrap"
                                                                        title="Use optimal value"
                                                                    >
                                                                        Opt
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            
                                                            <div id="direct-inputs-${param.id}" class="hidden">
                                                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                                                    Current Value ${param.unit ? '(' + param.unit + ')' : ''}
                                                                </label>
                                                                <div class="flex gap-1">
                                                                    <input 
                                                                        type="number" 
                                                                        id="direct-input-${param.id}" 
                                                                        value="${currentValue}"
                                                                        step="0.001"
                                                                        class="flex-1 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-primary focus:border-transparent"
                                                                        placeholder="Enter ratio directly"
                                                                        onchange="updateParameterValueSimple('${param.id}', this.value)"
                                                                    >
                                                                    <button 
                                                                        type="button"
                                                                        onclick="useOptimalValueSimple('${param.id}')"
                                                                        class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors text-xs font-medium whitespace-nowrap"
                                                                        title="Use optimal value"
                                                                    >
                                                                        Opt
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ` : `
                                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                                                Current Value ${param.unit ? '(' + param.unit + ')' : ''}
                                                            </label>
                                                            <div class="flex gap-1">
                                                                <input 
                                                                    type="number" 
                                                                    id="simple-input-${param.id}" 
                                                                    value="${currentValue}"
                                                                    step="0.1"
                                                                    class="flex-1 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-primary focus:border-transparent"
                                                                    placeholder="${param.inputHelp || 'Enter value'}"
                                                                    onchange="updateParameterValueSimple('${param.id}', this.value)"
                                                                >
                                                                <button 
                                                                    type="button"
                                                                    onclick="useOptimalValueSimple('${param.id}')"
                                                                    class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors text-xs font-medium whitespace-nowrap"
                                                                    title="Use optimal value"
                                                                >
                                                                    Opt
                                                                </button>
                                                            </div>
                                                            ${param.inputHelp ? `
                                                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 italic">
                                                                    ${param.inputHelp}
                                                                </p>
                                                            ` : ''}
                                                        `}
                                                    </div>
                                                `}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            initializeIcons();
        }

        function renderDetailedParameterInputs() {
            const container = document.getElementById('parameterInputs');
            
            container.innerHTML = parameters.map(param => {
                const currentValue = projectData.parameters[param.id]?.value || param.defaultValue;
                const currentStatus = projectData.parameters[param.id]?.status || 'not-considered';
                const isExpanded = projectData.parameters[param.id]?.expanded || false;
                const isConsidered = currentStatus !== 'not-considered';
                
                return `
                    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg transition-all duration-300 ${isConsidered ? 'ring-2 ring-primary/20' : ''}">
                        <!-- Parameter Header (Always Visible) -->
                        <div class="p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" onclick="toggleParameterExpansion('${param.id}')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3 flex-1">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="${isExpanded ? 'chevron-down' : 'chevron-right'}" class="h-5 w-5 text-gray-400 transition-transform duration-200"></i>
                                        <h3 class="text-base font-semibold text-gray-800 dark:text-gray-100">${param.parameter}</h3>
                                        <div class="relative">
                                            <button 
                                                class="info-button w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 hover:bg-primary hover:text-white flex items-center justify-center text-xs transition-colors"
                                                onclick="event.stopPropagation(); toggleParameterInfo('${param.id}')"
                                            >
                                                <i data-lucide="info" class="h-3 w-3"></i>
                                            </button>
                                            <div id="info-${param.id}" class="info-popup hidden absolute z-10 left-0 top-6 w-80 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4">
                                                <div class="mb-3">
                                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Definition:</div>
                                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">${param.definition}</p>
                                                    
                                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Performance Ranges:</div>
                                                    <div class="space-y-1">
                                                        <div class="flex items-center justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-xs">
                                                            <span class="text-green-700 dark:text-green-300 font-medium">Optimal</span>
                                                            <span class="text-green-800 dark:text-green-200">${param.optimal}</span>
                                                        </div>
                                                        <div class="flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded text-xs">
                                                            <span class="text-yellow-700 dark:text-yellow-300 font-medium">Acceptable</span>
                                                            <span class="text-yellow-800 dark:text-yellow-200">${param.acceptable}</span>
                                                        </div>
                                                        <div class="flex items-center justify-between p-2 bg-red-50 dark:bg-red-900/30 rounded text-xs">
                                                            <span class="text-red-700 dark:text-red-300 font-medium">Risk</span>
                                                            <span class="text-red-800 dark:text-red-200">${param.risk}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impact Scores:</div>
                                                    <div class="flex space-x-1">
                                                        ${createImpactIndicator(param.impactScore.cost, 'cost')}
                                                        ${createImpactIndicator(param.impactScore.time, 'time')}
                                                        ${createImpactIndicator(param.impactScore.carbon, 'carbon')}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${param.category} • ${param.quickRule}</p>
                                        ${isConsidered ? `<p class="text-sm font-medium text-primary mt-1">Value: ${currentValue}${param.unit}</p>` : ''}
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-3">
                                    <div class="status-badge px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(currentStatus)}">
                                        ${getStatusLabel(currentStatus)}
                                    </div>
                                    ${isConsidered ? '<i data-lucide="check-circle" class="h-5 w-5 text-green-500"></i>' : '<i data-lucide="circle" class="h-5 w-5 text-gray-300"></i>'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expanded Input Section -->
                        <div id="expanded-${param.id}" class="parameter-inputs ${isExpanded ? 'block' : 'hidden'} border-t border-gray-200 dark:border-gray-600 p-4 bg-gray-50 dark:bg-gray-700">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        ${param.inputLabel || `Current Value (${param.unit})`}
                                    </label>
                                    <div class="flex space-x-2">
                                        <input 
                                            type="number" 
                                            id="input-${param.id}" 
                                            value="${currentValue}"
                                            step="0.1"
                                            class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"
                                            onchange="updateParameterValue('${param.id}', this.value)"
                                        >
                                        <button 
                                            onclick="useOptimalValue('${param.id}')"
                                            class="px-4 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors text-sm font-medium whitespace-nowrap"
                                        >
                                            Use Optimal
                                        </button>
                                    </div>
                                    ${param.inputHelp ? `
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 italic">
                                            ${param.inputHelp}
                                        </p>
                                    ` : ''}
                                </div>
                                
                                <div>
                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Key impacts:</div>
                                    <div class="flex flex-wrap gap-2">
                                        ${param.benefits.map(benefit => `
                                            <span class="inline-block bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-700 rounded-full px-3 py-1 text-xs">
                                                ${benefit}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                ${currentStatus === 'risk' || currentStatus === 'acceptable' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Reason for deviation from optimal:
                                        </label>
                                        <textarea 
                                            id="reason-${param.id}"
                                            rows="2"
                                            placeholder="Explain why this parameter deviates from optimal..."
                                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-base bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent"
                                            onchange="updateParameterReason('${param.id}', this.value)"
                                        >${projectData.parameters[param.id]?.reason || ''}</textarea>
                                    </div>
                                ` : ''}
                                
                                <div class="flex justify-between items-center pt-2 border-t border-gray-200 dark:border-gray-600">
                                    <button 
                                        onclick="removeParameterFromConsideration('${param.id}')"
                                        class="text-sm text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors"
                                    >
                                        <i data-lucide="x" class="h-4 w-4 inline mr-1"></i>
                                        Remove from consideration
                                    </button>
                                    <button 
                                        onclick="toggleParameterExpansion('${param.id}')"
                                        class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium"
                                    >
                                        Done
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            initializeIcons();
        }

        // All other existing functions remain the same...
        // (I'll include just the key navigation functions and parameter handling)

        function updateParameterValueSimple(paramId, value) {
            const param = parameters.find(p => p.id === paramId);
            const numValue = parseFloat(value);
            
            if (isNaN(numValue)) return;
            
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            
            projectData.parameters[paramId].value = numValue;
            projectData.parameters[paramId].status = evaluateParameterStatus(param, numValue);
            
            // Update visual status indicator immediately
            const statusElement = document.querySelector(`#param-container-${paramId} .status-indicator`);
            if (statusElement) {
                const currentStatus = projectData.parameters[paramId].status;
                statusElement.className = `status-indicator px-2 py-1 rounded text-xs font-medium ${getSimpleStatusClass(currentStatus)} ${currentStatus === 'risk' ? 'border-2 border-red-400 shadow-md' : ''}`;
                statusElement.textContent = getSimpleStatusIcon(currentStatus);
            }
        }

        function evaluateParameterStatus(param, value) {
            if (value >= param.ranges.optimal.min && value <= param.ranges.optimal.max) {
                return 'optimal';
            } else if (value >= param.ranges.acceptable.min && value <= param.ranges.acceptable.max) {
                return 'acceptable';
            } else {
                return 'risk';
            }
        }

        function getSimpleStatusClass(status) {
            switch(status) {
                case 'optimal': return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300';
                case 'acceptable': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300';
                case 'risk': return 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300';
                default: return 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400';
            }
        }

        function getSimpleStatusIcon(status) {
            switch(status) {
                case 'optimal': return '✓';
                case 'acceptable': return '~';
                case 'risk': return '⚠';
                default: return '−';
            }
        }

        function getStatusClass(status) {
            switch(status) {
                case 'optimal': return 'status-met';
                case 'acceptable': return 'status-met';
                case 'risk': return 'status-risk';
                case 'not-considered': return 'status-not-considered';
                default: return 'status-not-considered';
            }
        }

        function getStatusLabel(status) {
            switch(status) {
                case 'optimal': return '✓ Optimal';
                case 'acceptable': return '~ Acceptable';
                case 'risk': return '⚠ Risk';
                case 'not-considered': return '− Not Considered';
                default: return '− Not Considered';
            }
        }

        function createImpactIndicator(score, type) {
            const icons = {
                cost: 'dollar-sign',
                carbon: 'leaf',
                time: 'clock'
            };
            
            const colors = {
                High: 'text-red-600 bg-red-50 dark:text-red-400 dark:bg-red-900/30',
                Medium: 'text-yellow-600 bg-yellow-50 dark:text-yellow-400 dark:bg-yellow-900/30',
                Low: 'text-green-600 bg-green-50 dark:text-green-400 dark:bg-green-900/30'
            };
            
            return `
                <div class="impact-indicator flex items-center px-2 py-1 rounded-full ${colors[score] || colors.Low}">
                    <i data-lucide="${icons[type]}" class="h-4 w-4"></i>
                    <span class="ml-1 text-xs font-semibold">${score}</span>
                </div>
            `;
        }

        // Analysis page functions
        function proceedToAnalysis() {
            projectData.name = document.getElementById('projectName').value;
            projectData.type = document.getElementById('buildingType').value;
            showPage('analysis');
        }

        function proceedToSummary() {
            showPage('summary');
        }

        function renderQuickRulesView() {
            const container = document.getElementById('quickRulesView');
            const filteredParams = getFilteredParameters();
            
            if (filteredParams.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i data-lucide="search" class="h-12 w-12 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 dark:text-gray-400">No parameters match your search criteria.</p>
                    </div>
                `;
                initializeIcons();
                return;
            }
            
            container.innerHTML = filteredParams.map(param => {
                const paramData = projectData.parameters[param.id];
                const status = paramData?.status || 'not-considered';
                const statusIcon = status === 'optimal' ? '✅' : status === 'acceptable' ? '⚠️' : status === 'risk' ? '❌' : '➖';
                
                return `
                    <div class="card-hover bg-gray-50 dark:bg-gray-700 rounded-lg p-4 sm:p-5 cursor-pointer transition-colors duration-300"
                         onclick="showParameterDetail('${param.id}')">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 pr-4">
                                <div class="flex items-center mb-2">
                                    <span class="text-lg mr-2">${statusIcon}</span>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">${param.quickRule}</h3>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">${param.parameter} • ${param.category}</p>
                                ${paramData?.value ? `
                                    <p class="text-sm font-medium text-primary mb-2">Your value: ${paramData.value}${param.unit}</p>
                                ` : ''}
                                <div>
                                    <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">Key impacts:</div>
                                    <div class="flex flex-wrap gap-2">
                                        ${param.benefits.map(benefit => `
                                            <span class="inline-block bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded-full px-3 py-1 text-xs text-gray-700 dark:text-gray-200">
                                                ${benefit}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="h-5 w-5 text-gray-400 flex-shrink-0"></i>
                        </div>
                    </div>
                `;
            }).join('');
            
            initializeIcons();
        }

        function renderTechnicalView() {
            const tbody = document.getElementById('technicalTableBody');
            const filteredParams = getFilteredParameters();
            
            tbody.innerHTML = filteredParams.map(param => {
                const paramData = projectData.parameters[param.id];
                const value = paramData?.value || param.defaultValue;
                const status = paramData?.status || 'not-considered';
                
                return `
                    <tr class="border-b border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-300">
                        <td class="p-3">
                            <div class="flex items-center gap-2">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-gray-100">${param.parameter}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${param.category}</p>
                                </div>
                            </div>
                        </td>
                        <td class="p-3">
                            <span class="font-semibold">${value}${param.unit}</span>
                        </td>
                        <td class="p-3">
                            <span class="status-badge px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(status)}">
                                ${getStatusLabel(status)}
                            </span>
                        </td>
                        <td class="p-3 text-green-600 dark:text-green-400 font-semibold">${param.optimal}</td>
                        <td class="p-3 text-primary font-medium">${param.action}</td>
                        <td class="p-3">
                            <div class="flex justify-center space-x-1">
                                ${createImpactIndicator(param.impactScore.cost, 'cost')}
                                ${createImpactIndicator(param.impactScore.time, 'time')}
                                ${createImpactIndicator(param.impactScore.carbon, 'carbon')}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            initializeIcons();
        }

        // Summary page functions
        function renderSummaryPage() {
            renderProjectOverview();
            renderParameterStatusGrid();
            renderOverallAssessment();
        }

        function renderProjectOverview() {
            const container = document.getElementById('projectOverview');
            const totalParams = parameters.length;
            const consideredParams = Object.values(projectData.parameters).filter(p => p.status !== 'not-considered').length;
            const optimalParams = Object.values(projectData.parameters).filter(p => p.status === 'optimal').length;
            const riskParams = Object.values(projectData.parameters).filter(p => p.status === 'risk').length;
            
            container.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Project Overview</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-gray-800 dark:text-gray-100">${projectData.name || 'Unnamed Project'}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">${projectData.type || 'Building Type'}</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">${consideredParams}/${totalParams}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Parameters Considered</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600">${optimalParams}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Optimal Parameters</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-600">${riskParams}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Risk Parameters</div>
                    </div>
                </div>
            `;
        }

        function renderParameterStatusGrid() {
            const container = document.getElementById('parameterStatusGrid');
            
            container.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Parameter Checklist</h3>
                    <div class="space-y-4">
                        ${parameters.map(param => {
                            const paramData = projectData.parameters[param.id];
                            const value = paramData?.value || param.defaultValue;
                            const status = paramData?.status || 'not-considered';
                            const reason = paramData?.reason || '';
                            
                            return `
                                <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center">
                                            <span class="text-lg mr-3">${status === 'optimal' ? '✅' : status === 'acceptable' ? '⚠️' : status === 'risk' ? '❌' : '➖'}</span>
                                            <div>
                                                <h4 class="font-medium text-gray-800 dark:text-gray-100">${param.parameter}</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">${param.category}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-semibold text-gray-800 dark:text-gray-100">${value}${param.unit}</div>
                                            <span class="status-badge px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(status)}">
                                                ${getStatusLabel(status)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    ${status === 'risk' || status === 'acceptable' ? `
                                        <div class="mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded">
                                            <div class="text-sm font-medium text-yellow-800 dark:text-yellow-200 mb-1">Reason for deviation:</div>
                                            <div class="text-sm text-yellow-700 dark:text-yellow-300">${reason || 'No reason provided'}</div>
                                        </div>
                                    ` : ''}
                                    
                                    ${status === 'not-considered' ? `
                                        <div class="mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded">
                                            <div class="text-sm text-gray-600 dark:text-gray-400">This parameter was not considered in the analysis.</div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderOverallAssessment() {
            const container = document.getElementById('overallAssessment');
            const totalParams = parameters.length;
            const consideredParams = Object.values(projectData.parameters).filter(p => p.status !== 'not-considered').length;
            const optimalParams = Object.values(projectData.parameters).filter(p => p.status === 'optimal').length;
            const riskParams = Object.values(projectData.parameters).filter(p => p.status === 'risk').length;
            
            const completionRate = Math.round((consideredParams / totalParams) * 100);
            const optimizationRate = consideredParams > 0 ? Math.round((optimalParams / consideredParams) * 100) : 0;
            
            // Check if all parameters are considered
            const allParametersConsidered = consideredParams === totalParams;
            
            if (!allParametersConsidered) {
                // Show only recommendations when not all parameters are provided
                const missingParams = totalParams - consideredParams;
                const missingParamsList = parameters
                    .filter(param => !projectData.parameters[param.id] || projectData.parameters[param.id].status === 'not-considered')
                    .map(param => param.parameter);
                
                container.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Analysis Status</h3>
                    <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-6">
                        <div class="flex items-start gap-3">
                            <i data-lucide="alert-triangle" class="h-6 w-6 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"></i>
                            <div>
                                <h4 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">Incomplete Analysis</h4>
                                <p class="text-yellow-700 dark:text-yellow-300 mb-4">
                                    You have analyzed ${consideredParams} out of ${totalParams} parameters (${completionRate}%). 
                                    Please consider the remaining ${missingParams} parameter${missingParams > 1 ? 's' : ''} for a complete assessment.
                                </p>
                                
                                <div class="mb-4">
                                    <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">Missing Parameters:</h5>
                                    <ul class="list-disc list-inside text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                        ${missingParamsList.map(param => `<li>${param}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div class="bg-yellow-100 dark:bg-yellow-800/30 rounded p-3">
                                    <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">Recommendations:</h5>
                                    <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                        <li>• Complete all parameter inputs for comprehensive analysis</li>
                                        <li>• Focus on high-impact parameters (cost and carbon scores)</li>
                                        <li>• Consider project-specific constraints when setting values</li>
                                        <li>• Review parameter definitions using the info (ℹ️) icons if needed</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Show full assessment when all parameters are provided
                let overallGrade, gradeColor, recommendation;
                
                if (optimizationRate >= 80 && riskParams === 0) {
                    overallGrade = 'Acceptable - Subject to Detailed Analysis';
                    gradeColor = 'text-green-600';
                    recommendation = 'Your design demonstrates good efficiency principles. Consider detailed structural and MEP analysis to confirm performance.';
                } else if (optimizationRate >= 60 && riskParams <= 1) {
                    overallGrade = 'Review Required';
                    gradeColor = 'text-blue-600';
                    recommendation = 'Some efficiency foundations in place. Detailed analysis required for optimization and risk mitigation.';
                } else if (optimizationRate >= 40 || riskParams <= 2) {
                    overallGrade = 'Redesign Recommended';
                    gradeColor = 'text-yellow-600';
                    recommendation = 'Significant improvements needed. Focus on addressing risk parameters and redesigning key elements.';
                } else {
                    overallGrade = 'Major Revision Required';
                    gradeColor = 'text-red-600';
                    recommendation = 'Comprehensive redesign required. Multiple efficiency opportunities need to be addressed.';
                }
                
                // Determine completeness qualitatively based on provided information
                let completenessQuality = '';
                let completenessColor = '';
                
                if (consideredParams >= 8) {
                    completenessQuality = 'Comprehensive';
                    completenessColor = 'text-green-600';
                } else if (consideredParams >= 6) {
                    completenessQuality = 'Good';
                    completenessColor = 'text-blue-600';
                } else if (consideredParams >= 4) {
                    completenessQuality = 'Partial';
                    completenessColor = 'text-yellow-600';
                } else {
                    completenessQuality = 'Limited';
                    completenessColor = 'text-red-600';
                }
                
                container.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Overall Assessment</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold ${gradeColor} mb-2">${overallGrade}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Overall Grade</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold ${completenessColor} mb-2">${completenessQuality}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Analysis Completeness</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600 mb-2">${optimalParams}/${consideredParams}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Optimal Parameters</div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Assessment Summary</h4>
                        <p class="text-blue-700 dark:text-blue-300">${recommendation}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs text-gray-600 dark:text-gray-400">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-3">
                            <strong>Overall Grade:</strong> Professional assessment based on parameter optimization and risk factors
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-3">
                            <strong>Analysis Completeness:</strong> Quality assessment based on number and variety of parameters provided
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-3">
                            <strong>Optimal Parameters:</strong> Number of parameters achieving optimal performance out of total analyzed
                        </div>
                    </div>
                `;
            }
            
            initializeIcons();
        }

        // Export functions
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('Design Efficiency Analysis Report', 20, 30);
            
            // Project info
            doc.setFontSize(12);
            doc.text(`Project: ${projectData.name || 'Unnamed Project'}`, 20, 50);
            doc.text(`Building Type: ${projectData.type || 'Not specified'}`, 20, 60);
            doc.text(`Analysis Date: ${new Date().toLocaleDateString()}`, 20, 70);
            
            // Parameters summary
            let yPosition = 90;
            doc.setFontSize(14);
            doc.text('Parameter Analysis Summary', 20, yPosition);
            yPosition += 20;
            
            doc.setFontSize(10);
            parameters.forEach(param => {
                const paramData = projectData.parameters[param.id];
                const value = paramData?.value || param.defaultValue;
                const status = paramData?.status || 'not-considered';
                const reason = paramData?.reason || '';
                
                doc.text(`${param.parameter}: ${value}${param.unit} - ${getStatusLabel(status)}`, 20, yPosition);
                yPosition += 10;
                
                if (reason && yPosition < 280) {
                    doc.text(`  Reason: ${reason}`, 25, yPosition);
                    yPosition += 10;
                }
                
                if (yPosition > 280) {
                    doc.addPage();
                    yPosition = 30;
                }
            });
            
            doc.save(`design-efficiency-report-${Date.now()}.pdf`);
        }

        function exportToCSV() {
            const data = parameters.map(param => {
                const paramData = projectData.parameters[param.id];
                return {
                    Parameter: param.parameter,
                    Category: param.category,
                    'Current Value': paramData?.value || param.defaultValue,
                    Unit: param.unit,
                    Status: paramData?.status || 'not-considered',
                    'Optimal Range': param.optimal,
                    'Action Required': param.action,
                    'Reason for Deviation': paramData?.reason || '',
                    'Cost Impact': param.impactScore.cost,
                    'Time Impact': param.impactScore.time,
                    'Carbon Impact': param.impactScore.carbon
                };
            });
            
            const headers = Object.keys(data[0]);
            const csv = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `design-efficiency-analysis-${Date.now()}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function generatePresentation() {
            // Create a simple HTML presentation that can be saved
            const presentationContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Design Efficiency Presentation</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        .slide { page-break-after: always; margin-bottom: 40px; }
                        h1 { color: #5D5CDE; border-bottom: 3px solid #5D5CDE; padding-bottom: 10px; }
                        h2 { color: #333; margin-top: 30px; }
                        .status-optimal { color: green; font-weight: bold; }
                        .status-risk { color: red; font-weight: bold; }
                        .status-acceptable { color: orange; font-weight: bold; }
                        .status-not-considered { color: gray; }
                        .parameter { margin: 20px 0; padding: 15px; border-left: 4px solid #5D5CDE; background: #f9f9f9; }
                    </style>
                </head>
                <body>
                    <div class="slide">
                        <h1>Design Efficiency Analysis</h1>
                        <h2>Project Overview</h2>
                        <p><strong>Project:</strong> ${projectData.name || 'Unnamed Project'}</p>
                        <p><strong>Building Type:</strong> ${projectData.type || 'Not specified'}</p>
                        <p><strong>Analysis Date:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="slide">
                        <h1>Parameter Analysis</h1>
                        ${parameters.map(param => {
                            const paramData = projectData.parameters[param.id];
                            const value = paramData?.value || param.defaultValue;
                            const status = paramData?.status || 'not-considered';
                            const reason = paramData?.reason || '';
                            
                            return `
                                <div class="parameter">
                                    <h3>${param.parameter}</h3>
                                    <p><strong>Current Value:</strong> ${value}${param.unit}</p>
                                    <p><strong>Status:</strong> <span class="status-${status}">${getStatusLabel(status)}</span></p>
                                    <p><strong>Optimal Range:</strong> ${param.optimal}</p>
                                    ${reason ? `<p><strong>Reason for Deviation:</strong> ${reason}</p>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([presentationContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `design-efficiency-presentation-${Date.now()}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetTool() {
            projectData = { name: '', type: '', parameters: {} };
            showPage('landing');
            document.getElementById('projectName').value = '';
            document.getElementById('buildingType').value = '';
        }

        // Utility functions
        function getFilteredParameters() {
            return parameters.filter(p => {
                const matchesCategory = filterCategory === 'all' || p.category === filterCategory;
                const matchesSearch = 
                    p.parameter.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.quickRule.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesCategory && matchesSearch;
            });
        }

        function initializeCategoryFilter() {
            const select = document.getElementById('categoryFilter');
            select.innerHTML = '<option value="all">All Categories</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        function switchViewMode(mode) {
            viewMode = mode;
            
            // Update button states
            document.querySelectorAll('.view-toggle').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
            });
            
            if (mode === 'decision') {
                document.getElementById('quickRulesBtn').classList.remove('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
                document.getElementById('quickRulesBtn').classList.add('bg-primary', 'text-white');
                document.getElementById('quickRulesView').classList.remove('hidden');
                document.getElementById('technicalView').classList.add('hidden');
                renderQuickRulesView();
            } else {
                document.getElementById('technicalViewBtn').classList.remove('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
                document.getElementById('technicalViewBtn').classList.add('bg-primary', 'text-white');
                document.getElementById('quickRulesView').classList.add('hidden');
                document.getElementById('technicalView').classList.remove('hidden');
                renderTechnicalView();
            }
        }

        // Parameter manipulation functions
        function useOptimalValueSimple(paramId) {
            const param = parameters.find(p => p.id === paramId);
            const optimalValue = (param.ranges.optimal.min + param.ranges.optimal.max) / 2;
            
            const inputElement = document.getElementById(`simple-input-${paramId}`) || document.getElementById(`direct-input-${paramId}`);
            if (inputElement) {
                inputElement.value = optimalValue;
                updateParameterValueSimple(paramId, optimalValue);
            }
        }

        function useOptimalValue(paramId) {
            const param = parameters.find(p => p.id === paramId);
            const optimalValue = (param.ranges.optimal.min + param.ranges.optimal.max) / 2;
            
            document.getElementById(`input-${paramId}`).value = optimalValue;
            updateParameterValue(paramId, optimalValue);
        }

        function toggleParameterExpansion(paramId) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            
            const isCurrentlyExpanded = projectData.parameters[paramId].expanded || false;
            const newExpandedState = !isCurrentlyExpanded;
            
            // If expanding for the first time, consider the parameter
            if (newExpandedState && projectData.parameters[paramId].status === 'not-considered') {
                const param = parameters.find(p => p.id === paramId);
                const value = projectData.parameters[paramId].value || param.defaultValue;
                projectData.parameters[paramId].status = evaluateParameterStatus(param, value);
                projectData.parameters[paramId].value = value;
            }
            
            projectData.parameters[paramId].expanded = newExpandedState;
            renderParameterInputs();
        }

        function updateParameterValue(paramId, value) {
            const param = parameters.find(p => p.id === paramId);
            const numValue = parseFloat(value);
            
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            
            projectData.parameters[paramId].value = numValue;
            projectData.parameters[paramId].status = evaluateParameterStatus(param, numValue);
            
            // Re-render to update status badge and reason field
            renderParameterInputs();
        }

        function updateParameterReason(paramId, reason) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            projectData.parameters[paramId].reason = reason;
        }

        function removeParameterFromConsideration(paramId) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            
            projectData.parameters[paramId].status = 'not-considered';
            projectData.parameters[paramId].expanded = false;
            projectData.parameters[paramId].reason = '';
            
            renderParameterInputs();
        }

        function excludeParameterFromAnalysis(paramId) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            projectData.parameters[paramId].minimized = true;
            projectData.parameters[paramId].status = 'not-considered';
            renderParameterInputs();
        }

        function includeParameterInAnalysis(paramId) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            projectData.parameters[paramId].minimized = false;
            
            // Reset to default value and re-evaluate
            const param = parameters.find(p => p.id === paramId);
            const value = projectData.parameters[paramId].value || param.defaultValue;
            projectData.parameters[paramId].value = value;
            projectData.parameters[paramId].status = evaluateParameterStatus(param, value);
            
            renderParameterInputs();
        }

        function updateParameterMinimizeReason(paramId, reason) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            projectData.parameters[paramId].minimizeReason = reason;
        }

        function toggleParameterInfo(paramId) {
            // Hide all other info popups
            document.querySelectorAll('.info-popup').forEach(popup => {
                if (popup.id !== `info-${paramId}`) {
                    popup.classList.add('hidden');
                }
            });
            
            // Toggle current popup
            const popup = document.getElementById(`info-${paramId}`);
            if (popup) {
                popup.classList.toggle('hidden');
            }
        }

        function toggleParameterComment(paramId) {
            const existingComment = document.getElementById(`comment-section-${paramId}`);
            
            if (existingComment) {
                existingComment.remove();
                return;
            }
            
            const paramContainer = document.getElementById(`param-container-${paramId}`);
            if (paramContainer) {
                const commentSection = document.createElement('div');
                commentSection.id = `comment-section-${paramId}`;
                commentSection.className = 'mt-2 p-3 bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700 rounded-lg';
                commentSection.innerHTML = `
                    <div class="flex items-start gap-2 mb-2">
                        <i data-lucide="message-circle" class="h-4 w-4 text-orange-600 dark:text-orange-400 mt-0.5 flex-shrink-0"></i>
                        <label class="text-xs font-medium text-orange-800 dark:text-orange-200">
                            Comment on out-of-range value:
                        </label>
                    </div>
                    <textarea 
                        id="comment-${paramId}"
                        rows="2"
                        placeholder="Explain why this value is beyond expected range or provide additional context..."
                        class="w-full px-2 py-1 border border-orange-300 dark:border-orange-600 rounded text-xs bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-orange-500 focus:border-transparent"
                        onchange="updateParameterComment('${paramId}', this.value)"
                    >${projectData.parameters[paramId]?.comment || ''}</textarea>
                    <div class="flex justify-end mt-2">
                        <button 
                            onclick="toggleParameterComment('${paramId}')"
                            class="text-xs text-orange-600 hover:text-orange-700 transition-colors"
                        >
                            Close
                        </button>
                    </div>
                `;
                paramContainer.appendChild(commentSection);
                initializeIcons();
            }
        }

        function updateParameterComment(paramId, comment) {
            if (!projectData.parameters[paramId]) {
                projectData.parameters[paramId] = {};
            }
            projectData.parameters[paramId].comment = comment;
        }

        function toggleInputMode(paramId, mode) {
            const calculationBtn = document.getElementById(`mode-calculation-${paramId}`);
            const directBtn = document.getElementById(`mode-direct-${paramId}`);
            const calculationInputs = document.getElementById(`calculation-inputs-${paramId}`);
            const directInputs = document.getElementById(`direct-inputs-${paramId}`);
            
            if (mode === 'calculation') {
                calculationBtn.className = 'flex-1 px-2 py-1 text-xs rounded bg-primary text-white';
                directBtn.className = 'flex-1 px-2 py-1 text-xs rounded bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300';
                calculationInputs.classList.remove('hidden');
                directInputs.classList.add('hidden');
            } else {
                calculationBtn.className = 'flex-1 px-2 py-1 text-xs rounded bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300';
                directBtn.className = 'flex-1 px-2 py-1 text-xs rounded bg-primary text-white';
                calculationInputs.classList.add('hidden');
                directInputs.classList.remove('hidden');
            }
        }

        function calculateFormEfficiency(paramId) {
            const param = parameters.find(p => p.id === paramId);
            
            if (param.calculation) {
                const [input1Name, input2Name] = param.calculation.inputs;
                const input1 = document.getElementById(`${input1Name}-${paramId}`);
                const input2 = document.getElementById(`${input2Name}-${paramId}`);
                const resultInput = document.getElementById(`simple-input-${paramId}`);
                
                const value1 = parseFloat(input1.value) || 0;
                const value2 = parseFloat(input2.value) || 0;
                
                if (value1 > 0 && value2 > 0) {
                    let ratio;
                    if (param.calculation.formula === 'perimeter / area') {
                        ratio = value1 / value2;
                    } else if (param.calculation.formula === 'height / width') {
                        ratio = value1 / value2;
                    }
                    
                    resultInput.value = ratio.toFixed(3);
                    updateParameterValueSimple(paramId, ratio);
                } else {
                    resultInput.value = '';
                }
            }
        }

        function toggleBuildingTypeInfo() {
            const popup = document.getElementById('buildingTypeInfo');
            popup.classList.toggle('hidden');
        }

        function showBuildingTypeInfo() {
            const popup = document.getElementById('buildingTypeInfo');
            popup.classList.remove('hidden');
        }

        function hideBuildingTypeInfo() {
            const popup = document.getElementById('buildingTypeInfo');
            popup.classList.add('hidden');
        }

        // Modal functions
        function showParameterDetail(paramId) {
            const param = parameters.find(p => p.id === paramId);
            if (!param) return;
            
            selectedParameter = param;
            const paramData = projectData.parameters[param.id];
            
            document.getElementById('modalTitle').textContent = param.quickRule;
            document.getElementById('modalSubtitle').textContent = `${param.parameter} • ${param.category}`;
            
            document.getElementById('modalContent').innerHTML = `
                ${paramData ? `
                    <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                        <p class="text-sm font-semibold text-blue-800 dark:text-blue-200 mb-1">Your Project Status</p>
                        <div class="flex items-center justify-between">
                            <span>Current Value: <strong>${paramData.value || param.defaultValue}${param.unit}</strong></span>
                            <span class="status-badge px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(paramData.status || 'not-considered')}">
                                ${getStatusLabel(paramData.status || 'not-considered')}
                            </span>
                        </div>
                        ${paramData.reason ? `<p class="text-sm text-blue-700 dark:text-blue-300 mt-2"><strong>Reason:</strong> ${paramData.reason}</p>` : ''}
                    </div>
                ` : ''}

                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-1">Why this matters</p>
                    <p class="text-gray-700 dark:text-gray-300">${param.technicalNote}</p>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Benefit Summary</h3>
                    <ul class="list-disc ml-5 text-gray-700 dark:text-gray-300">
                        ${param.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Performance Levels</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-green-50 dark:bg-green-900/30 p-3 rounded-lg border border-green-200 dark:border-green-700">
                            <p class="text-sm font-semibold text-green-700 dark:text-green-300">Good</p>
                            <p class="text-lg font-bold text-green-800 dark:text-green-200">${param.optimal}</p>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/30 p-3 rounded-lg border border-yellow-200 dark:border-yellow-700">
                            <p class="text-sm font-semibold text-yellow-700 dark:text-yellow-300">OK</p>
                            <p class="text-lg font-bold text-yellow-800 dark:text-yellow-200">${param.acceptable}</p>
                        </div>
                        <div class="bg-red-50 dark:bg-red-900/30 p-3 rounded-lg border border-red-200 dark:border-red-700">
                            <p class="text-sm font-semibold text-red-700 dark:text-red-300">Risk</p>
                            <p class="text-lg font-bold text-red-800 dark:text-red-200">${param.risk}</p>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Remediation Options</h3>
                    ${param.remediation.map(remedy => `
                        <div class="flex items-start mb-2">
                            <i data-lucide="check-circle" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                            <p class="text-gray-700 dark:text-gray-300">${remedy}</p>
                        </div>
                    `).join('')}
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 dark:text-gray-100 mb-3">Impact Assessment</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                ${createImpactIndicator(param.impactScore.cost, 'cost')}
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Cost Impact</p>
                        </div>
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                ${createImpactIndicator(param.impactScore.time, 'time')}
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Schedule Impact</p>
                        </div>
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                ${createImpactIndicator(param.impactScore.carbon, 'carbon')}
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Carbon Impact</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('detailModal').classList.remove('hidden');
            initializeIcons();
        }

        function showBIMIntegration() {
            document.getElementById('bimModal').classList.remove('hidden');
        }

        function closeBIMIntegration() {
            document.getElementById('bimModal').classList.add('hidden');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            showPage('landing');
            setupFileUpload();
            initializeIcons();
            
            // Search input
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchTerm = e.target.value;
                if (viewMode === 'decision') {
                    renderQuickRulesView();
                } else {
                    renderTechnicalView();
                }
            });
            
            // Category filter
            document.getElementById('categoryFilter').addEventListener('change', function(e) {
                filterCategory = e.target.value;
                if (viewMode === 'decision') {
                    renderQuickRulesView();
                } else {
                    renderTechnicalView();
                }
            });
            
            // View toggle buttons
            document.getElementById('quickRulesBtn').addEventListener('click', () => switchViewMode('decision'));
            document.getElementById('technicalViewBtn').addEventListener('click', () => switchViewMode('technical'));
            
            // Modal close handlers
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('detailModal').classList.add('hidden');
                selectedParameter = null;
            });
            
            document.getElementById('closeBimModal').addEventListener('click', function() {
                document.getElementById('bimModal').classList.add('hidden');
            });

            document.getElementById('closeFileUploadModal').addEventListener('click', function() {
                closeFileUploadModal();
            });
            
            // Modal backdrop click handlers
            document.getElementById('detailModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                    selectedParameter = null;
                }
            });
            
            document.getElementById('bimModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });

            document.getElementById('fileUploadModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeFileUploadModal();
                }
            });
        });

        // Close info popups when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.info-button') && !e.target.closest('.info-popup')) {
                document.querySelectorAll('.info-popup').forEach(popup => {
                    popup.classList.add('hidden');
                });
            }
        });

        // BIM Code tab functions
        function showCodeTab(tabName) {
            // Hide all code content
            document.querySelectorAll('.code-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected content
            document.getElementById(tabName + 'Code').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.className = 'code-tab flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300';
            });
            
            document.getElementById(tabName + 'Tab').className = 'code-tab flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors bg-white dark:bg-gray-500 text-gray-900 dark:text-gray-100';
        }

        function downloadBIMCode() {
            // Create a ZIP-like structure with all code examples
            const codeExamples = {
                'ifc_extraction.py': document.querySelector('#ifcCode pre code').textContent,
                'revit_api_extraction.cs': document.querySelector('#revitCode pre code').textContent,
                'statistical_analysis.py': document.querySelector('#statisticsCode pre code').textContent,
                'README.md': `# BIM Integration Code Examples

This package contains code examples for integrating the Practical Design Efficiency Tool with BIM workflows.

## Files Included:

1. **ifc_extraction.py** - Python code for extracting parameters from IFC models using ifcopenshell
2. **revit_api_extraction.cs** - C# code for Revit API parameter extraction
3. **statistical_analysis.py** - Python code for statistical analysis and significance testing

## Requirements:

### For IFC Extraction:
- Python 3.7+
- ifcopenshell
- numpy
- pandas
- scipy

### For Revit API:
- Autodesk Revit 2020+
- Visual Studio with .NET Framework 4.8
- Revit API SDK

### For Statistical Analysis:
- Python 3.7+
- numpy
- pandas
- scipy
- scikit-learn
- matplotlib
- seaborn

## Installation:

\`\`\`bash
pip install ifcopenshell numpy pandas scipy scikit-learn matplotlib seaborn
\`\`\`

## Usage:

See individual files for detailed usage instructions and examples.

## Support:

For questions and support, contact Lendlease Integrated Solutions team.
`
            };
            
            // Create and download individual files
            Object.entries(codeExamples).forEach(([filename, content]) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            });
            
            showNotification('BIM integration code examples downloaded successfully!', 'success');
        }

        function contactBIMSupport() {
            // Create a mailto link with pre-filled content
            const subject = 'BIM Integration Support Request - Practical Design Efficiency Tool';
            const body = `Hello Lendlease Integrated Solutions Team,

I am interested in implementing BIM integration for the Practical Design Efficiency Tool in my workflow.

Project Details:
- Project Name: ${projectData.name || 'Not specified'}
- Building Type: ${projectData.type || 'Not specified'}
- BIM Software: [Please specify - Revit/ArchiCAD/Bentley/Other]
- Model Format: [IFC/Native format]

Specific Requirements:
- [ ] Automated parameter extraction
- [ ] Statistical impact analysis
- [ ] Compliance checking
- [ ] Custom parameter definitions
- [ ] Integration with existing workflows

Additional Information:
[Please provide any additional details about your requirements]

Thank you for your assistance.

Best regards,
[Your Name]`;

            const mailtoLink = `mailto:integratedsolutions@lendlease.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoLink);
        }

        // Comprehensive Design Guide functions
        function showComprehensiveGuide() {
            document.getElementById('comprehensiveGuideModal').classList.remove('hidden');
            showGuideSection('overview');
        }

        function showStatisticalMethodology() {
            document.getElementById('statisticalMethodologyModal').classList.remove('hidden');
        }

        function closeComprehensiveGuide() {
            document.getElementById('comprehensiveGuideModal').classList.add('hidden');
        }

        function closeStatisticalMethodology() {
            document.getElementById('statisticalMethodologyModal').classList.add('hidden');
        }

        function showGuideSection(sectionName) {
            // Hide all guide sections
            document.querySelectorAll('.guide-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.guide-nav-btn').forEach(btn => {
                btn.className = 'guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600';
            });
            
            const activeBtn = document.getElementById(sectionName + 'NavBtn');
            if (activeBtn) {
                activeBtn.className = 'guide-nav-btn flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors bg-primary text-white';
            }
            
            // Render section content
            renderGuideSection(sectionName);
            initializeIcons();
        }

        function renderGuideSection(sectionName) {
            const container = document.getElementById(sectionName + 'Section');
            
            switch(sectionName) {
                case 'overview':
                    container.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-indigo-50 dark:bg-indigo-900/30 rounded-lg p-6">
                                <h3 class="text-xl font-bold text-indigo-800 dark:text-indigo-200 mb-4">
                                    <i data-lucide="book-open" class="h-6 w-6 mr-2 inline"></i>
                                    Comprehensive Design Efficiency Guide
                                </h3>
                                <p class="text-indigo-700 dark:text-indigo-300 mb-4">
                                    This guide provides detailed information about all 10 efficiency parameters, including visual explanations, 
                                    statistical analysis methodology, impact estimation techniques, and compliance checking procedures.
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">What's Included:</h4>
                                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <li>• Visual sketches for all parameters</li>
                                            <li>• Statistical significance analysis</li>
                                            <li>• Impact estimation formulas</li>
                                            <li>• Compliance limit checking</li>
                                            <li>• Remediation strategies</li>
                                        </ul>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Target Audience:</h4>
                                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <li>• Architects and designers</li>
                                            <li>• Structural engineers</li>
                                            <li>• MEP consultants</li>
                                            <li>• Project managers</li>
                                            <li>• Sustainability consultants</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Parameter Categories</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${[...new Set(parameters.map(p => p.category))].map(category => {
                                        const categoryParams = parameters.filter(p => p.category === category);
                                        const highImpactCount = categoryParams.filter(p => 
                                            p.impactScore.carbon === 'High' || p.impactScore.cost === 'High'
                                        ).length;
                                        
                                        return `
                                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                                <h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">${category}</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">${categoryParams.length} parameters</p>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-xs px-2 py-1 rounded-full ${highImpactCount > 0 ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300' : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300'}">
                                                        ${highImpactCount} High Impact
                                                    </span>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'parameters':
                    container.innerHTML = `
                        <div class="space-y-8">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">
                                <i data-lucide="settings" class="h-6 w-6 mr-2 inline"></i>
                                Parameter Reference Guide
                            </h3>
                            
                            ${parameters.map(param => `
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <div class="flex items-start gap-4 mb-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                                                <i data-lucide="${getParameterIcon(param.category)}" class="h-6 w-6 text-primary"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-1">${param.parameter}</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${param.category} • ${param.metric}</p>
                                            <p class="text-gray-700 dark:text-gray-300">${param.definition}</p>
                                        </div>
                                        <div class="flex gap-1">
                                            ${createImpactIndicator(param.impactScore.cost, 'cost')}
                                            ${createImpactIndicator(param.impactScore.carbon, 'carbon')}
                                            ${createImpactIndicator(param.impactScore.time, 'time')}
                                        </div>
                                    </div>
                                    
                                    ${param.visualSketch ? `
                                        <div class="mb-4">
                                            <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Visual Guide:</h5>
                                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                                ${param.visualSketch}
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Performance Ranges:</h5>
                                            <div class="space-y-2">
                                                <div class="flex items-center justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-sm">
                                                    <span class="text-green-700 dark:text-green-300 font-medium">Optimal</span>
                                                    <span class="text-green-800 dark:text-green-200">${param.optimal}</span>
                                                </div>
                                                <div class="flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded text-sm">
                                                    <span class="text-yellow-700 dark:text-yellow-300 font-medium">Acceptable</span>
                                                    <span class="text-yellow-800 dark:text-yellow-200">${param.acceptable}</span>
                                                </div>
                                                <div class="flex items-center justify-between p-2 bg-red-50 dark:bg-red-900/30 rounded text-sm">
                                                    <span class="text-red-700 dark:text-red-300 font-medium">Risk</span>
                                                    <span class="text-red-800 dark:text-red-200">${param.risk}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Key Benefits:</h5>
                                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                                ${param.benefits.map(benefit => `<li>• ${benefit}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 mb-4">
                                        <h5 class="text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2">Technical Note:</h5>
                                        <p class="text-sm text-blue-700 dark:text-blue-300">${param.technicalNote}</p>
                                    </div>
                                    
                                    <div>
                                        <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Remediation Strategies:</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                            ${param.remediation.map(remedy => `
                                                <div class="flex items-start gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                                    <i data-lucide="check-circle" class="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                                                    <span class="text-sm text-gray-700 dark:text-gray-300">${remedy}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'analysis':
                    container.innerHTML = `
                        <div class="space-y-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">
                                <i data-lucide="bar-chart-3" class="h-6 w-6 mr-2 inline"></i>
                                Statistical Analysis Methodology
                            </h3>
                            
                            <div class="bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-orange-800 dark:text-orange-200 mb-4">Analysis Framework Overview</h4>
                                <p class="text-orange-700 dark:text-orange-300 mb-4">
                                    The tool uses a comprehensive statistical framework to assess parameter significance, 
                                    estimate impacts, and determine compliance with industry standards.
                                </p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">1. Significance Testing</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Statistical significance using industry benchmarks and project-specific context</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">2. Impact Estimation</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Quantitative assessment of cost, carbon, and schedule impacts</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">3. Compliance Checking</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Verification against building codes and sustainability standards</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Statistical Significance Calculation</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Z-Score Formula:</h5>
                                            <div class="bg-gray-100 dark:bg-gray-700 rounded p-3 font-mono text-sm">
                                                z = (observed_value - benchmark_mean) / benchmark_std
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">P-Value Calculation:</h5>
                                            <div class="bg-gray-100 dark:bg-gray-700 rounded p-3 font-mono text-sm">
                                                p_value = 2 * (1 - norm.cdf(abs(z_score)))
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Significance Levels:</h5>
                                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>• p < 0.01: Highly Significant</li>
                                                <li>• p < 0.05: Significant</li>
                                                <li>• p < 0.10: Marginally Significant</li>
                                                <li>• p ≥ 0.10: Not Significant</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Impact Assessment Models</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Form Efficiency Impact:</h5>
                                            <div class="bg-gray-100 dark:bg-gray-700 rounded p-3 text-sm">
                                                <div class="font-mono mb-2">energy_multiplier = 1 + (form_eff - 0.25) * 0.8</div>
                                                <div class="font-mono">cost_multiplier = 1 + (form_eff - 0.25) * 0.6</div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Structural Grid Impact:</h5>
                                            <div class="bg-gray-100 dark:bg-gray-700 rounded p-3 text-sm">
                                                <div class="font-mono mb-2">beam_depth_factor = span > 8m ? 1 + ((span-8)/8)^1.5 : 1</div>
                                                <div class="font-mono">material_multiplier = beam_depth_factor * 1.2</div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Cantilever Impact:</h5>
                                            <div class="bg-gray-100 dark:bg-gray-700 rounded p-3 text-sm">
                                                <div class="font-mono">material_increase = 40-60% per metre of cantilever</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-purple-800 dark:text-purple-200 mb-4">Monte Carlo Uncertainty Analysis</h4>
                                <p class="text-purple-700 dark:text-purple-300 mb-4">
                                    The tool uses Monte Carlo simulation to account for parameter uncertainty and measurement error, 
                                    providing confidence intervals for impact predictions.
                                </p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="font-medium text-purple-800 dark:text-purple-200 mb-2">Simulation Process:</h5>
                                        <ol class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
                                            <li>1. Define parameter uncertainty distributions</li>
                                            <li>2. Sample parameter values (1000 iterations)</li>
                                            <li>3. Calculate outcomes for each sample</li>
                                            <li>4. Analyze result distributions</li>
                                            <li>5. Calculate confidence intervals</li>
                                        </ol>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-purple-800 dark:text-purple-200 mb-2">Output Statistics:</h5>
                                        <ul class="text-sm text-purple-700 dark:text-purple-300 space-y-1">
                                            <li>• Mean predicted impact</li>
                                            <li>• Standard deviation</li>
                                            <li>• 95% confidence intervals</li>
                                            <li>• Coefficient of variation</li>
                                            <li>• Risk assessment levels</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'compliance':
                    container.innerHTML = `
                        <div class="space-y-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">
                                <i data-lucide="shield-check" class="h-6 w-6 mr-2 inline"></i>
                                Compliance Framework & Limit Checking
                            </h3>
                            
                            <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-green-800 dark:text-green-200 mb-4">Standards & Benchmarks</h4>
                                <p class="text-green-700 dark:text-green-300 mb-4">
                                    The tool automatically verifies parameter values against multiple standards and performance benchmarks, 
                                    providing compliance status and identifying potential issues.
                                </p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Building Codes</h5>
                                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <li>• National Construction Code (NCC)</li>
                                            <li>• Australian Standards (AS)</li>
                                            <li>• International Building Code (IBC)</li>
                                            <li>• Local planning requirements</li>
                                        </ul>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Sustainability Standards</h5>
                                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <li>• Green Star benchmarks</li>
                                            <li>• NABERS requirements</li>
                                            <li>• LEED performance criteria</li>
                                            <li>• Net Zero Carbon targets</li>
                                        </ul>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4">
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-2">Industry Benchmarks</h5>
                                        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                            <li>• Structural efficiency norms</li>
                                            <li>• MEP system performance</li>
                                            <li>• Planning efficiency ratios</li>
                                            <li>• Construction best practices</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Compliance Checking Process</h4>
                                    
                                    <div class="space-y-4">
                                        <div class="flex items-start gap-3">
                                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-blue-600 dark:text-blue-400 font-semibold text-sm">1</span>
                                            </div>
                                            <div>
                                                <h5 class="font-medium text-gray-800 dark:text-gray-100">Parameter Classification</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Each parameter is classified by building type and applicable standards</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-start gap-3">
                                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-blue-600 dark:text-blue-400 font-semibold text-sm">2</span>
                                            </div>
                                            <div>
                                                <h5 class="font-medium text-gray-800 dark:text-gray-100">Limit Verification</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Values are checked against minimum/maximum limits and acceptable ranges</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-start gap-3">
                                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-blue-600 dark:text-blue-400 font-semibold text-sm">3</span>
                                            </div>
                                            <div>
                                                <h5 class="font-medium text-gray-800 dark:text-gray-100">Risk Assessment</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Non-compliant values are assessed for severity and potential impact</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-start gap-3">
                                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-blue-600 dark:text-blue-400 font-semibold text-sm">4</span>
                                            </div>
                                            <div>
                                                <h5 class="font-medium text-gray-800 dark:text-gray-100">Recommendations</h5>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Specific actions are suggested to achieve compliance</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Example Compliance Limits</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Floor-to-Floor Height (Office)</h5>
                                            <div class="space-y-2">
                                                <div class="flex justify-between p-2 bg-red-50 dark:bg-red-900/30 rounded text-sm">
                                                    <span class="text-red-700 dark:text-red-300">Code Minimum</span>
                                                    <span class="text-red-800 dark:text-red-200">≥ 2.4m</span>
                                                </div>
                                                <div class="flex justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-sm">
                                                    <span class="text-green-700 dark:text-green-300">Optimal Range</span>
                                                    <span class="text-green-800 dark:text-green-200">3.6 - 3.9m</span>
                                                </div>
                                                <div class="flex justify-between p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded text-sm">
                                                    <span class="text-yellow-700 dark:text-yellow-300">Efficiency Limit</span>
                                                    <span class="text-yellow-800 dark:text-yellow-200">≤ 4.2m</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Form Efficiency</h5>
                                            <div class="space-y-2">
                                                <div class="flex justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-sm">
                                                    <span class="text-green-700 dark:text-green-300">Green Star Target</span>
                                                    <span class="text-green-800 dark:text-green-200">≤ 0.30</span>
                                                </div>
                                                <div class="flex justify-between p-2 bg-blue-50 dark:bg-blue-900/30 rounded text-sm">
                                                    <span class="text-blue-700 dark:text-blue-300">Optimal</span>
                                                    <span class="text-blue-800 dark:text-blue-200">≤ 0.25</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Structural Grid</h5>
                                            <div class="space-y-2">
                                                <div class="flex justify-between p-2 bg-green-50 dark:bg-green-900/30 rounded text-sm">
                                                    <span class="text-green-700 dark:text-green-300">Efficient Range</span>
                                                    <span class="text-green-800 dark:text-green-200">7.5 - 8.5m</span>
                                                </div>
                                                <div class="flex justify-between p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded text-sm">
                                                    <span class="text-yellow-700 dark:text-yellow-300">Review Above</span>
                                                    <span class="text-yellow-800 dark:text-yellow-200">9.0m</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-red-800 dark:text-red-200 mb-4">
                                    <i data-lucide="alert-triangle" class="h-5 w-5 mr-2 inline"></i>
                                    Compliance Violations & Actions
                                </h4>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <h5 class="font-medium text-red-800 dark:text-red-200 mb-2">Critical Violations</h5>
                                        <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">
                                            <li>• Code non-compliance</li>
                                            <li>• Structural safety issues</li>
                                            <li>• Extreme parameter values</li>
                                        </ul>
                                        <div class="mt-2 p-2 bg-red-100 dark:bg-red-800/30 rounded text-xs text-red-700 dark:text-red-300">
                                            <strong>Action:</strong> Immediate design revision required
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-2">Performance Issues</h5>
                                        <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
                                            <li>• Efficiency targets missed</li>
                                            <li>• Sustainability benchmarks</li>
                                            <li>• Best practice deviations</li>
                                        </ul>
                                        <div class="mt-2 p-2 bg-yellow-100 dark:bg-yellow-800/30 rounded text-xs text-yellow-700 dark:text-yellow-300">
                                            <strong>Action:</strong> Design optimisation recommended
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h5 class="font-medium text-green-800 dark:text-green-200 mb-2">Minor Deviations</h5>
                                        <ul class="text-sm text-green-700 dark:text-green-300 space-y-1">
                                            <li>• Industry norm variations</li>
                                            <li>• Project-specific constraints</li>
                                            <li>• Acceptable trade-offs</li>
                                        </ul>
                                        <div class="mt-2 p-2 bg-green-100 dark:bg-green-800/30 rounded text-xs text-green-700 dark:text-green-300">
                                            <strong>Action:</strong> Document justification
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'implementation':
                    container.innerHTML = `
                        <div class="space-y-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">
                                <i data-lucide="cog" class="h-6 w-6 mr-2 inline"></i>
                                Implementation Guidelines
                            </h3>
                            
                            <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-4">Project Integration Workflow</h4>
                                <p class="text-blue-700 dark:text-blue-300 mb-4">
                                    Integrate design efficiency analysis into your project workflow for maximum benefit. 
                                    Early application provides the greatest opportunities for optimization.
                                </p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="bg-white dark:bg-gray-700 rounded p-4 text-center">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                            <span class="text-white font-semibold text-sm">1</span>
                                        </div>
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-1">Concept Design</h5>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Initial massing and form analysis</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4 text-center">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                            <span class="text-white font-semibold text-sm">2</span>
                                        </div>
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-1">Schematic Design</h5>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Detailed parameter optimization</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4 text-center">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                            <span class="text-white font-semibold text-sm">3</span>
                                        </div>
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-1">Design Development</h5>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Final compliance verification</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-700 rounded p-4 text-center">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                            <span class="text-white font-semibold text-sm">4</span>
                                        </div>
                                        <h5 class="font-semibold text-gray-800 dark:text-gray-100 mb-1">Construction</h5>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Monitor implementation</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Best Practices for Teams</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Design Team Coordination:</h5>
                                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>• Share analysis results with all consultants</li>
                                                <li>• Establish parameter targets early in the project</li>
                                                <li>• Regular review meetings to track progress</li>
                                                <li>• Document design decisions and trade-offs</li>
                                            </ul>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Iterative Design Process:</h5>
                                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>• Test multiple design options</li>
                                                <li>• Compare efficiency scores between alternatives</li>
                                                <li>• Focus on high-impact parameters first</li>
                                                <li>• Validate assumptions with detailed analysis</li>
                                            </ul>
                                        </div>
                                        
                                        <div>
                                            <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Documentation:</h5>
                                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>• Export reports for project records</li>
                                                <li>• Include analysis in sustainability reports</li>
                                                <li>• Track performance through construction</li>
                                                <li>• Conduct post-occupancy validation</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Common Implementation Challenges</h4>
                                    
                                    <div class="space-y-4">
                                        <div class="border-l-4 border-yellow-400 pl-4">
                                            <h5 class="font-medium text-yellow-800 dark:text-yellow-200 mb-1">Challenge: Late Parameter Changes</h5>
                                            <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-2">Parameters changed after design development</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400"><strong>Solution:</strong> Regular analysis updates and stakeholder communication</p>
                                        </div>
                                        
                                        <div class="border-l-4 border-red-400 pl-4">
                                            <h5 class="font-medium text-red-800 dark:text-red-200 mb-1">Challenge: Conflicting Requirements</h5>
                                            <p class="text-sm text-red-700 dark:text-red-300 mb-2">Efficiency vs. program requirements conflict</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400"><strong>Solution:</strong> Early stakeholder alignment and trade-off analysis</p>
                                        </div>
                                        
                                        <div class="border-l-4 border-blue-400 pl-4">
                                            <h5 class="font-medium text-blue-800 dark:text-blue-200 mb-1">Challenge: Data Availability</h5>
                                            <p class="text-sm text-blue-700 dark:text-blue-300 mb-2">Insufficient data for complete analysis</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400"><strong>Solution:</strong> Phased analysis approach with assumption documentation</p>
                                        </div>
                                        
                                        <div class="border-l-4 border-green-400 pl-4">
                                            <h5 class="font-medium text-green-800 dark:text-green-200 mb-1">Challenge: Team Buy-in</h5>
                                            <p class="text-sm text-green-700 dark:text-green-300 mb-2">Resistance to changing established practices</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400"><strong>Solution:</strong> Demonstrate value through pilot projects and training</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Action Checklist</h4>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Project Start (Week 1-2):</h5>
                                        <div class="space-y-2">
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Establish efficiency targets with client
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Brief design team on methodology
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Set up analysis schedule
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Identify project-specific constraints
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Concept Phase (Week 3-4):</h5>
                                        <div class="space-y-2">
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Complete initial efficiency analysis
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Compare multiple massing options
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Identify key optimization opportunities
                                            </label>
                                            <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                                <input type="checkbox" class="mr-2 rounded">
                                                Present findings to stakeholders
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 p-4 bg-primary/10 rounded">
                                    <p class="text-sm text-primary font-medium">
                                        <i data-lucide="lightbulb" class="h-4 w-4 mr-1 inline"></i>
                                        Pro Tip: Early analysis saves time and money. Most efficiency gains come from decisions made in the first 20% of design development.
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        function getParameterIcon(category) {
            const iconMap = {
                'Building Form': 'building-2',
                'Structure': 'columns',
                'Vertical Design': 'move-vertical',
                'Special Conditions': 'triangle-alert',
                'Envelope': 'square',
                'Planning': 'layout-grid',
                'MEP': 'zap'
            };
            return iconMap[category] || 'settings';
        }

        // Global functions for onclick handlers
        window.showPage = showPage;
        window.showParameterDetail = showParameterDetail;
        window.proceedToAnalysis = proceedToAnalysis;
        window.proceedToSummary = proceedToSummary;
        window.updateParameterValue = updateParameterValue;
        window.updateParameterValueSimple = updateParameterValueSimple;
        window.updateParameterReason = updateParameterReason;
        window.useOptimalValue = useOptimalValue;
        window.useOptimalValueSimple = useOptimalValueSimple;
        window.exportToPDF = exportToPDF;
        window.exportToCSV = exportToCSV;
        window.generatePresentation = generatePresentation;
        window.resetTool = resetTool;
        window.toggleParameterInfo = toggleParameterInfo;
        window.toggleBuildingTypeInfo = toggleBuildingTypeInfo;
        window.showBuildingTypeInfo = showBuildingTypeInfo;
        window.hideBuildingTypeInfo = hideBuildingTypeInfo;
        window.switchInputMode = switchInputMode;
        window.toggleParameterExpansion = toggleParameterExpansion;
        window.removeParameterFromConsideration = removeParameterFromConsideration;
        window.toggleInputMode = toggleInputMode;
        window.calculateFormEfficiency = calculateFormEfficiency;
        window.toggleParameterComment = toggleParameterComment;
        window.updateParameterComment = updateParameterComment;
        window.excludeParameterFromAnalysis = excludeParameterFromAnalysis;
        window.includeParameterInAnalysis = includeParameterInAnalysis;
        window.updateParameterMinimizeReason = updateParameterMinimizeReason;
        window.showBIMIntegration = showBIMIntegration;
        window.closeBIMIntegration = closeBIMIntegration;
        window.startAnalysis = startAnalysis;
        window.startFileUpload = startFileUpload;
        window.startManualInput = startManualInput;
        window.scrollToLearnMore = scrollToLearnMore;
        window.scrollToDemo = scrollToDemo;
        window.closeFileUploadModal = closeFileUploadModal;
        window.removeFile = removeFile;
        window.processUploadedFiles = processUploadedFiles;
        window.quickStart = quickStart;
        window.handleQuickStart = handleQuickStart;
        window.scrollToFeatures = scrollToFeatures;
        window.showCodeTab = showCodeTab;
        window.downloadBIMCode = downloadBIMCode;
        window.contactBIMSupport = contactBIMSupport;
        window.showComprehensiveGuide = showComprehensiveGuide;
        window.showStatisticalMethodology = showStatisticalMethodology;
        window.closeComprehensiveGuide = closeComprehensiveGuide;
        window.closeStatisticalMethodology = closeStatisticalMethodology;
        window.showGuideSection = showGuideSection;

        // Sustainability-focused helper functions
        function calculateSustainabilityStats() {
            const totalParams = parameters.length;
            const consideredParams = Object.values(projectData.parameters).filter(p => p.status !== 'not-considered').length;
            const optimalParams = Object.values(projectData.parameters).filter(p => p.status === 'optimal').length;
            const riskParams = Object.values(projectData.parameters).filter(p => p.status === 'risk').length;
            
            // Calculate sustainability scores
            const carbonScore = consideredParams > 0 ? Math.round((optimalParams / consideredParams) * 100) + '%' : 'N/A';
            const costScore = consideredParams > 0 ? Math.round(((optimalParams + (Object.values(projectData.parameters).filter(p => p.status === 'acceptable').length * 0.7)) / consideredParams) * 100) + '%' : 'N/A';
            const constructionScore = riskParams === 0 ? 'Good' : riskParams <= 2 ? 'Review' : 'Risk';
            const completeness = Math.round((consideredParams / totalParams) * 100);
            
            // Identify parameters that need attention (high impact + not optimal)
            const needsAttention = parameters
                .filter(p => {
                    const data = projectData.parameters[p.id];
                    const isHighImpact = p.impactScore.carbon === 'High' || p.impactScore.cost === 'High';
                    const needsWork = !data || data.status === 'risk' || data.status === 'not-considered';
                    return isHighImpact && needsWork;
                })
                .map(p => p.parameter);
            
            return {
                carbonScore,
                costScore,
                constructionScore,
                completeness,
                needsAttention
            };
        }

        function getCategoryIcon(categoryName) {
            if (categoryName.includes('High Impact')) return 'alert-triangle';
            if (categoryName.includes('Medium Impact')) return 'alert-circle';
            return 'info';
        }

        function getCategoryColor(categoryName) {
            if (categoryName.includes('High Impact')) return 'bg-danger';
            if (categoryName.includes('Medium Impact')) return 'bg-warning';
            return 'bg-gray-500';
        }
    </script>
</body>
</html>
